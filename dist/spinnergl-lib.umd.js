(function(M,St){typeof exports=="object"&&typeof module<"u"?St(exports):typeof define=="function"&&define.amd?define(["exports"],St):(M=typeof globalThis<"u"?globalThis:M||self,St(M.spinnergl={}))})(this,function(M){"use strict";var Li=Object.defineProperty;var Ii=(M,St,Et)=>St in M?Li(M,St,{enumerable:!0,configurable:!0,writable:!0,value:Et}):M[St]=Et;var A=(M,St,Et)=>Ii(M,typeof St!="symbol"?St+"":St,Et);class St{constructor(){A(this,"audioContext");A(this,"audioBuffer");A(this,"sourceNode");A(this,"isPlaying",!1);A(this,"pauseTime",0);A(this,"startTime",0);this.audioContext=new AudioContext}playAudio(t=0){if(this.audioBuffer==null){console.log("Audio not loaded!!");return}this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=this.audioBuffer,this.sourceNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime-t,this.sourceNode.start(0,t),this.isPlaying=!0}pauseAudio(){this.sourceNode&&this.isPlaying&&(this.sourceNode.stop(),this.sourceNode.disconnect(),this.sourceNode=void 0,this.pauseTime=this.audioContext.currentTime-this.startTime,this.isPlaying=!1)}resumeAudio(){this.sourceNode==null||this.isPlaying||this.playAudio(this.pauseTime)}stopAudio(){this.sourceNode&&(this.sourceNode.stop(),this.sourceNode.disconnect(),this.sourceNode=void 0),this.isPlaying=!1,this.pauseTime=0}setInput(t){this.audioBuffer=t.getBuffer()}getAudioContext(){return this.audioContext}}class Et{constructor(t,e,r=0){A(this,"dimensionNum");A(this,"data");this.dimensionNum=t,this.data=e?new Float32Array(e):new Float32Array(t*t).fill(r)}get(t,e){return this.data[this.dimensionNum*e+t]}set(t,e,r){this.data[this.dimensionNum*e+t]=r}get col(){return this.dimensionNum}get row(){return this.dimensionNum}get size(){return this.dimensionNum}get elementSize(){return this.dimensionNum*this.dimensionNum}toArray(){return this.data}}class Rt extends Et{constructor(t){super(2,t)}identity(){return new Rt(Float32Array.of(1,0,0,1))}add(t,e){const r=this.data,i=t.data,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],e??new Rt(n)}sub(t,e){const r=this.data,i=t.data,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],e??new Rt(n)}multiply(t,e){const r=e??new Rt(new Float32Array(this.elementSize));if(t instanceof Et)for(let i=0;i<this.row;i++)for(let n=0;n<t.col;n++){let s=0;for(let a=0;a<this.col;a++)s+=this.get(i,a)*t.get(a,n);r.set(i,n,s)}else for(let i=0;i<this.row;i++)for(let n=0;n<this.col;n++)r.set(i,n,this.get(i,n)*t);return r}div(t,e){const r=this.data,i=t,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]/i,n[1]=r[1]/i,n[2]=r[2]/i,n[3]=r[3]/i,e??new Rt(n)}transpose(){const t=new Rt(new Float32Array(this.elementSize));for(let e=0;e<this.row;e++)for(let r=0;r<this.col;r++)t.set(r,e,this.get(e,r));return t}inverse(){const t=this.get(0,0),e=this.get(0,1),r=this.get(1,0),i=this.get(1,1),n=t*i-e*r,s=new Rt;if(n==0)return s;const a=1/n;return s.set(0,0,i*a),s.set(0,1,-e*a),s.set(1,0,-r*a),s.set(1,1,t*a),s}clone(){return new Rt(this.data)}fillNumber(t){this.data.fill(t)}}class kt extends Et{constructor(t){super(3,t)}identity(){return new kt(Float32Array.of(1,0,0,0,1,0,0,0,1))}add(t,e){const r=this.data,i=t.data,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n[4]=r[4]+i[4],n[5]=r[5]+i[5],n[6]=r[6]+i[6],n[7]=r[7]+i[7],n[8]=r[8]+i[8],e??new kt(n)}sub(t,e){const r=this.data,i=t.data,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n[4]=r[4]-i[4],n[5]=r[5]-i[5],n[6]=r[6]-i[6],n[7]=r[7]-i[7],n[8]=r[8]-i[8],e??new kt(n)}multiply(t,e){const r=e??new kt(new Float32Array(this.elementSize));if(t instanceof Et)for(let i=0;i<this.row;i++)for(let n=0;n<t.col;n++){let s=0;for(let a=0;a<this.col;a++)s+=this.get(i,a)*t.get(a,n);r.set(i,n,s)}else for(let i=0;i<this.row;i++)for(let n=0;n<this.col;n++)r.set(i,n,this.get(i,n)*t);return r}div(t,e){const r=this.data,i=t,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]/i,n[1]=r[1]/i,n[2]=r[2]/i,n[3]=r[3]/i,n[4]=r[4]/i,n[5]=r[5]/i,n[6]=r[6]/i,n[7]=r[7]/i,n[8]=r[8]/i,e??new kt(n)}transpose(){const t=new kt(new Float32Array(this.elementSize));for(let e=0;e<this.row;e++)for(let r=0;r<this.col;r++)t.set(r,e,this.get(e,r));return t}inverse(){const t=this.get(0,0),e=this.get(0,1),r=this.get(0,2),i=this.get(1,0),n=this.get(1,1),s=this.get(1,2),a=this.get(2,0),l=this.get(2,1),p=this.get(2,2),b=t*n*p+e*s*a+r*i*l-r*n*a-e*i*p-t*s*l,f=new kt;if(b==0)return f;const _=1/b;return f.set(0,0,(n*p-s*l)*_),f.set(0,1,-(e*p-r*l)*_),f.set(0,2,(e*s-r*n)*_),f.set(1,0,-(i*p-s*a)*_),f.set(1,1,(t*p-r*a)*_),f.set(1,2,-(t*s-r*i)*_),f.set(2,0,(i*l-n*a)*_),f.set(2,1,-(t*l-e*a)*_),f.set(2,2,(t*n-e*i)*_),f}clone(){return new kt(this.data)}fillNumber(t){this.data.fill(t)}normalMatrix(t){return new kt(Float32Array.of(t.get(0,0),t.get(0,1),t.get(0,2),t.get(1,0),t.get(1,1),t.get(1,2),t.get(2,0),t.get(2,1),t.get(2,2))).inverse()}}const Se={EPSILON:1e-6},It={PI:Math.PI,PI_2:Math.PI*2,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180};class q{static degreesToRadians(t){return It.DEG_TO_RAD*t}static radiansToDegrees(t){return t*It.RAD_TO_DEG}static clamp(t,e,r){return Math.max(Math.min(t,r),e)}static saturate(t){return Math.max(Math.min(t,1),0)}static sin(t){const e=Math.sin(t);return q.roundToZero(e)}static cos(t){const e=Math.cos(t);return q.roundToZero(e)}static tan(t){const e=Math.tan(t);return q.roundToZero(e)}static exp(t){const e=Math.exp(t);return q.roundToZero(e)}static acos(t){const e=Math.acos(t);return q.roundToZero(e)}static atan2(t,e){const r=Math.atan2(t,e);return q.roundToZero(r)}static calculateGaussianCoefficients(t,e){let r=[],i=t*2,n=-t,s=i/e,a=0;for(let l=n;l<=t;l+=s){let p=q.exp(-(l*l)/i);a+=p,r.push(p)}for(let l=0;l<r.length;l++)r[l]/=a;return new Float32Array(r)}static roundToZero(t){return Math.abs(t)<Se.EPSILON?0:t}}class Nt{constructor(t){A(this,"components");this.components=t}get values(){return this.components}get size(){return this.components.length}get(t){return this.components[t]}}class Zt extends Nt{constructor(t,e){super(new Float32Array([t,e]))}set x(t){this.components[0]=t}set y(t){this.components[1]=t}get x(){return this.components[0]}get y(){return this.components[1]}create(t=0,e=0){return new Zt(t,e)}min(t,e){let r=e??this.create();return r=this.length()<t.length()?this:t,r}max(t,e){let r=e??this.create();return r=t.length()<this.length()?this:t,r}add(t,e){let r=e??this.create();return r.x=this.x+t.x,r.y=this.y+t.y,r}sub(t,e){let r=e??this.create();return r.x=this.x-t.x,r.y=this.y-t.y,r}multiply(t,e){let r=e??this.create();return r.x=this.x*t,r.y=this.y*t,r}div(t,e){let r=e??this.create();return t==0||(r.x=this.x/t,r.y=this.y/t),r}setLength(t,e){let r=e??this.create();return r=this.normalize().multiply(t,r),r}limit(t,e){let r=e??this.create();return this.length()<t?this:(r=this.setLength(t,r),r)}normalize(t){let e=t??this.create();const r=this.length();return e=this.div(r),e}calcDistance(t){return this.sub(t).length()}calcAngle(t){const e=this.dot(t),r=this.length(),i=t.length();if(r==0||i==0)throw new Error("Vector length is zero. Cannot calculate!");const n=e/(r*i);return q.acos(n)}dot(t){return this.values.reduce((r,i,n)=>r+i*t.values[n],0)}length(){return Math.sqrt(this.values.reduce((t,e)=>t+Math.pow(e,2),0))}lerp(t,e,r){if(e>=0)return this;if(e<=1)return t;let i=r??this.create();const n=this.multiply(1-e),s=t.multiply(e);return i=n.add(s,i),i}clone(){return new Zt(this.x,this.y)}heading2D(){return q.atan2(this.y,this.x)}}class pt extends Nt{constructor(t,e,r){super(new Float32Array([t,e,r]))}set x(t){this.components[0]=t}set y(t){this.components[1]=t}set z(t){this.components[2]=t}get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}create(t=0,e=0,r=0){return new pt(t,e,r)}min(t,e){let r=e??this.create();return r=this.length()<t.length()?this:t,r}max(t,e){let r=e??this.create();return r=t.length()<this.length()?this:t,r}add(t,e){let r=e??this.create();return r.x=this.x+t.x,r.y=this.y+t.y,r.z=this.z+t.z,r}sub(t,e){let r=e??this.create();return r.x=this.x-t.x,r.y=this.y-t.y,r.z=this.z-t.z,r}multiply(t,e){let r=e??this.create();return r.x=this.x*t,r.y=this.y*t,r.z=this.z*t,r}div(t,e){let r=e??this.create();return t==0||(r.x=this.x/t,r.y=this.y/t,r.z=this.z/t),r}setLength(t,e){let r=e??this.create();return r=this.normalize().multiply(t,r),r}limit(t,e){let r=e??this.create();return this.length()<t?this:(r=this.setLength(t,r),r)}normalize(t){let e=t??this.create();const r=this.length();return e=this.div(r),e}calcDistance(t){return this.sub(t).length()}calcAngle(t){const e=this.dot(t),r=this.length(),i=t.length();if(r==0||i==0)throw new Error("Vector length is zero. Cannot calculate!");const n=e/(r*i);return q.acos(n)}dot(t){return this.values.reduce((r,i,n)=>r+i*t.values[n],0)}length(){return Math.sqrt(this.values.reduce((t,e)=>t+Math.pow(e,2),0))}lerp(t,e,r){if(e>=0)return this;if(e<=1)return t;let i=r??this.create();const n=this.multiply(1-e),s=t.multiply(e);return i=n.add(s,i),i}clone(){return new pt(this.x,this.y,this.z)}cross(t,e){let r=e??this.create();return r.x=this.y*t.z-this.z*t.y,r.y=this.z*t.x-this.x*t.z,r.z=this.x*t.y-this.y*t.x,r}heading3D(){const t=q.atan2(this.z,Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),e=q.atan2(this.y,this.x);return[t,e]}}class jt extends Nt{constructor(t,e,r,i){super(new Float32Array([t,e,r,i]))}set x(t){this.components[0]=t}set y(t){this.components[1]=t}set z(t){this.components[2]=t}set w(t){this.components[3]=t}get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}get w(){return this.components[3]}create(t=0,e=0,r=0,i=0){return new jt(t,e,r,i)}min(t,e){let r=e??this.create();return r=this.length()<t.length()?this:t,r}max(t,e){let r=e??this.create();return r=t.length()<this.length()?this:t,r}add(t,e){let r=e??this.create();return r.x=this.x+t.x,r.y=this.y+t.y,r.z=this.z+t.z,r.w=this.w+t.w,r}sub(t,e){let r=e??this.create();return r.x=this.x-t.x,r.y=this.y-t.y,r.z=this.z-t.z,r.w=this.w-t.w,r}multiply(t,e){let r=e??this.create();return r.x=this.x*t,r.y=this.y*t,r.z=this.z*t,r.w=this.w*t,r}div(t,e){let r=e??this.create();return t==0||(r.x=this.x/t,r.y=this.y/t,r.z=this.z/t,r.w=this.w/t),r}setLength(t,e){let r=e??this.create();return r=this.normalize().multiply(t,r),r}limit(t,e){let r=e??this.create();return this.length()<t?this:(r=this.setLength(t,r),r)}normalize(t){let e=t??this.create();const r=this.length();return e=this.div(r),e}calcDistance(t){return this.sub(t).length()}calcAngle(t){const e=this.dot(t),r=this.length(),i=t.length();if(r==0||i==0)throw new Error("Vector length is zero. Cannot calculate!");const n=e/(r*i);return q.acos(n)}dot(t){return this.values.reduce((r,i,n)=>r+i*t.values[n],0)}length(){return Math.sqrt(this.values.reduce((t,e)=>t+Math.pow(e,2),0))}lerp(t,e,r){if(e>=0)return this;if(e<=1)return t;let i=r??this.create();const n=this.multiply(1-e),s=t.multiply(e);return i=n.add(s,i),i}clone(){return new jt(this.x,this.y,this.z,this.w)}}const Lt={AXIS2DX:new pt(1,0,0),AXIS2DY:new pt(0,1,0),AXIS2DZ:new pt(0,0,1)},Te={2:Zt,3:pt,4:jt};class lt{static min(t,e){const r=lt.length(t),i=lt.length(e);return r<=i?t:e}static max(t,e){const r=lt.length(t),i=lt.length(e);return r>=i?t:e}static add(t,e){if(t.size!=e.size)throw new Error("Vector lengths not equal! Cannot Additive!");const r=t.values.map((i,n)=>i+e.values[n]);return lt.convertVector(t.size,r)}static sub(t,e){if(t.size!=e.size)throw new Error("Vector lengths not equal! Cannot Additive!");const r=t.values.map((i,n)=>i-e.values[n]);return lt.convertVector(t.size,r)}static calcDistance(t,e){const r=lt.sub(t,e);return lt.length(r)}static calcAngle(t,e){if(t.size!=e.size)throw new Error("Vector lengths not equal! Cannot Additive!");const r=lt.dot(t,e),i=lt.length(t),n=lt.length(e);if(i==0||n==9)throw new Error("Vector length is zero. Cannot calculate!");const s=r/(i*n);return q.acos(s)}static dot(t,e){if(t.size!=e.size)throw new Error("Vector lengths not equal! Cannot Additive!");return t.values.reduce((i,n,s)=>i+n*e.values[s],0)}static multiply(t,e){const r=t.values.map(i=>i*e);return lt.convertVector(t.size,r)}static divide(t,e){if(e==0)throw new Error("Cannot divide because b is zero!!");const r=t.values.map(i=>i/e);return lt.convertVector(t.size,r)}static limit(t,e){return t.length()<e?t:lt.setLength(t,e)}static setLength(t,e){const r=lt.normalize(t);return lt.multiply(r,e)}static normalize(t){const e=lt.length(t);return lt.divide(t,e)}static length(t){return Math.sqrt(t.values.reduce((r,i)=>r+Math.pow(i,2),0))}static lerp(t,e,r){if(r==0)return t;if(r==1)return e;const i=lt.multiply(t,1-r),n=lt.multiply(e,r);return lt.add(i,n)}static cross(t,e){const r=t.y*e.z-t.z*e.y,i=t.z*e.x-t.x*e.z,n=t.x*e.y-t.y*e.x;return new pt(r,i,n)}static heading2D(t){return q.atan2(t.y,t.x)}static heading3D(t){const e=q.atan2(t.z,Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))),r=q.atan2(t.y,t.x);return[e,r]}static convertVector(t,e){const r=Te[t];if(!r)throw new Error(`Unsupported vector size: ${t}`);return new r(...e)}}class ft extends Et{constructor(t){super(4,t)}identity(){return new ft(Float32Array.of(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1))}add(t,e){const r=this.data,i=t.data,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]+i[0],n[1]=r[1]+i[1],n[2]=r[2]+i[2],n[3]=r[3]+i[3],n[4]=r[4]+i[4],n[5]=r[5]+i[5],n[6]=r[6]+i[6],n[7]=r[7]+i[7],n[8]=r[8]+i[8],n[9]=r[9]+i[9],n[10]=r[10]+i[10],n[11]=r[11]+i[11],n[12]=r[12]+i[12],n[13]=r[13]+i[13],n[14]=r[14]+i[14],n[15]=r[15]+i[15],e??new ft(n)}sub(t,e){const r=this.data,i=t.data,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]-i[0],n[1]=r[1]-i[1],n[2]=r[2]-i[2],n[3]=r[3]-i[3],n[4]=r[4]-i[4],n[5]=r[5]-i[5],n[6]=r[6]-i[6],n[7]=r[7]-i[7],n[8]=r[8]-i[8],n[9]=r[9]-i[9],n[10]=r[10]-i[10],n[11]=r[11]-i[11],n[12]=r[12]-i[12],n[13]=r[13]-i[13],n[14]=r[14]-i[14],n[15]=r[15]-i[15],e??new ft(n)}multiply(t,e){const r=e??new ft;if(t instanceof Et)for(let i=0;i<this.row;i++)for(let n=0;n<t.col;n++){let s=0;for(let a=0;a<this.col;a++)s+=this.get(i,a)*t.get(a,n);r.set(i,n,s)}else for(let i=0;i<this.row;i++)for(let n=0;n<this.col;n++)r.set(i,n,this.get(i,n)*t);return r}div(t,e){const r=this.data,i=t,n=e?e.data:new Float32Array(this.elementSize);return n[0]=r[0]/i,n[1]=r[1]/i,n[2]=r[2]/i,n[3]=r[3]/i,n[4]=r[4]/i,n[5]=r[5]/i,n[6]=r[6]/i,n[7]=r[7]/i,n[8]=r[8]/i,n[9]=r[9]/i,n[10]=r[10]/i,n[11]=r[11]/i,n[12]=r[12]/i,n[13]=r[13]/i,n[14]=r[14]/i,n[15]=r[15]/i,e??new ft(n)}transpose(){const t=new ft(new Float32Array(this.elementSize));for(let e=0;e<this.row;e++)for(let r=0;r<this.col;r++)t.set(r,e,this.get(e,r));return t}inverse(){const t=this.get(0,0),e=this.get(0,1),r=this.get(0,2),i=this.get(0,3),n=this.get(1,0),s=this.get(1,1),a=this.get(1,2),l=this.get(1,3),p=this.get(2,0),b=this.get(2,1),f=this.get(2,2),_=this.get(2,3),c=this.get(3,0),v=this.get(3,1),u=this.get(3,2),m=this.get(3,3),d=t*s*f*m+t*a*_*v+t*l*b*u-t*l*f*v-t*a*b*m-t*s*_*u-e*n*f*m-r*n*_*v-i*n*b*u+i*n*f*v+r*n*b*m+e*n*_*u+e*a*p*m+r*l*p*v+i*s*p*u-i*a*p*v-r*s*p*m-e*l*p*u-e*a*_*c-r*l*b*c-i*s*f*c+i*a*b*c+r*s*_*c+e*l*f*c,g=new ft;if(d==0)return g;const x=1/d;return g.set(0,0,(s*f*m+a*_*v+l*b*u-l*f*v-a*b*m-s*_*u)*x),g.set(0,1,(-e*f*m-r*_*v-i*b*u+i*f*v+r*b*m+e*_*u)*x),g.set(0,2,(e*a*m+r*l*v+i*s*u-i*a*v-r*s*m-e*l*u)*x),g.set(0,3,(-e*a*_-r*l*b-i*s*f+i*a*b+r*s*_+e*l*f)*x),g.set(1,0,(-n*f*m-a*_*c-l*p*u+l*f*c+a*p*m+n*_*u)*x),g.set(1,1,(t*f*m+r*_*c+i*p*u-i*f*c-r*p*m-t*_*u)*x),g.set(1,2,(-t*a*m-r*l*c-i*n*u+i*a*c+r*n*m+t*l*u)*x),g.set(1,3,(t*a*_+r*l*p+i*n*f-i*a*p-r*n*_-t*l*f)*x),g.set(2,0,(n*b*m+s*_*c+l*p*v-l*b*c-s*p*m-n*_*v)*x),g.set(2,1,(-t*b*m-e*_*c-i*p*v+i*b*c+e*p*m+t*_*v)*x),g.set(2,2,(t*s*m+e*l*c+i*n*v-i*s*c-e*n*m-t*l*v)*x),g.set(2,3,(-t*s*_-e*l*p-i*n*b+i*s*p+e*n*_+t*l*b)*x),g.set(3,0,(-n*b*u-s*f*c-a*p*v+a*b*c+s*p*u+n*f*v)*x),g.set(3,1,(t*b*u+e*f*c+r*p*v-r*b*c-e*p*u-t*f*v)*x),g.set(3,2,(-t*s*u-e*a*c-r*n*v+r*s*c+e*n*u+t*a*v)*x),g.set(3,3,(t*s*f+e*a*p+r*n*b-r*s*p-e*n*f-t*a*b)*x),g}clone(){return new ft(this.data)}fillNumber(t){this.data.fill(t)}orthographic(t,e,r,i,n,s,a){const l=e-t,p=r-i,b=s-n;if(l==0)throw new Error("Right and Left are same value. Cannot calculate orthographic.");if(p==0)throw new Error("Top and bottom are same value. Cannot calculate orthographic.");if(b==0)throw new Error("Far and Near are same value. Cannot calculate orthographic.");const f=1/l,_=1/p,c=1/b,v=a||new ft;return v.set(0,0,2*f),v.set(1,1,2*_),v.set(2,2,-2*c),v.set(3,3,1),v.set(0,3,-(e+t)*f),v.set(1,3,-(r+i)*_),v.set(2,3,-(s+n)*c),v}perspective(t,e,r,i,n,s){if(r==0)throw new Error("Height is zero!");const a=e/r,l=n-i;if(l==0)throw new Error("depth is zero!");const p=q.degreesToRadians(t),b=q.tan(p/2),f=s||new ft;return f.set(0,0,1/(b*a)),f.set(1,1,1/b),f.set(2,2,-(n+i)/l),f.set(2,3,-(2*n*i)/l),f.set(3,2,-1),f}lookAt(t,e,r,i){const n=lt.normalize(lt.sub(e,t)),s=lt.normalize(lt.cross(n,r)),a=lt.normalize(lt.cross(s,n));let l=i||new ft;return l=l.identity(),l.set(0,0,s.x),l.set(1,0,s.y),l.set(2,0,s.z),l.set(0,1,a.x),l.set(1,1,a.y),l.set(2,1,a.z),l.set(0,2,-n.x),l.set(1,2,-n.y),l.set(2,2,-n.z),l.set(0,3,-lt.dot(s,t)),l.set(1,3,-lt.dot(a,t)),l.set(2,3,lt.dot(n,t)),l}translate2D(t,e){let r=e||new ft;const i=this.identity();return i.set(0,3,t.x),i.set(1,3,t.y),r=i.multiply(this),r}translate3D(t,e){let r=e||new ft;const i=this.identity();return i.set(0,3,t.x),i.set(1,3,t.y),i.set(2,3,t.z),r=i.multiply(this),r}rotateX(t,e){return this.rotate3D(t,Lt.AXIS2DX,e)}rotateY(t,e){return this.rotate3D(t,Lt.AXIS2DY,e)}rotateZ(t,e){return this.rotate3D(t,Lt.AXIS2DZ,e)}rotate2D(t,e){return this.rotateZ(t,e)}rotate3D(t,e,r){let i=r||new ft;return i=this.createRotateMatrix3D(t,e).multiply(this),i}rotateByQuaternion(t,e){let r=e||new ft;return r=t.toMatrix().multiply(this),r}scale2D(t,e,r){let i=r||new ft;return i=this.createScaleMatrix2D(t,e).multiply(this),i}scale3D(t,e,r,i){let n=i||new ft;return n=this.createScaleMatrix3D(t,e,r).multiply(this),n}createRotateMatrix3D(t,e){const r=this.identity();return e==Lt.AXIS2DX&&(r.set(1,1,q.cos(t)),r.set(1,2,-q.sin(t)),r.set(2,1,q.sin(t)),r.set(2,2,q.cos(t))),e==Lt.AXIS2DY&&(r.set(0,0,q.cos(t)),r.set(0,2,q.sin(t)),r.set(2,0,-q.sin(t)),r.set(2,2,q.cos(t))),e==Lt.AXIS2DZ&&(r.set(0,0,q.cos(t)),r.set(0,1,-q.sin(t)),r.set(1,0,q.sin(t)),r.set(1,1,q.cos(t))),r}createScaleMatrix2D(t,e){const r=this.identity();return r.set(0,0,t),r.set(1,1,e),r}createScaleMatrix3D(t,e,r){const i=this.identity();return i.set(0,0,t),i.set(1,1,e),i.set(2,2,r),i}}const ke={2:Rt,3:kt,4:ft};class Tt{static identity22(){return new Rt().identity()}static identity33(){return new kt().identity()}static identity44(){return new ft().identity()}static add(t,e){if(!this.checkSizeEqual(t,e))throw new Error("Not Equal Matrix Dimension. Cannot Calculate!");const r=this.createMatrixInstance(t.size);return t.add(e,r),r}static sub(t,e){if(!this.checkSizeEqual(t,e))throw new Error("Not Equal Matrix Dimension. Cannot Calculate!");const r=this.createMatrixInstance(t.size);return t.sub(e,r),r}static multiply(t,e){const r=this.createMatrixInstance(t.size);if(e instanceof Et){if(t.col!=e.row)throw new Error("Not Equal A Row Number and B Col Number. Cannot Multiply!");t.multiply(e,r)}else t.multiply(e,r);return r}static div(t,e){if(e==0)throw new Error("b is zero. Cannot Divide!");const r=this.createMatrixInstance(t.size);return t.div(e,r),r}static translate2D(t,e){return t.translate2D(e)}static translate3D(t,e){return t.translate3D(e)}static rotate2D(t,e){return t.rotate2D(e)}static rotate3D(t,e,r){return t.rotate3D(e,r)}static rotateByQuaternion(t,e){return t.rotateByQuaternion(e)}static scale2D(t,e,r){return t.scale2D(e,r)}static scale3D(t,e,r,i){return t.scale3D(e,r,i)}static transpose(t){return t.transpose()}static inverse(t){return t.inverse()}static orthographic(t,e,r,i,n,s){let a=new ft;return a=a.orthographic(t,e,r,i,n,s,a),a}static perspective(t,e,r,i,n){let s=new ft;return s=s.perspective(t,e,r,i,n,s),s}static lookAt(t,e,r){let i=new ft;return i=i.lookAt(t,e,r,i),i}static checkSizeEqual(t,e){return t.col!=e.col||t.row!=e.row?(console.log(`col: ${t.col},${e.col}`),console.log(`row: ${t.row},${e.row}`),!1):!0}static createMatrixInstance(t){const e=ke[t];if(!e)throw new Error("Unsupport matrix size");return new e}}class Yt{constructor(t,e,r,i){A(this,"components");this.components=new Float32Array([t,e,r,i])}get x(){return this.components[0]}get y(){return this.components[1]}get z(){return this.components[2]}get w(){return this.components[3]}toMatrix(){let e=new ft().identity();return e.set(0,0,1-2*Math.pow(this.y,2)-2*Math.pow(this.z,2)),e.set(0,1,2*this.x*this.y-2*this.z*this.w),e.set(0,2,2*this.x*this.z+2*this.y*this.w),e.set(1,0,2*this.x*this.y+2*this.z*this.w),e.set(1,1,1-2*Math.pow(this.x,2)-2*Math.pow(this.z,2)),e.set(1,2,2*this.y*this.z-2*this.x*this.w),e.set(2,0,2*this.x*this.z-2*this.y*this.w),e.set(2,1,2*this.y*this.z+2*this.x*this.w),e.set(2,2,1-2*Math.pow(this.x,2)-2*Math.pow(this.y,2)),e}toEuler(){const t=this.toMatrix(),e=Math.atan2(t.get(0,2),t.get(2,2)),r=Math.asin(-t.get(2,0)),i=Math.atan2(t.get(2,1),t.get(2,2));return{pitch:e,yaw:r,roll:i}}}class ht{static create(t,e,r,i){return new Yt(t,e,r,i)}static createFromEuler(t,e,r){const i=ht.create(0,-q.sin(e*.5),0,q.cos(e*.5)),n=ht.create(-q.sin(t*.5),0,0,q.cos(t*.5)),s=ht.create(0,0,-q.sin(r*.5),q.cos(r*.5)),a=ht.multiply(i,n);return ht.multiply(a,s)}static createFromAxisAndRadians(t,e){const r=lt.normalize(t),i=e*.5,n=q.sin(i);return ht.create(r.x*n,r.y*n,r.z*n,q.cos(i))}static identity(){return new Yt(0,0,0,1)}static add(t,e){const r=t.x+e.x,i=t.y+e.y,n=t.z+e.z,s=t.w+e.w;return ht.create(r,i,n,s)}static sub(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.z-e.z,s=t.w-e.w;return ht.create(r,i,n,s)}static multiply(t,e){const r=t.w*e.w-t.x*e.x-t.y*e.y-t.z*e.z,i=t.w*e.x+t.x*e.w+t.y*e.z-t.z*e.y,n=t.w*e.y+t.y*e.w+t.z*e.x-t.x*e.z,s=t.w*e.z+t.z*e.w+t.x*e.y-t.y*e.x;return ht.create(i,n,s,r)}static scale(t,e){const r=t.x*e,i=t.y*e,n=t.z*e,s=t.w*e;return ht.create(r,i,n,s)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static conjugate(t){return ht.create(-t.x,-t.y,-t.z,t.w)}static normalize(t){const e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);if(e==0)throw new Error("Zero length quaternion. Cannot normalize!!");const r=1/e;return ht.scale(t,r)}static inverse(t){const e=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;if(e==0)throw new Error("Zero length quaternion. Cannot inverse!!");const r=1/e,i=ht.conjugate(t);return ht.scale(i,r)}static rotateVector(t,e){const r=ht.toQuaternion(e),i=ht.inverse(t),n=ht.multiply(t,r),s=ht.multiply(n,i);return new pt(s.x,s.y,s.z)}static slerp(t,e,r){let i=ht.dot(t,e);i<0&&(e=ht.scale(e,-1),i*=-1);const n=Math.acos(i),s=q.sin(n);if(s==0){const a=ht.scale(t,1-r),l=ht.scale(e,r);return ht.add(a,l)}else{const a=ht.scale(t,q.sin(n*(1-r))/s),l=ht.scale(e,q.sin(n*r)/s);return ht.add(a,l)}}static toQuaternion(t){return ht.create(t.x,t.y,t.z,0)}}class Re{constructor(){A(this,"position");A(this,"scale");A(this,"rotation");A(this,"localMatrix");A(this,"worldMatrix");A(this,"isRequiredRecalculation");this.position=new pt(0,0,0),this.scale=new pt(1,1,1),this.rotation=ht.identity(),this.localMatrix=Tt.identity44(),this.worldMatrix=Tt.identity44(),this.isRequiredRecalculation=!1}updateMatrix(t=void 0){this.isRequiredRecalculation&&(this.calculateLocalMatrix(),this.calculateWorldMatrix(t),this.isRequiredRecalculation=!1)}getWorldMatrix(){return this.worldMatrix}setPosition(t){this.position=t,this.isRequiredRecalculation=!0}setScale(t){this.scale=t,this.isRequiredRecalculation=!0}setRotation(t){this.rotation=t,this.isRequiredRecalculation=!0}getWorldPosition(){return new pt(this.worldMatrix.get(0,3),this.worldMatrix.get(1,3),this.worldMatrix.get(2,3))}calculateLocalMatrix(){this.localMatrix=Tt.identity44(),this.localMatrix=Tt.scale3D(this.localMatrix,this.scale.x,this.scale.y,this.scale.z),this.localMatrix=Tt.rotateByQuaternion(this.localMatrix,this.rotation),this.localMatrix=Tt.translate3D(this.localMatrix,this.position)}calculateWorldMatrix(t){t===void 0?this.worldMatrix=this.localMatrix:this.worldMatrix=Tt.multiply(t,this.localMatrix)}}class he{static generateId(t){const e=t.substring(0,t.length-4),r=this.counters.get(e)??0;return this.counters.set(e,r+1),`${e}_${r}`}}A(he,"counters",new Map);class $t{constructor(t=""){A(this,"id");A(this,"parent");A(this,"children");A(this,"transform");this.transform=new Re,this.children=[];const e=this.constructor;this.id=t!==""?t:he.generateId(e.name)}addChild(t){t!==this&&t.setParent(this)}removeChild(t){t.parent===this&&t.setParent(void 0)}getChildren(){return this.children}getId(){return this.id}getTransform(){return this.transform}setParent(t){if(this.parent!=t){if(this.parent!==void 0){const e=this.parent.children.indexOf(this);e!==-1&&this.parent.children.splice(e,1)}this.parent=t,t!==void 0&&!t.children.includes(this)&&t.children.push(this)}}}class Fe extends $t{update(){var t;this.transform.updateMatrix((t=this.parent)==null?void 0:t.getTransform().getWorldMatrix());for(const e of this.children)e.update()}draw(t,e){for(const r of this.children)r.draw(t,e)}}class fr{constructor(){A(this,"root");this.root=new Fe}update(){this.root.update()}draw(t,e){this.root.draw(t,e)}getGraph(){return this.root}}class At{constructor(t,e,r,i=255){A(this,"r");A(this,"g");A(this,"b");A(this,"a");this.r=q.clamp(t,0,255),this.g=q.clamp(e,0,255),this.b=q.clamp(r,0,255),this.a=q.clamp(i,0,255)}get red(){return this.r}get green(){return this.g}get blue(){return this.b}get alpha(){return this.a}translateTo01(){const t=Number.parseFloat((this.r/255).toFixed(3)),e=Number.parseFloat((this.g/255).toFixed(3)),r=Number.parseFloat((this.b/255).toFixed(3)),i=Number.parseFloat((this.a/255).toFixed(3));return new bt(t,e,r,i)}translateToColorCode(){const t=e=>e.toString(16).padStart(2,"0").toUpperCase();return`#${t(this.r)}${t(this.g)}${t(this.b)}`}}class bt{constructor(t,e,r,i=1){A(this,"r");A(this,"g");A(this,"b");A(this,"a");this.r=q.clamp(t,0,1),this.g=q.clamp(e,0,1),this.b=q.clamp(r,0,1),this.a=q.clamp(i,0,1)}static empty(){return new bt(0,0,0,0)}static isEmpty(t){return t.red==0&&t.green==0&&t.blue==0&&t.alpha==0}get red(){return this.r}get green(){return this.g}get blue(){return this.b}get alpha(){return this.a}get toRGBArray(){return new Float32Array([this.r,this.g,this.b])}get toRGBAArray(){return new Float32Array([this.r,this.g,this.b,this.a])}getRgbToVector3(){return new pt(this.r,this.g,this.b)}toVector4(){return new jt(this.r,this.g,this.b,this.a)}translateTo255(){const t=Math.round(this.r*255),e=Math.round(this.g*255),r=Math.round(this.b*255),i=Math.round(this.a*255);return new At(t,e,r,i)}}const pr={RED:new bt(1,0,0),GREEN:new bt(0,1,0),BLUE:new bt(0,0,1),WHITE:new bt(1,1,1),BLACK:new bt(0,0,0)},ze={COLOR_EMPTY:new At(0,0,0,0),COLOR_SUBARU:new At(174,180,156,255),COLOR_NOCTCHILL:new At(56,77,152,255),COLOR_TORU:new At(80,208,208,255),COLOR_MADOKA:new At(190,30,62,255),COLOR_KOITO:new At(121,103,195,255),COLOR_HINANA:new At(255,198,57,255),COLOR_HARUKI:new At(234,215,164,255),COLOR_CHINA:new At(246,139,31,255),COLOR_SENA:new At(246,174,84,255),COLOR_LILJA:new At(234,253,255,255),COLOR_SUMIKA:new At(124,252,0,255)},mr={COLOR_EMPTY:"#000000",COLOR_SUBARU:"#aeb49c",COLOR_NOCTCHILL:"#384d98",COLOR_TORU:"#50d0d0",COLOR_MADOKA:"#be1e3e",COLOR_KOITO:"#7967c3",COLOR_HINANA:"#ffc639",COLOR_HARUKI:"#ead7a4",COLOR_CHINA:"#f68b1f",COLOR_SENA:"#f6ae54",COLOR_LILJA:"#eafdff",COLOR_SUMIKA:"#7cfc00"};class Xt{static hexToColor255(t){const r=/^#([0-9A-Fa-f]{6})$/.exec(t);if(!r)return ze.COLOR_EMPTY;let i=r[1];const n=parseInt(i.slice(0,2),16),s=parseInt(i.slice(2,4),16),a=parseInt(i.slice(4,6),16);return new At(n,s,a)}static hexToColor01(t){return this.hexToColor255(t).translateTo01()}static hsvToRgb(t,e,r,i){if(e>1||r>1||i>1)return bt.empty();var n=t%360,s=Math.floor(n/60),a=n/60-s,l=r*(1-e),p=r*(1-e*a),b=r*(1-e*(1-a)),f=new Array;if(!(e>0)&&!(e<0))f.push(r,r,r,i);else{var _=new Array(r,p,l,l,b,r),c=new Array(b,r,r,p,l,l),v=new Array(l,l,b,r,r,p);f.push(_[s],c[s],v[s],i)}return new bt(f[0],f[1],f[2],f[3])}}const mt={CURRENT_FRAME:0,PREV_FRAME:1,FONT_ATLAS:2,BLOOM_FRAME:3};class ct{constructor(t,e="float"){A(this,"values");A(this,"type");this.values=this.getValue(t),this.type=this.getType(t,e)}getUniformValues(){return this.values}getUniformType(){return this.type}getValue(t){if(typeof t=="number")return t;if(Array.isArray(t))return t;if(t instanceof Et)return t.toArray();if(t instanceof Nt)return t.values;if(t instanceof Float32Array)return t;if(t instanceof Int32Array)return t;throw new Error("Invalid uniform values type")}getType(t,e){if(typeof t=="number")return this.isFloat(e)?"1f":"1i";if(Array.isArray(t))switch(t.length){case 1:return this.isFloat(e)?"1fv":"1iv";case 2:return this.isFloat(e)?"2fv":"2iv";case 3:return this.isFloat(e)?"3fv":"3iv";case 4:return this.isFloat(e)?"4fv":"4iv";default:throw new Error("Invalid uniform values type")}else if(t instanceof Nt)switch(t.size){case 1:return this.isFloat(e)?"1fv":"1iv";case 2:return this.isFloat(e)?"2fv":"2iv";case 3:return this.isFloat(e)?"3fv":"3iv";case 4:return this.isFloat(e)?"4fv":"4iv";default:throw new Error("Invalid uniform values type")}else if(t instanceof Et)switch(t.size){case 2:return"Matrix2fv";case 3:return"Matrix3fv";case 4:return"Matrix4fv";default:throw new Error("Invalid uniform values type")}else if(t instanceof Float32Array)switch(t.length){case 2:return"2fv";case 3:return"3fv";case 4:return"4fv";default:return"1fv"}else if(t instanceof Int32Array)switch(t.length){case 2:return"2iv";case 3:return"3iv";case 4:return"4iv";default:return"1iv"}else throw new Error("Invalid uniform values type")}isFloat(t){return t=="float"}}class Ct{constructor(t){A(this,"shaderProgram");this.shaderProgram=t}use(t,e){e.isCurrentShaderProgramSame(this.shaderProgram)||(this.shaderProgram.use(t),e.setCurrentShaderProgram(this.shaderProgram))}getAttribute(t,e){return this.shaderProgram.getAttribute(t,e)}cleanup(){}}class Pe extends Ct{constructor(e,r,i=10){super(e);A(this,"isVertical");A(this,"blurCoefficients");this.isVertical=r,this.blurCoefficients=q.calculateGaussianCoefficients(i,32)}setUniform(e,r){this.shaderProgram.setUniform(e,"mvpMatrix",r.mvpMatrix),this.shaderProgram.setUniform(e,"blurDirection",new ct(this.isVertical?1:0,"int")),this.shaderProgram.setUniform(e,"gCoefficients",new ct(this.blurCoefficients)),this.shaderProgram.setUniform(e,"texResolution",r.texResolution),this.shaderProgram.setUniform(e,"blurStrength",r.blurStrength),this.shaderProgram.setUniform(e,"tex",new ct(mt.CURRENT_FRAME,"int"))}}class Me extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"brightThreshold",e.brightThreshold),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int"))}}class De extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"bloomStrength",e.bloomStrength),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int")),this.shaderProgram.setUniform(t,"brightTex",new ct(mt.BLOOM_FRAME,"int"))}}class Oe extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"time",e.time),this.shaderProgram.setUniform(t,"resolution",e.resolution)}}class Be extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int"))}}class Ue extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"time",e.time),this.shaderProgram.setUniform(t,"glitchCoef",e.glitchCoef),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int"))}}class Le extends Ct{constructor(e,r,i,n){super(e);A(this,"lightDirection");A(this,"eyeDirection");A(this,"ambientColor");this.lightDirection=r,this.eyeDirection=i,this.ambientColor=n}setLightDirection(e){this.lightDirection=e}setEyeDirection(e){this.eyeDirection=e}setAmbientColor(e){this.ambientColor=e}setUniform(e,r){for(const i in r)this.shaderProgram.setUniform(e,i,r[i]);this.shaderProgram.setUniform(e,"lightDirection",new ct(this.lightDirection)),this.shaderProgram.setUniform(e,"eyeDirection",new ct(this.eyeDirection)),this.shaderProgram.setUniform(e,"ambientColor",new ct(this.ambientColor.toVector4()))}}class Ie extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int"))}}class Ne extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"mosaicSize",e.mosaicSize),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int"))}}const Kt={Directional:1,Point:2};class je extends Ct{constructor(t){super(t)}setUniform(t,e){for(const r in e)this.shaderProgram.setUniform(t,r,e[r])}setLightUniform(t,e){if(e.lightType==Kt.Directional){const r=e;this.shaderProgram.setUniform(t,"lightDirection",new ct(r.direction)),this.shaderProgram.setUniform(t,"ambientColor",new ct(r.color.toVector4())),this.shaderProgram.setUniform(t,"lightType",new ct(r.lightType,"int"))}else if(e.lightType==Kt.Point){const r=e;this.shaderProgram.setUniform(t,"lightPosition",new ct(r.position)),this.shaderProgram.setUniform(t,"ambientColor",new ct(r.color.toVector4())),this.shaderProgram.setUniform(t,"lightType",new ct(r.lightType,"int"))}}}class $e extends Ct{constructor(t){super(t)}setUniform(t,e){this.shaderProgram.setUniform(t,"mvpMatrix",e.mvpMatrix),this.shaderProgram.setUniform(t,"shiftOffset",e.shiftOffset),this.shaderProgram.setUniform(t,"tex",new ct(mt.CURRENT_FRAME,"int"))}}class Ge extends Ct{constructor(e,r,i){super(e);A(this,"texture");A(this,"texIndex");this.texture=r,this.texIndex=i}setUniform(e,r){for(const i in r)this.shaderProgram.setUniform(e,i,r[i]);this.texture.bind(this.texIndex),this.shaderProgram.setUniform(e,"tex",new ct(this.texIndex,"int"))}cleanup(){this.texture.unbind()}}class gr extends Ct{constructor(e,r,i,n){super(e);A(this,"fontTexture");A(this,"smoothness");A(this,"fontColor");this.fontTexture=r,this.smoothness=i,this.fontColor=n}setUniform(e,r){this.fontTexture.bind(mt.FONT_ATLAS),this.shaderProgram.setUniform(e,"mvpMatrix",r.mvpMatrix),this.shaderProgram.setUniform(e,"tex",new ct(mt.FONT_ATLAS,"int")),this.shaderProgram.setUniform(e,"smoothness",new ct(this.smoothness)),this.shaderProgram.setUniform(e,"fontColor",new ct(this.fontColor))}cleanup(){this.fontTexture.unbind()}}class Ve extends Ct{constructor(t){super(t)}setUniform(t,e){for(const r in e)this.shaderProgram.setUniform(t,r,e[r])}}class Jt{static init(t,e,r){this.shaderLoader=t,this.textureLoader=e,this.textFontLoader=r}static fragmentCanvasMaterial(t){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const e=this.shaderLoader.getShaderProgram(t);return new Oe(e)}static texturedMaterial(t,e){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const r=this.shaderLoader.getShaderProgram("texture"),i=this.textureLoader.getTexture(t);return new Ge(r,i,e)}static texturedTextMaterial(t,e){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const r=this.shaderLoader.getShaderProgram("text"),i=this.textFontLoader.getTextureForCurrentFont(),n=Xt.hexToColor01(e).toRGBAArray;return new gr(r,i,t,n)}static frameBufferTextureMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("framebuffer");return new Be(t)}static grayScaleMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("grayScale");return new Ie(t)}static singleDirectionBlurMaterial(t,e){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const r=this.shaderLoader.getShaderProgram("blur");return new Pe(r,t,e)}static brightMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("bright");return new Me(t)}static composeMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("compose");return new De(t)}static mosaicMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("mosaic");return new Ne(t)}static rgbShiftMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("rgbShift");return new $e(t)}static glitchMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("glitch");return new Ue(t)}static unlitMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("unlit");return new Ve(t)}static phongMaterial(){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const t=this.shaderLoader.getShaderProgram("phongLighting");return new je(t)}static gouraudMaterial(t,e,r){if(!this.shaderLoader)throw new Error("MaterialFac†ory not initialized. Call init!!");const i=this.shaderLoader.getShaderProgram("gouraudLighting"),n=t??new pt(-.5,.5,.5),s=e??new pt(0,0,20),a=r??Xt.hexToColor01("#000000");return new Le(i,n,s,a)}}A(Jt,"shaderLoader"),A(Jt,"textureLoader"),A(Jt,"textFontLoader");const Gt={RENDER_TARGET_A:0,RENDER_TARGET_B:1,PREV_FRAME_RENDER_TARGET:2,BLUR_RENDER_TARGET_HALF:3,BLUR_RENDER_TARGET_QUARTER:4,BLOOM_TEMP_RENDER_TARGET_BRIGHT:5,BLOOM_TEMP_RENDER_TARGET_BLUR_H:6,BLOOM_TEMP_RENDER_TARGET_BLUR_V:7,BLOOM_RENDER_TARGET:8};class We{constructor(){A(this,"rendererFlows");this.rendererFlows=[]}addFlow(t){this.rendererFlows.push(t)}render(t,e){let r=e.getRenderTargetFromPool(Gt.RENDER_TARGET_A),i=e.getRenderTargetFromPool(Gt.RENDER_TARGET_B),n=i,s=r;for(const a of this.rendererFlows)n=a.render(t,e,n,s),s=s===r?i:r}}class He{constructor(){A(this,"camera");A(this,"lights",[]);A(this,"globalUniforms",{});A(this,"currentShaderProgram");A(this,"renderTargetPool",new Map)}getRenderTargetFromPool(t){if(this.renderTargetPool.has(t))return this.renderTargetPool.get(t)}addRenderTargetToPool(t,e){this.renderTargetPool.set(t,e)}setCamera(t){this.camera=t}getCamera(){return this.camera}updateGlobalUniform(t,e){this.globalUniforms[t]=e}getGlobalUniform(){return this.globalUniforms}setCurrentShaderProgram(t){this.currentShaderProgram=t}isCurrentShaderProgramSame(t){return this.currentShaderProgram===void 0?!1:this.currentShaderProgram===t}setLights(t){this.lights=t}getLights(){return this.lights}}class ce{constructor(t,e){A(this,"gl");A(this,"texture");A(this,"image");this.gl=t,this.setUpTexture(e)}bind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}getTextureSize(){return this.image?{width:this.image.width,height:this.image.height}:{width:0,height:0}}setUpTexture(t){this.texture=this.gl.createTexture(),this.image=new Image,this.image.onload=()=>{const{gl:e,image:r,texture:i}=this;e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},this.image.src=t}}class Ze{constructor(t,e,r){A(this,"char");A(this,"uv");A(this,"resolution");A(this,"offset");A(this,"xAdvance");this.char=t.char,this.uv={u0:t.x/e,v0:t.y/r,u1:(t.x+t.width)/e,v1:(t.y+t.height)/r},this.resolution=[t.width,t.height],this.offset=[t.xoffset,t.yoffset],this.xAdvance=t.xadvance}getChar(){return this.char}getUv(){return this.uv}getResolution(){return this.resolution}getOffset(){return this.offset}getXAdvance(){return this.xAdvance}}class Ye{constructor(t){A(this,"gl");A(this,"sdfFontTextureCache",new Map);A(this,"sdfFontGlyphCache",new Map);A(this,"currentUseFontName");this.gl=t,this.currentUseFontName=""}setCurrentUseFontName(t){if(!this.sdfFontGlyphCache.has(t))throw new Error(`Font with name ${t} not found`);this.currentUseFontName=t}getTextureForCurrentFont(){if(this.currentUseFontName==="")throw new Error("Current use font name is not set");return this.sdfFontTextureCache.get(this.currentUseFontName)}getGlyphsFromText(t){if(this.currentUseFontName==="")throw new Error("Current use font name is not set");const e=this.sdfFontGlyphCache.get(this.currentUseFontName),r=[];for(const i of t){const n=e.get(i);n&&r.push(n)}return r}async loadTextFontFromPath(t,e){var l;const r=new ce(this.gl,t);let i=(l=t.split("/").pop())==null?void 0:l.split(".").shift();this.sdfFontTextureCache.set(i,r),console.log("loadTextFontTextureFromPath done"),console.log(this.sdfFontTextureCache);const n=await fetch(e),s=JSON.parse(await n.text()),a=new Map;for(const p of s.chars){const b=new Ze(p,r.getTextureSize().width,r.getTextureSize().height);a.set(p.char,b)}this.sdfFontGlyphCache.set(i,a),console.log("loadTextFontDataFromPath done"),console.log(this.sdfFontGlyphCache)}}const vr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),_r=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),wr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),br=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
\r
out vec4 vColor;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),yr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),xr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Er=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec3 aNormal;\r
\r
uniform mat4 mvpMatrix;\r
uniform mat4 invMatrix;\r
uniform vec3 lightDirection;\r
uniform vec3 eyeDirection;\r
uniform vec4 ambientColor;\r
\r
out vec4 vColor;\r
\r
void main(void){\r
    vec3 invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\r
    vec3 invEye = normalize(invMatrix * vec4(eyeDirection, 0.0)).xyz;\r
    vec3 halfLEVec = normalize(invLight + invEye);\r
    float diffuse = clamp(dot(aNormal, invLight), 0.0, 1.0);\r
    float specular = pow(clamp(dot(aNormal, halfLEVec), 0.0, 1.0), 50.0);\r
    vec4 light = aColor * vec4(vec3(diffuse), 1.0) + vec4(vec3(specular), 1.0);\r
    vColor = light + ambientColor;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Ar=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Cr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Sr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec3 aNormal;\r
\r
uniform mat4 mvpMatrix;\r
uniform mat4 modelMatrix;\r
\r
out vec3 vPosition;\r
out vec4 vColor;\r
out vec3 vNormal;\r
\r
void main(void){\r
    vPosition = (modelMatrix * vec4(aPosition, 1.0)).xyz;\r
    vColor = aColor;\r
    vNormal = aNormal;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Tr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),kr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Rr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
in vec2 aUv;\r
\r
out vec4 vColor;\r
out vec2 vUv;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    vUv = aUv;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Fr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
\r
in vec3 aPosition;\r
in vec4 aColor;\r
\r
out vec4 vColor;\r
\r
uniform mat4 mvpMatrix;\r
\r
void main(void){\r
    vColor = aColor;\r
    gl_Position = mvpMatrix * vec4(aPosition, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),zr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform vec2 texResolution;\r
uniform float gCoefficients[32];\r
uniform int blurDirection;\r
uniform float blurStrength;\r
\r
#define TABLE_SIZE 32\r
\r
out vec4 outputColor;\r
\r
void main() {\r
	vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
	vec4 blurAppliedColor = vec4(0.0);\r
	bool isVertical = (blurDirection == 1);\r
	for(int i = 0; i < TABLE_SIZE; i++){\r
		vec2 offset = vec2(0.0);\r
		if(isVertical)\r
		{\r
			offset.x = 0.0;\r
			offset.y = float(i) - float(TABLE_SIZE - 1) / 2.0;\r
		}\r
		else\r
		{\r
			offset.x = float(i) - float(TABLE_SIZE - 1) / 2.0;\r
			offset.y = 0.0;\r
		}\r
		offset *= blurStrength;\r
		vec2 inverseResolution = 1.0 / texResolution;\r
		vec4 texColor = texture(tex, uv + offset * inverseResolution);\r
		blurAppliedColor += texColor * gCoefficients[i];\r
	}\r
	outputColor = blurAppliedColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Pr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform float brightThreshold;\r
\r
const vec3 brightCoef = vec3(0.2126729, 0.7151522, 0.0721750);\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec4 texColor = texture(tex, uv);\r
    float luminance = dot(texColor.rgb, brightCoef);\r
    vec3 bright = vec3(luminance > brightThreshold ? luminance : 0.0);\r
    outputColor = vec4(vec3(bright), 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Mr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform sampler2D brightTex;\r
uniform float bloomStrength;\r
\r
out vec4 outputColor;\r
\r
vec3 toLinear(vec3 c) {\r
    return pow(c, vec3(2.2));\r
}\r
\r
vec3 toGamma(vec3 c) {\r
    return pow(c, vec3(1.0 / 2.2));\r
}\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec3 texColor = toLinear(texture(tex, uv).rgb);\r
    vec3 bloomTexColor = toLinear(texture(brightTex, uv).rgb);\r
\r
    vec3 color = texColor + bloomTexColor * bloomStrength;\r
    color = toGamma(color);\r
    outputColor = vec4(color, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Dr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    outputColor = vColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Or=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec4 texColor = texture(tex, uv);\r
    outputColor = vColor * texColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Br=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform float time;\r
uniform float glitchCoef;\r
\r
out vec4 outputColor;\r
\r
float rand(vec2 co){\r
    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453) * 2.0 - 1.0;\r
}\r
\r
float offset(float blocks, vec2 uv) {\r
	return rand(vec2(time, floor(uv.y * blocks)));\r
}\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec4 texColor = texture(tex, uv);\r
    \r
	texColor.r = texture(tex, uv + vec2(offset(16.0, uv) * glitchCoef, 0.0)).r;	\r
	texColor.g = texture(tex, uv + vec2(offset(8.0, uv) * glitchCoef * 0.16666666, 0.0)).g;\r
	texColor.b = texture(tex, uv + vec2(offset(8.0, uv) * glitchCoef, 0.0)).b;\r
\r
    outputColor = texColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Ur=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    outputColor = vColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Lr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
\r
out vec4 outputColor;\r
\r
const vec3 grayScaleCoef = vec3(0.299, 0.587, 0.114);\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec4 texColor = texture(tex, uv);\r
    float grayColor = dot(texColor.rgb, grayScaleCoef);\r
    outputColor = vec4(vec3(grayColor), 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),Ir=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform float mosaicSize;\r
\r
out vec4 outputColor;\r
\r
vec2 boxelUv(vec2 uv, float size){\r
    uv *= size;\r
    vec2 iPos = floor(uv);\r
    iPos /= size;\r
\r
    return iPos;\r
}\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec4 texColor = texture(tex, boxelUv(uv, mosaicSize));\r
    outputColor = texColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Nr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec3 vPosition;\r
in vec4 vColor;\r
in vec3 vNormal;\r
\r
uniform mat4 invMatrix;\r
uniform vec3 lightDirection;\r
uniform vec3 lightPosition;\r
uniform vec3 eyeDirection;\r
uniform vec4 ambientColor;\r
uniform int lightType;\r
\r
out vec4 outputColor;\r
\r
vec3 calculateInvLight(){\r
    vec3 lightVec = lightDirection;\r
    \r
    if(lightType == 2){\r
        // 点光源\r
        lightVec = lightPosition - vPosition;\r
    }\r
\r
    return normalize(invMatrix * vec4(lightVec, 0.0)).xyz;\r
}\r
\r
void main(void){\r
    vec3 invLight = calculateInvLight();\r
    vec3 invEye = normalize(invMatrix * vec4(eyeDirection, 0.0)).xyz;\r
    vec3 halfLEVec = normalize(invLight + invEye);\r
    float diffuse = clamp(dot(vNormal, invLight), 0.0, 1.0);\r
    float specular = pow(clamp(dot(vNormal, halfLEVec), 0.0, 1.0), 50.0);\r
    vec4 destColor = vColor * vec4(vec3(diffuse), 1.0) + vec4(vec3(specular), 1.0) + ambientColor;\r
    outputColor = destColor;\r
}`},Symbol.toStringTag,{value:"Module"})),jr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform float shiftOffset;\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    vec2 uv = vec2(vUv.x, 1.0 - vUv.y);\r
    vec4 texColorR = texture(tex, vec2(uv - vec2(shiftOffset)));\r
    vec4 texColorG = texture(tex, vec2(uv));\r
    vec4 texColorB = texture(tex, vec2(uv + vec2(shiftOffset)));\r
    outputColor = vec4(texColorR.r, texColorG.g, texColorB.b, 1.0);\r
}`},Symbol.toStringTag,{value:"Module"})),$r=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
uniform vec4 fontColor;\r
uniform float smoothness;\r
\r
out vec4 outputColor;\r
\r
float median(float r, float g, float b) {\r
    return max(min(r, g), min(max(r, g), b));\r
}\r
\r
void main(void){\r
    vec3 texColor = texture(tex, vUv).rgb;\r
    float textSdf = median(texColor.r, texColor.g, texColor.b);\r
\r
    float width = fwidth(textSdf);\r
    float alpha = smoothstep(0.5 - width - smoothness, 0.5 + width + smoothness, textSdf);\r
    outputColor = mix(vec4(0.0), fontColor, alpha);\r
}`},Symbol.toStringTag,{value:"Module"})),Gr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
in vec2 vUv;\r
\r
uniform sampler2D tex;\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    vec4 texColor = texture(tex, vUv);\r
    outputColor = vColor * texColor;\r
}`},Symbol.toStringTag,{value:"Module"})),Vr=Object.freeze(Object.defineProperty({__proto__:null,default:`#version 300 es\r
precision highp float;\r
\r
in vec4 vColor;\r
\r
out vec4 outputColor;\r
\r
void main(void){\r
    outputColor = vColor;\r
}`},Symbol.toStringTag,{value:"Module"}));class Xe{constructor(t,e,r){A(this,"location");this.location=t.getAttribLocation(e,r),this.location===-1&&console.error(`Failed to get the storage location of ${r}`)}setAttributeBuffer(t,e,r,i,n){this.location!==-1&&(t.vertexAttribPointer(this.location,e,r,!1,i,n),t.enableVertexAttribArray(this.location))}}class Ke{constructor(t,e,r){A(this,"gl");A(this,"location");this.gl=t,this.location=t.getUniformLocation(e,r),this.location===null&&console.error(`Failed to get the storage location of ${r}`)}setUniform(t,e){if(this.location!==null)switch(e){case"1f":this.gl.uniform1f(this.location,t);break;case"1fv":this.gl.uniform1fv(this.location,t);break;case"1i":this.gl.uniform1i(this.location,t);break;case"1iv":this.gl.uniform1iv(this.location,t);break;case"2f":this.gl.uniform2f(this.location,t,t);break;case"2fv":this.gl.uniform2fv(this.location,t);break;case"2i":this.gl.uniform2i(this.location,t,t);break;case"2iv":this.gl.uniform2iv(this.location,t);break;case"3f":this.gl.uniform3f(this.location,t,t,t);break;case"3fv":this.gl.uniform3fv(this.location,t);break;case"3i":this.gl.uniform3i(this.location,t,t,t);break;case"3iv":this.gl.uniform3iv(this.location,t);break;case"4f":this.gl.uniform4f(this.location,t,t,t,t);break;case"4fv":this.gl.uniform4fv(this.location,t);break;case"4i":this.gl.uniform4i(this.location,t,t,t,t);break;case"4iv":this.gl.uniform4iv(this.location,t);break;case"Matrix2fv":this.gl.uniformMatrix2fv(this.location,!1,t);break;case"Matrix3fv":this.gl.uniformMatrix3fv(this.location,!1,t);break;case"Matrix4fv":this.gl.uniformMatrix4fv(this.location,!1,t);break;default:throw new Error("Unknown uniform type!!")}}}class ue{constructor(t,e,r,i=[]){A(this,"program");A(this,"vertexShader");A(this,"fragmentShader");A(this,"attributes",new Map);A(this,"uniforms",new Map);A(this,"varyings",[]);this.program=this.createProgram(t,e,r,i)}use(t){t.useProgram(this.program)}getProgram(){return this.program}getFragmentShader(){return this.fragmentShader}getAttribute(t,e){return this.attributes.has(e)||this.attributes.set(e,new Xe(t,this.program,e)),this.attributes.get(e)}getUniform(t,e){return this.uniforms.has(e)||this.uniforms.set(e,new Ke(t,this.program,e)),this.uniforms.get(e)}setUniform(t,e,r){this.getUniform(t,e).setUniform(r.getUniformValues(),r.getUniformType())}createProgram(t,e,r,i=[]){const n=t.createProgram();if(this.vertexShader=this.compileShader(t,e,"vert"),this.fragmentShader=this.compileShader(t,r,"frag"),this.varyings=i,t.attachShader(n,this.vertexShader),t.attachShader(n,this.fragmentShader),i.length>0&&t.transformFeedbackVaryings(n,this.varyings,t.SEPARATE_ATTRIBS),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return t.useProgram(n),console.log("Create program success!!"),n;throw alert(t.getProgramInfoLog(n)),new Error("Cannot create program!!")}compileShader(t,e,r){let i=this.createShader(t,r);if(t.shaderSource(i,e),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(i)),new Error("Cannot compile shader!!");return i}createShader(t,e){switch(e){case"vert":return t.createShader(t.VERTEX_SHADER);case"frag":return t.createShader(t.FRAGMENT_SHADER);default:throw new Error("Unknown type shader!!")}}}class Je{constructor(t){A(this,"gl");A(this,"shaderProgramCache",new Map);A(this,"shaderProgramKey",new Set);this.gl=t}getShaderProgram(t){if(!this.shaderProgramKey.has(t))throw new Error(`Common program with key ${t} not found`);return this.shaderProgramCache.get(t)}async loadShaderFromPath(t,e,r=[]){var l;const i=await this.loadShader(t),n=await this.loadShader(e);let s=(l=e.split("/").pop())==null?void 0:l.split(".").shift(),a=new ue(this.gl,i,n,r);this.shaderProgramCache.set(s,a),this.shaderProgramKey.add(s),console.log("loadShaderFromPath done"),console.log(this.shaderProgramCache)}async loadCommonShaders(){const t=Object.assign({"../src/webgl/shader/blur.vert":vr,"../src/webgl/shader/bright.vert":_r,"../src/webgl/shader/compose.vert":wr,"../src/webgl/shader/default.vert":br,"../src/webgl/shader/framebuffer.vert":yr,"../src/webgl/shader/glitch.vert":xr,"../src/webgl/shader/gouraudLighting.vert":Er,"../src/webgl/shader/grayScale.vert":Ar,"../src/webgl/shader/mosaic.vert":Cr,"../src/webgl/shader/phongLighting.vert":Sr,"../src/webgl/shader/rgbShift.vert":Tr,"../src/webgl/shader/text.vert":kr,"../src/webgl/shader/texture.vert":Rr,"../src/webgl/shader/unlit.vert":Fr}),e=Object.assign({"../src/webgl/shader/blur.frag":zr,"../src/webgl/shader/bright.frag":Pr,"../src/webgl/shader/compose.frag":Mr,"../src/webgl/shader/default.frag":Dr,"../src/webgl/shader/framebuffer.frag":Or,"../src/webgl/shader/glitch.frag":Br,"../src/webgl/shader/gouraudLighting.frag":Ur,"../src/webgl/shader/grayScale.frag":Lr,"../src/webgl/shader/mosaic.frag":Ir,"../src/webgl/shader/phongLighting.frag":Nr,"../src/webgl/shader/rgbShift.frag":jr,"../src/webgl/shader/text.frag":$r,"../src/webgl/shader/texture.frag":Gr,"../src/webgl/shader/unlit.frag":Vr}),r=new Map,i=new Map;Object.entries(t).forEach(([n,s])=>{var p;const a=s.default,l=(p=n.split("/").pop())==null?void 0:p.split(".").shift();r.set(l,a),this.shaderProgramKey.add(l)}),Object.entries(e).forEach(([n,s])=>{var p;const a=s.default,l=(p=n.split("/").pop())==null?void 0:p.split(".").shift();i.set(l,a),this.shaderProgramKey.add(l)});for(const n of this.shaderProgramKey){console.log(n);let s=r.get(n),a=i.get(n);if(!s||!a){console.warn(`Shader pair incomplete for key: ${n}`);continue}let l=new ue(this.gl,s,a);this.shaderProgramCache.set(n,l)}console.log("loadCommonShaders done"),console.log(this.shaderProgramCache)}async loadShader(t){try{return await(await fetch(t)).text()}catch(e){throw console.error(e),new Error("Cannot load shader!!")}}}class qe{constructor(t){A(this,"gl");A(this,"textureCache",new Map);A(this,"textureKeySet",new Set);this.gl=t}getTexture(t){if(!this.textureKeySet.has(t))throw new Error(`Common Texture with key ${t} not found`);return this.textureCache.get(t)}async loadTextureFromPath(t){var i;const e=new ce(this.gl,t);let r=(i=t.split("/").pop())==null?void 0:i.split(".").shift();this.textureKeySet.add(r),this.textureCache.set(r,e),console.log("loadTextureFromPath done"),console.log(this.textureCache)}}class Qe{constructor(t){A(this,"gl");this.gl=this.initializeWebGL2RenderingContext(t)}getWebGL2RenderingContext(){return this.gl}clearColor(t){this.gl.clearColor(t.red,t.green,t.blue,t.alpha),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}resizeCanvasToDisplaySize(t){const e=t.clientWidth,r=t.clientHeight,i=t.width!==e||t.height!==r;return i&&(t.width=e,t.height=r),i}setViewport(t){this.resizeCanvasToDisplaySize(t),this.gl.viewport(0,0,t.width,t.height)}initializeWebGL2RenderingContext(t){const e=t.getContext("webgl2");if(e==null)throw new Error("Not Support WebGL2!!");return e}}class tr{constructor(t){A(this,"canvas");A(this,"webglUtility");A(this,"gl");A(this,"shaderLoader");A(this,"textureLoader");A(this,"textFontLoader");A(this,"scene");A(this,"sceneGraph");A(this,"rendererContext");A(this,"audioOutput");A(this,"rendererFlowPipeline");this.canvas=document.getElementById("webgl-canvas"),this.webglUtility=new Qe(this.canvas),this.gl=this.webglUtility.getWebGL2RenderingContext(),this.shaderLoader=new Je(this.gl),this.textureLoader=new qe(this.gl),this.textFontLoader=new Ye(this.gl),this.scene=t,this.rendererContext=new He,this.sceneGraph=new fr,this.audioOutput=new St,this.rendererFlowPipeline=new We}async start(){await this.preload(),Jt.init(this.shaderLoader,this.textureLoader,this.textFontLoader),this.setup(),this.scene.setUpdate(this.update.bind(this)),this.scene.setDraw(this.draw.bind(this)),this.scene.start()}async preload(){await this.shaderLoader.loadCommonShaders()}}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.20.0
 * @author George Michael Brower
 * @license MIT
 */class Pt{constructor(t,e,r,i,n="div"){this.parent=t,this.object=e,this.property=r,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(n),this.domElement.classList.add("controller"),this.domElement.classList.add(i),this.$name=document.createElement("div"),this.$name.classList.add("name"),Pt.nextNameID=Pt.nextNameID||0,this.$name.id=`lil-gui-name-${++Pt.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",s=>s.stopPropagation()),this.domElement.addEventListener("keyup",s=>s.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(r)}name(t){return this._name=t,this.$name.textContent=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled?this:(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t),this)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.getValue()!==t&&(this.object[this.property]=t,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class Wr extends Pt{constructor(t,e,r){super(t,e,r,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function de(F){let t,e;return(t=F.match(/(#|0x)?([a-f0-9]{6})/i))?e=t[2]:(t=F.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?e=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=F.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(e=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),e?"#"+e:!1}const Hr={isPrimitive:!0,match:F=>typeof F=="string",fromHexString:de,toHexString:de},qt={isPrimitive:!0,match:F=>typeof F=="number",fromHexString:F=>parseInt(F.substring(1),16),toHexString:F=>"#"+F.toString(16).padStart(6,0)},Zr=[Hr,qt,{isPrimitive:!1,match:F=>Array.isArray(F),fromHexString(F,t,e=1){const r=qt.fromHexString(F);t[0]=(r>>16&255)/255*e,t[1]=(r>>8&255)/255*e,t[2]=(r&255)/255*e},toHexString([F,t,e],r=1){r=255/r;const i=F*r<<16^t*r<<8^e*r<<0;return qt.toHexString(i)}},{isPrimitive:!1,match:F=>Object(F)===F,fromHexString(F,t,e=1){const r=qt.fromHexString(F);t.r=(r>>16&255)/255*e,t.g=(r>>8&255)/255*e,t.b=(r&255)/255*e},toHexString({r:F,g:t,b:e},r=1){r=255/r;const i=F*r<<16^t*r<<8^e*r<<0;return qt.toHexString(i)}}];function Yr(F){return Zr.find(t=>t.match(F))}class Xr extends Pt{constructor(t,e,r,i){super(t,e,r,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=Yr(this.initialValue),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const n=de(this.$text.value);n&&this._setValueFromHexString(n)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class fe extends Pt{constructor(t,e,r){super(t,e,r,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",i=>{i.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class Kr extends Pt{constructor(t,e,r,i,n,s){super(t,e,r,"number"),this._initInput(),this.min(i),this.max(n);const a=s!==void 0;this.step(a?s:this._getImplicitStep(),a),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=e*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=()=>{let g=parseFloat(this.$input.value);isNaN(g)||(this._stepExplicit&&(g=this._snap(g)),this.setValue(this._clamp(g)))},r=g=>{const x=parseFloat(this.$input.value);isNaN(x)||(this._snapClampSetValue(x+g),this.$input.value=this.getValue())},i=g=>{g.key==="Enter"&&this.$input.blur(),g.code==="ArrowUp"&&(g.preventDefault(),r(this._step*this._arrowKeyMultiplier(g))),g.code==="ArrowDown"&&(g.preventDefault(),r(this._step*this._arrowKeyMultiplier(g)*-1))},n=g=>{this._inputFocused&&(g.preventDefault(),r(this._step*this._normalizeMouseWheel(g)))};let s=!1,a,l,p,b,f;const _=5,c=g=>{a=g.clientX,l=p=g.clientY,s=!0,b=this.getValue(),f=0,window.addEventListener("mousemove",v),window.addEventListener("mouseup",u)},v=g=>{if(s){const x=g.clientX-a,T=g.clientY-l;Math.abs(T)>_?(g.preventDefault(),this.$input.blur(),s=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(x)>_&&u()}if(!s){const x=g.clientY-p;f-=x*this._step*this._arrowKeyMultiplier(g),b+f>this._max?f=this._max-b:b+f<this._min&&(f=this._min-b),this._snapClampSetValue(b+f)}p=g.clientY},u=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",u)},m=()=>{this._inputFocused=!0},d=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",e),this.$input.addEventListener("keydown",i),this.$input.addEventListener("wheel",n,{passive:!1}),this.$input.addEventListener("mousedown",c),this.$input.addEventListener("focus",m),this.$input.addEventListener("blur",d)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=(d,g,x,T,S)=>(d-g)/(x-g)*(S-T)+T,e=d=>{const g=this.$slider.getBoundingClientRect();let x=t(d,g.left,g.right,this._min,this._max);this._snapClampSetValue(x)},r=d=>{this._setDraggingStyle(!0),e(d.clientX),window.addEventListener("mousemove",i),window.addEventListener("mouseup",n)},i=d=>{e(d.clientX)},n=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",n)};let s=!1,a,l;const p=d=>{d.preventDefault(),this._setDraggingStyle(!0),e(d.touches[0].clientX),s=!1},b=d=>{d.touches.length>1||(this._hasScrollBar?(a=d.touches[0].clientX,l=d.touches[0].clientY,s=!0):p(d),window.addEventListener("touchmove",f,{passive:!1}),window.addEventListener("touchend",_))},f=d=>{if(s){const g=d.touches[0].clientX-a,x=d.touches[0].clientY-l;Math.abs(g)>Math.abs(x)?p(d):(window.removeEventListener("touchmove",f),window.removeEventListener("touchend",_))}else d.preventDefault(),e(d.touches[0].clientX)},_=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",_)},c=this._callOnFinishChange.bind(this),v=400;let u;const m=d=>{if(Math.abs(d.deltaX)<Math.abs(d.deltaY)&&this._hasScrollBar)return;d.preventDefault();const x=this._normalizeMouseWheel(d)*this._step;this._snapClampSetValue(this.getValue()+x),this.$input.value=this.getValue(),clearTimeout(u),u=setTimeout(c,v)};this.$slider.addEventListener("mousedown",r),this.$slider.addEventListener("touchstart",b,{passive:!1}),this.$slider.addEventListener("wheel",m,{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:r}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,r=-t.wheelDelta/120,r*=this._stepExplicit?1:10),e+-r}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){let e=0;return this._hasMin?e=this._min:this._hasMax&&(e=this._max),t-=e,t=Math.round(t/this._step)*this._step,t+=e,t=parseFloat(t.toPrecision(15)),t}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class Jr extends Pt{constructor(t,e,r,i){super(t,e,r,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(i)}options(t){return this._values=Array.isArray(t)?t:Object.values(t),this._names=Array.isArray(t)?t:Object.keys(t),this.$select.replaceChildren(),this._names.forEach(e=>{const r=document.createElement("option");r.textContent=e,this.$select.appendChild(r)}),this.updateDisplay(),this}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.textContent=e===-1?t:this._names[e],this}}class qr extends Pt{constructor(t,e,r){super(t,e,r,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",i=>{i.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var Qr=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "↕";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  font-weight: 600;
  padding: 0 var(--padding);
  width: 100%;
  text-align: left;
  background: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "▾";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "▸";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "✓";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  border: none;
}
.lil-gui .controller button {
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
}
@media (hover: hover) {
  .lil-gui .controller button:hover {
    background: var(--hover-color);
  }
  .lil-gui .controller button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui .controller button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function ti(F){const t=document.createElement("style");t.innerHTML=F;const e=document.querySelector("head link[rel=stylesheet], head style");e?document.head.insertBefore(t,e):document.head.appendChild(t)}let er=!1;class ie{constructor({parent:t,autoPlace:e=t===void 0,container:r,width:i,title:n="Controls",closeFolders:s=!1,injectStyles:a=!0,touchStyles:l=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("button"),this.$title.classList.add("title"),this.$title.setAttribute("aria-expanded",!0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(n),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),l&&this.domElement.classList.add("allow-touch-styles"),!er&&a&&(ti(Qr),er=!0),r?r.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this._closeFolders=s}add(t,e,r,i,n){if(Object(r)===r)return new Jr(this,t,e,r);const s=t[e];switch(typeof s){case"number":return new Kr(this,t,e,r,i,n);case"boolean":return new Wr(this,t,e);case"string":return new qr(this,t,e);case"function":return new fe(this,t,e)}console.error(`gui.add failed
	property:`,e,`
	object:`,t,`
	value:`,s)}addColor(t,e,r=1){return new Xr(this,t,e,r)}addFolder(t){const e=new ie({parent:this,title:t});return this.root._closeFolders&&e.close(),e}load(t,e=!0){return t.controllers&&this.controllers.forEach(r=>{r instanceof fe||r._name in t.controllers&&r.load(t.controllers[r._name])}),e&&t.folders&&this.folders.forEach(r=>{r._title in t.folders&&r.load(t.folders[r._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(r=>{if(!(r instanceof fe)){if(r._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${r._name}"`);e.controllers[r._name]=r.save()}}),t&&this.folders.forEach(r=>{if(r._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${r._title}"`);e.folders[r._title]=r.save()}),e}open(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(t){this._closed!==t&&(this._closed=t,this._callOnOpenClose(this))}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const r=n=>{n.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",r))};this.$children.addEventListener("transitionend",r);const i=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=i+"px"})}),this}title(t){return this._title=t,this.$title.textContent=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(r=>r.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),this._onChange!==void 0&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onOpenClose(t){return this._onOpenClose=t,this}_callOnOpenClose(t){this.parent&&this.parent._callOnOpenClose(t),this._onOpenClose!==void 0&&this._onOpenClose.call(this,t)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}class it{static initialize(){this.guiArrays.length>0||this.guiArrays.push(new ie)}static addFolder(t){const r=this.GUI.addFolder(t);this.guiArrays.push(r)}static resetFolder(){this.guiArrays.length<=1||this.guiArrays.pop()}static addElement(t,e,r,i){const n=this.GUI,s=i?n.add(t,e,i):n.add(t,e);r&&s.onChange(r)}static addElementWithRange(t,e,r,i,n){const a=this.GUI.add(t,e,r,i);n&&a.onChange(n)}static addColorElement(t,e,r){const n=this.GUI.addColor(t,e);r&&n.onChange(r)}static addAction(t,e){const r=this.GUI,i={[e]:t};r.add(i,e)}static get GUI(){return this.guiArrays.length==0&&this.guiArrays.push(new ie),this.guiArrays.at(-1)}}A(it,"guiArrays",[]);class yt{static initialize(t,e,r){this.onRecordStart=t,this.onRecordEnd=e,this.onChangeClockType=r,it.initialize(),it.addFolder("Recording"),it.addElement({recordType:"SequencialFrames"},"recordType",i=>{this.recordType=i},["Frame","SequencialFrames","StartAndStop"]),it.addElement({clockType:"RealTime"},"clockType",i=>{var n;this.clockType=i,(n=this.onChangeClockType)==null||n.call(this,this.clockType)},["RealTime","Fixed"]),it.addElement({fps:60},"fps",i=>{var n;this.fps=i,(n=this.onChangeClockType)==null||n.call(this,this.clockType)}),it.addElement({fixedFrameInterval:60},"fixedFrameInterval",i=>{var n;this.fixedFrameInterval=i,(n=this.onChangeClockType)==null||n.call(this,this.clockType)}),it.addElement({frameNum:300},"frameNum",i=>{this.frameNum=i}),it.addElement({saveName:"test"},"saveName",i=>{this.saveName=i}),it.addFolder("Resolution"),it.addElement({width:800},"width",i=>{this.width=i}),it.addElement({height:800},"height",i=>{this.height=i}),it.resetFolder(),it.addAction(()=>{var i;(i=this.onRecordStart)==null||i.call(this)},"StartRecord"),it.addAction(()=>{var i;(i=this.onRecordEnd)==null||i.call(this)},"StopRecord")}static get recordOptions(){return{type:this.recordType,fps:this.fps,fixedFrameInterval:this.fixedFrameInterval,resolution:[this.width,this.height],saveName:this.saveName,frameNum:this.frameNum}}static get clock(){return this.clockType}}A(yt,"recordType","SequencialFrames"),A(yt,"clockType","RealTime"),A(yt,"fps",60),A(yt,"fixedFrameInterval",60),A(yt,"frameNum",300),A(yt,"width",800),A(yt,"height",800),A(yt,"saveName","test"),A(yt,"onRecordStart"),A(yt,"onRecordEnd"),A(yt,"onChangeClockType");var ne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ei(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}function se(F){throw new Error('Could not dynamically require "'+F+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pe={exports:{}};/*!

    JSZip v3.10.1 - A JavaScript class for generating and reading zip files
    <http://stuartk.com/jszip>

    (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
    Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

    JSZip uses the library pako released under the MIT license :
    https://github.com/nodeca/pako/blob/main/LICENSE
    */var rr;function ri(){return rr||(rr=1,function(F,t){(function(e){F.exports=e()})(function(){return function e(r,i,n){function s(p,b){if(!i[p]){if(!r[p]){var f=typeof se=="function"&&se;if(!b&&f)return f(p,!0);if(a)return a(p,!0);var _=new Error("Cannot find module '"+p+"'");throw _.code="MODULE_NOT_FOUND",_}var c=i[p]={exports:{}};r[p][0].call(c.exports,function(v){var u=r[p][1][v];return s(u||v)},c,c.exports,e,r,i,n)}return i[p].exports}for(var a=typeof se=="function"&&se,l=0;l<n.length;l++)s(n[l]);return s}({1:[function(e,r,i){var n=e("./utils"),s=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var p,b,f,_,c,v,u,m=[],d=0,g=l.length,x=g,T=n.getTypeOf(l)!=="string";d<l.length;)x=g-d,f=T?(p=l[d++],b=d<g?l[d++]:0,d<g?l[d++]:0):(p=l.charCodeAt(d++),b=d<g?l.charCodeAt(d++):0,d<g?l.charCodeAt(d++):0),_=p>>2,c=(3&p)<<4|b>>4,v=1<x?(15&b)<<2|f>>6:64,u=2<x?63&f:64,m.push(a.charAt(_)+a.charAt(c)+a.charAt(v)+a.charAt(u));return m.join("")},i.decode=function(l){var p,b,f,_,c,v,u=0,m=0,d="data:";if(l.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var g,x=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&x--,l.charAt(l.length-2)===a.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=s.uint8array?new Uint8Array(0|x):new Array(0|x);u<l.length;)p=a.indexOf(l.charAt(u++))<<2|(_=a.indexOf(l.charAt(u++)))>>4,b=(15&_)<<4|(c=a.indexOf(l.charAt(u++)))>>2,f=(3&c)<<6|(v=a.indexOf(l.charAt(u++))),g[m++]=p,c!==64&&(g[m++]=b),v!==64&&(g[m++]=f);return g}},{"./support":30,"./utils":32}],2:[function(e,r,i){var n=e("./external"),s=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function p(b,f,_,c,v){this.compressedSize=b,this.uncompressedSize=f,this.crc32=_,this.compression=c,this.compressedContent=v}p.prototype={getContentWorker:function(){var b=new s(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return b.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new s(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(b,f,_){return b.pipe(new a).pipe(new l("uncompressedSize")).pipe(f.compressWorker(_)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},r.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,i){var n=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,i){var n=e("./utils"),s=function(){for(var a,l=[],p=0;p<256;p++){a=p;for(var b=0;b<8;b++)a=1&a?3988292384^a>>>1:a>>>1;l[p]=a}return l}();r.exports=function(a,l){return a!==void 0&&a.length?n.getTypeOf(a)!=="string"?function(p,b,f,_){var c=s,v=_+f;p^=-1;for(var u=_;u<v;u++)p=p>>>8^c[255&(p^b[u])];return-1^p}(0|l,a,a.length,0):function(p,b,f,_){var c=s,v=_+f;p^=-1;for(var u=_;u<v;u++)p=p>>>8^c[255&(p^b.charCodeAt(u))];return-1^p}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,r,i){var n=null;n=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:n}},{lie:37}],7:[function(e,r,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),p=n?"uint8array":"array";function b(f,_){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=_,this.meta={}}i.magic="\b\0",a.inherits(b,l),b.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(p,f.data),!1)},b.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(_){f.push({data:_,meta:f.meta})}},i.compressWorker=function(f){return new b("Deflate",f)},i.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,i){function n(c,v){var u,m="";for(u=0;u<v;u++)m+=String.fromCharCode(255&c),c>>>=8;return m}function s(c,v,u,m,d,g){var x,T,S=c.file,U=c.compression,O=g!==p.utf8encode,$=a.transformTo("string",g(S.name)),D=a.transformTo("string",p.utf8encode(S.name)),W=S.comment,Q=a.transformTo("string",g(W)),E=a.transformTo("string",p.utf8encode(W)),B=D.length!==S.name.length,h=E.length!==W.length,I="",nt="",G="",st=S.dir,V=S.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};v&&!u||(rt.crc32=c.crc32,rt.compressedSize=c.compressedSize,rt.uncompressedSize=c.uncompressedSize);var z=0;v&&(z|=8),O||!B&&!h||(z|=2048);var R=0,et=0;st&&(R|=16),d==="UNIX"?(et=798,R|=function(Y,gt){var xt=Y;return Y||(xt=gt?16893:33204),(65535&xt)<<16}(S.unixPermissions,st)):(et=20,R|=function(Y){return 63&(Y||0)}(S.dosPermissions)),x=V.getUTCHours(),x<<=6,x|=V.getUTCMinutes(),x<<=5,x|=V.getUTCSeconds()/2,T=V.getUTCFullYear()-1980,T<<=4,T|=V.getUTCMonth()+1,T<<=5,T|=V.getUTCDate(),B&&(nt=n(1,1)+n(b($),4)+D,I+="up"+n(nt.length,2)+nt),h&&(G=n(1,1)+n(b(Q),4)+E,I+="uc"+n(G.length,2)+G);var K="";return K+=`
\0`,K+=n(z,2),K+=U.magic,K+=n(x,2),K+=n(T,2),K+=n(rt.crc32,4),K+=n(rt.compressedSize,4),K+=n(rt.uncompressedSize,4),K+=n($.length,2),K+=n(I.length,2),{fileRecord:f.LOCAL_FILE_HEADER+K+$+I,dirRecord:f.CENTRAL_FILE_HEADER+n(et,2)+K+n(Q.length,2)+"\0\0\0\0"+n(R,4)+n(m,4)+$+I+Q}}var a=e("../utils"),l=e("../stream/GenericWorker"),p=e("../utf8"),b=e("../crc32"),f=e("../signature");function _(c,v,u,m){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=v,this.zipPlatform=u,this.encodeFileName=m,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(_,l),_.prototype.push=function(c){var v=c.meta.percent||0,u=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,l.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:u?(v+100*(u-m-1))/u:100}}))},_.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var v=this.streamFiles&&!c.file.dir;if(v){var u=s(c,v,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:u.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(c){this.accumulate=!1;var v=this.streamFiles&&!c.file.dir,u=s(c,v,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(u.dirRecord),v)this.push({data:function(m){return f.DATA_DESCRIPTOR+n(m.crc32,4)+n(m.compressedSize,4)+n(m.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:u.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var c=this.bytesWritten,v=0;v<this.dirRecords.length;v++)this.push({data:this.dirRecords[v],meta:{percent:100}});var u=this.bytesWritten-c,m=function(d,g,x,T,S){var U=a.transformTo("string",S(T));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(d,2)+n(d,2)+n(g,4)+n(x,4)+n(U.length,2)+U}(this.dirRecords.length,u,c,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(c){this._sources.push(c);var v=this;return c.on("data",function(u){v.processChunk(u)}),c.on("end",function(){v.closedSource(v.previous.streamInfo),v._sources.length?v.prepareNextSource():v.end()}),c.on("error",function(u){v.error(u)}),this},_.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(c){var v=this._sources;if(!l.prototype.error.call(this,c))return!1;for(var u=0;u<v.length;u++)try{v[u].error(c)}catch{}return!0},_.prototype.lock=function(){l.prototype.lock.call(this);for(var c=this._sources,v=0;v<c.length;v++)c[v].lock()},r.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,i){var n=e("../compressions"),s=e("./ZipFileWorker");i.generateWorker=function(a,l,p){var b=new s(l.streamFiles,p,l.platform,l.encodeFileName),f=0;try{a.forEach(function(_,c){f++;var v=function(g,x){var T=g||x,S=n[T];if(!S)throw new Error(T+" is not a valid compression method !");return S}(c.options.compression,l.compression),u=c.options.compressionOptions||l.compressionOptions||{},m=c.dir,d=c.date;c._compressWorker(v,u).withStreamInfo("file",{name:_,dir:m,date:d,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(b)}),b.entriesCount=f}catch(_){b.error(_)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new n;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(s,a){return new n().loadAsync(s,a)},n.external=e("./external"),r.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,i){var n=e("./utils"),s=e("./external"),a=e("./utf8"),l=e("./zipEntries"),p=e("./stream/Crc32Probe"),b=e("./nodejsUtils");function f(_){return new s.Promise(function(c,v){var u=_.decompressed.getContentWorker().pipe(new p);u.on("error",function(m){v(m)}).on("end",function(){u.streamInfo.crc32!==_.decompressed.crc32?v(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}r.exports=function(_,c){var v=this;return c=n.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),b.isNode&&b.isStream(_)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",_,!0,c.optimizedBinaryString,c.base64).then(function(u){var m=new l(c);return m.load(u),m}).then(function(u){var m=[s.Promise.resolve(u)],d=u.files;if(c.checkCRC32)for(var g=0;g<d.length;g++)m.push(f(d[g]));return s.Promise.all(m)}).then(function(u){for(var m=u.shift(),d=m.files,g=0;g<d.length;g++){var x=d[g],T=x.fileNameStr,S=n.resolve(x.fileNameStr);v.file(S,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:c.createFolders}),x.dir||(v.file(S).unsafeOriginalName=T)}return m.zipComment.length&&(v.comment=m.zipComment),v})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,i){var n=e("../utils"),s=e("../stream/GenericWorker");function a(l,p){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(p)}n.inherits(a,s),a.prototype._bindStream=function(l){var p=this;(this._stream=l).pause(),l.on("data",function(b){p.push({data:b,meta:{percent:0}})}).on("error",function(b){p.isPaused?this.generatedError=b:p.error(b)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,i){var n=e("readable-stream").Readable;function s(a,l,p){n.call(this,l),this._helper=a;var b=this;a.on("data",function(f,_){b.push(f)||b._helper.pause(),p&&p(_)}).on("error",function(f){b.emit("error",f)}).on("end",function(){b.push(null)})}e("../utils").inherits(s,n),s.prototype._read=function(){this._helper.resume()},r.exports=s},{"../utils":32,"readable-stream":16}],14:[function(e,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,s);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,s)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var s=new Buffer(n);return s.fill(0),s},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(e,r,i){function n(S,U,O){var $,D=a.getTypeOf(U),W=a.extend(O||{},b);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(S=d(S)),W.createFolders&&($=m(S))&&g.call(this,$,!0);var Q=D==="string"&&W.binary===!1&&W.base64===!1;O&&O.binary!==void 0||(W.binary=!Q),(U instanceof f&&U.uncompressedSize===0||W.dir||!U||U.length===0)&&(W.base64=!1,W.binary=!0,U="",W.compression="STORE",D="string");var E=null;E=U instanceof f||U instanceof l?U:v.isNode&&v.isStream(U)?new u(S,U):a.prepareContent(S,U,W.binary,W.optimizedBinaryString,W.base64);var B=new _(S,E,W);this.files[S]=B}var s=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),p=e("./stream/StreamHelper"),b=e("./defaults"),f=e("./compressedObject"),_=e("./zipObject"),c=e("./generate"),v=e("./nodejsUtils"),u=e("./nodejs/NodejsStreamInputAdapter"),m=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var U=S.lastIndexOf("/");return 0<U?S.substring(0,U):""},d=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},g=function(S,U){return U=U!==void 0?U:b.createFolders,S=d(S),this.files[S]||n.call(this,S,null,{dir:!0,createFolders:U}),this.files[S]};function x(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var U,O,$;for(U in this.files)$=this.files[U],(O=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&S(O,$)},filter:function(S){var U=[];return this.forEach(function(O,$){S(O,$)&&U.push($)}),U},file:function(S,U,O){if(arguments.length!==1)return S=this.root+S,n.call(this,S,U,O),this;if(x(S)){var $=S;return this.filter(function(W,Q){return!Q.dir&&$.test(W)})}var D=this.files[this.root+S];return D&&!D.dir?D:null},folder:function(S){if(!S)return this;if(x(S))return this.filter(function(D,W){return W.dir&&S.test(D)});var U=this.root+S,O=g.call(this,U),$=this.clone();return $.root=O.name,$},remove:function(S){S=this.root+S;var U=this.files[S];if(U||(S.slice(-1)!=="/"&&(S+="/"),U=this.files[S]),U&&!U.dir)delete this.files[S];else for(var O=this.filter(function(D,W){return W.name.slice(0,S.length)===S}),$=0;$<O.length;$++)delete this.files[O[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var U,O={};try{if((O=a.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");a.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var $=O.comment||this.comment||"";U=c.generateWorker(this,O,$)}catch(D){(U=new l("error")).error(D)}return new p(U,O.type||"string",O.mimeType)},generateAsync:function(S,U){return this.generateInternalStream(S).accumulate(U)},generateNodeStream:function(S,U){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(U)}};r.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,i){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,i){var n=e("./DataReader");function s(a){n.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(s,n),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),p=a.charCodeAt(1),b=a.charCodeAt(2),f=a.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===l&&this.data[_+1]===p&&this.data[_+2]===b&&this.data[_+3]===f)return _-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),p=a.charCodeAt(1),b=a.charCodeAt(2),f=a.charCodeAt(3),_=this.readData(4);return l===_[0]&&p===_[1]&&b===_[2]&&f===_[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./DataReader":18}],18:[function(e,r,i){var n=e("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,p=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)p=(p<<8)+this.byteAt(l);return this.index+=a,p},readString:function(a){return n.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=s},{"../utils":32}],19:[function(e,r,i){var n=e("./Uint8ArrayReader");function s(a){n.call(this,a)}e("../utils").inherits(s,n),s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,i){var n=e("./DataReader");function s(a){n.call(this,a)}e("../utils").inherits(s,n),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./DataReader":18}],21:[function(e,r,i){var n=e("./ArrayReader");function s(a){n.call(this,a)}e("../utils").inherits(s,n),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},r.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,i){var n=e("../utils"),s=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),p=e("./NodeBufferReader"),b=e("./Uint8ArrayReader");r.exports=function(f){var _=n.getTypeOf(f);return n.checkSupport(_),_!=="string"||s.uint8array?_==="nodebuffer"?new p(f):s.uint8array?new b(n.transformTo("uint8array",f)):new a(n.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,i){var n=e("./GenericWorker"),s=e("../utils");function a(l){n.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(a,n),a.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,i){var n=e("./GenericWorker"),s=e("../crc32");function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,n),a.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,i){var n=e("../utils"),s=e("./GenericWorker");function a(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}n.inherits(a,s),a.prototype.processChunk=function(l){if(l){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+l.data.length}s.prototype.processChunk.call(this,l)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,i){var n=e("../utils"),s=e("./GenericWorker");function a(l){s.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(b){p.dataIsReady=!0,p.data=b,p.max=b&&b.length||0,p.type=n.getTypeOf(b),p.isPaused||p._tickAndRepeat()},function(b){p.error(b)})}n.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,p);break;case"uint8array":l=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":l=this.data.slice(this.index,p)}return this.index=p,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,i){function n(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(l){a.processChunk(l)}),s.on("end",function(){a.end()}),s.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},r.exports=n},{}],29:[function(e,r,i){var n=e("../utils"),s=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),p=e("../support"),b=e("../external"),f=null;if(p.nodestream)try{f=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(v,u){return new b.Promise(function(m,d){var g=[],x=v._internalType,T=v._outputType,S=v._mimeType;v.on("data",function(U,O){g.push(U),u&&u(O)}).on("error",function(U){g=[],d(U)}).on("end",function(){try{var U=function(O,$,D){switch(O){case"blob":return n.newBlob(n.transformTo("arraybuffer",$),D);case"base64":return l.encode($);default:return n.transformTo(O,$)}}(T,function(O,$){var D,W=0,Q=null,E=0;for(D=0;D<$.length;D++)E+=$[D].length;switch(O){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(Q=new Uint8Array(E),D=0;D<$.length;D++)Q.set($[D],W),W+=$[D].length;return Q;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+O+"'")}}(x,g),S);m(U)}catch(O){d(O)}g=[]}).resume()})}function c(v,u,m){var d=u;switch(u){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=u,this._mimeType=m,n.checkSupport(d),this._worker=v.pipe(new s(d)),v.lock()}catch(g){this._worker=new a("error"),this._worker.error(g)}}c.prototype={accumulate:function(v){return _(this,v)},on:function(v,u){var m=this;return v==="data"?this._worker.on(v,function(d){u.call(m,d.data,d.meta)}):this._worker.on(v,function(){n.delay(u,arguments,m)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(v){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},v)}},r.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(n),i.blob=s.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,i){for(var n=e("./utils"),s=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),p=new Array(256),b=0;b<256;b++)p[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;p[254]=p[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}function _(){l.call(this,"utf-8 encode")}i.utf8encode=function(c){return s.nodebuffer?a.newBufferFrom(c,"utf-8"):function(v){var u,m,d,g,x,T=v.length,S=0;for(g=0;g<T;g++)(64512&(m=v.charCodeAt(g)))==55296&&g+1<T&&(64512&(d=v.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(d-56320),g++),S+=m<128?1:m<2048?2:m<65536?3:4;for(u=s.uint8array?new Uint8Array(S):new Array(S),g=x=0;x<S;g++)(64512&(m=v.charCodeAt(g)))==55296&&g+1<T&&(64512&(d=v.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(d-56320),g++),m<128?u[x++]=m:(m<2048?u[x++]=192|m>>>6:(m<65536?u[x++]=224|m>>>12:(u[x++]=240|m>>>18,u[x++]=128|m>>>12&63),u[x++]=128|m>>>6&63),u[x++]=128|63&m);return u}(c)},i.utf8decode=function(c){return s.nodebuffer?n.transformTo("nodebuffer",c).toString("utf-8"):function(v){var u,m,d,g,x=v.length,T=new Array(2*x);for(u=m=0;u<x;)if((d=v[u++])<128)T[m++]=d;else if(4<(g=p[d]))T[m++]=65533,u+=g-1;else{for(d&=g===2?31:g===3?15:7;1<g&&u<x;)d=d<<6|63&v[u++],g--;1<g?T[m++]=65533:d<65536?T[m++]=d:(d-=65536,T[m++]=55296|d>>10&1023,T[m++]=56320|1023&d)}return T.length!==m&&(T.subarray?T=T.subarray(0,m):T.length=m),n.applyFromCharCode(T)}(c=n.transformTo(s.uint8array?"uint8array":"array",c))},n.inherits(f,l),f.prototype.processChunk=function(c){var v=n.transformTo(s.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var u=v;(v=new Uint8Array(u.length+this.leftOver.length)).set(this.leftOver,0),v.set(u,this.leftOver.length)}else v=this.leftOver.concat(v);this.leftOver=null}var m=function(g,x){var T;for((x=x||g.length)>g.length&&(x=g.length),T=x-1;0<=T&&(192&g[T])==128;)T--;return T<0||T===0?x:T+p[g[T]]>x?T:x}(v),d=v;m!==v.length&&(s.uint8array?(d=v.subarray(0,m),this.leftOver=v.subarray(m,v.length)):(d=v.slice(0,m),this.leftOver=v.slice(m,v.length))),this.push({data:i.utf8decode(d),meta:c.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,n.inherits(_,l),_.prototype.processChunk=function(c){this.push({data:i.utf8encode(c.data),meta:c.meta})},i.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,i){var n=e("./support"),s=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function p(u){return u}function b(u,m){for(var d=0;d<u.length;++d)m[d]=255&u.charCodeAt(d);return m}e("setimmediate"),i.newBlob=function(u,m){i.checkSupport("blob");try{return new Blob([u],{type:m})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(u),d.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(u,m,d){var g=[],x=0,T=u.length;if(T<=d)return String.fromCharCode.apply(null,u);for(;x<T;)m==="array"||m==="nodebuffer"?g.push(String.fromCharCode.apply(null,u.slice(x,Math.min(x+d,T)))):g.push(String.fromCharCode.apply(null,u.subarray(x,Math.min(x+d,T)))),x+=d;return g.join("")},stringifyByChar:function(u){for(var m="",d=0;d<u.length;d++)m+=String.fromCharCode(u[d]);return m},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function _(u){var m=65536,d=i.getTypeOf(u),g=!0;if(d==="uint8array"?g=f.applyCanBeUsed.uint8array:d==="nodebuffer"&&(g=f.applyCanBeUsed.nodebuffer),g)for(;1<m;)try{return f.stringifyByChunk(u,d,m)}catch{m=Math.floor(m/2)}return f.stringifyByChar(u)}function c(u,m){for(var d=0;d<u.length;d++)m[d]=u[d];return m}i.applyFromCharCode=_;var v={};v.string={string:p,array:function(u){return b(u,new Array(u.length))},arraybuffer:function(u){return v.string.uint8array(u).buffer},uint8array:function(u){return b(u,new Uint8Array(u.length))},nodebuffer:function(u){return b(u,a.allocBuffer(u.length))}},v.array={string:_,array:p,arraybuffer:function(u){return new Uint8Array(u).buffer},uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return a.newBufferFrom(u)}},v.arraybuffer={string:function(u){return _(new Uint8Array(u))},array:function(u){return c(new Uint8Array(u),new Array(u.byteLength))},arraybuffer:p,uint8array:function(u){return new Uint8Array(u)},nodebuffer:function(u){return a.newBufferFrom(new Uint8Array(u))}},v.uint8array={string:_,array:function(u){return c(u,new Array(u.length))},arraybuffer:function(u){return u.buffer},uint8array:p,nodebuffer:function(u){return a.newBufferFrom(u)}},v.nodebuffer={string:_,array:function(u){return c(u,new Array(u.length))},arraybuffer:function(u){return v.nodebuffer.uint8array(u).buffer},uint8array:function(u){return c(u,new Uint8Array(u.length))},nodebuffer:p},i.transformTo=function(u,m){if(m=m||"",!u)return m;i.checkSupport(u);var d=i.getTypeOf(m);return v[d][u](m)},i.resolve=function(u){for(var m=u.split("/"),d=[],g=0;g<m.length;g++){var x=m[g];x==="."||x===""&&g!==0&&g!==m.length-1||(x===".."?d.pop():d.push(x))}return d.join("/")},i.getTypeOf=function(u){return typeof u=="string"?"string":Object.prototype.toString.call(u)==="[object Array]"?"array":n.nodebuffer&&a.isBuffer(u)?"nodebuffer":n.uint8array&&u instanceof Uint8Array?"uint8array":n.arraybuffer&&u instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(u){if(!n[u.toLowerCase()])throw new Error(u+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(u){var m,d,g="";for(d=0;d<(u||"").length;d++)g+="\\x"+((m=u.charCodeAt(d))<16?"0":"")+m.toString(16).toUpperCase();return g},i.delay=function(u,m,d){setImmediate(function(){u.apply(d||null,m||[])})},i.inherits=function(u,m){function d(){}d.prototype=m.prototype,u.prototype=new d},i.extend=function(){var u,m,d={};for(u=0;u<arguments.length;u++)for(m in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],m)&&d[m]===void 0&&(d[m]=arguments[u][m]);return d},i.prepareContent=function(u,m,d,g,x){return l.Promise.resolve(m).then(function(T){return n.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,U){var O=new FileReader;O.onload=function($){S($.target.result)},O.onerror=function($){U($.target.error)},O.readAsArrayBuffer(T)}):T}).then(function(T){var S=i.getTypeOf(T);return S?(S==="arraybuffer"?T=i.transformTo("uint8array",T):S==="string"&&(x?T=s.decode(T):d&&g!==!0&&(T=function(U){return b(U,n.uint8array?new Uint8Array(U.length):new Array(U.length))}(T))),T):l.Promise.reject(new Error("Can't read the data of '"+u+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,i){var n=e("./reader/readerFor"),s=e("./utils"),a=e("./signature"),l=e("./zipEntry"),p=e("./support");function b(f){this.files=[],this.loadOptions=f}b.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(_)+", expected "+s.pretty(f)+")")}},isSignature:function(f,_){var c=this.reader.index;this.reader.setIndex(f);var v=this.reader.readString(4)===_;return this.reader.setIndex(c),v},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),_=p.uint8array?"uint8array":"array",c=s.transformTo(_,f);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,_,c,v=this.zip64EndOfCentralSize-44;0<v;)f=this.reader.readInt(2),_=this.reader.readInt(4),c=this.reader.readData(_),this.zip64ExtensibleData[f]={id:f,length:_,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,_;for(f=0;f<this.files.length;f++)_=this.files[f],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var _=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var v=_-c;if(0<v)this.isSignature(_,a.CENTRAL_FILE_HEADER)||(this.reader.zero=v);else if(v<0)throw new Error("Corrupted zip: missing "+Math.abs(v)+" bytes.")},prepareReader:function(f){this.reader=n(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,i){var n=e("./reader/readerFor"),s=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),p=e("./utf8"),b=e("./compressions"),f=e("./support");function _(c,v){this.options=c,this.loadOptions=v}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var v,u;if(c.skip(22),this.fileNameLength=c.readInt(2),u=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(u),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((v=function(m){for(var d in b)if(Object.prototype.hasOwnProperty.call(b,d)&&b[d].magic===m)return b[d];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,v,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var v=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(v),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var v,u,m,d=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<d;)v=c.readInt(2),u=c.readInt(2),m=c.readData(u),this.extraFields[v]={id:v,length:u,value:m};c.setIndex(d)},handleUTF8:function(){var c=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var v=this.findExtraFieldUnicodePath();if(v!==null)this.fileNameStr=v;else{var u=s.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(u)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var d=s.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var v=n(c.value);return v.readInt(1)!==1||l(this.fileName)!==v.readInt(4)?null:p.utf8decode(v.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var v=n(c.value);return v.readInt(1)!==1||l(this.fileComment)!==v.readInt(4)?null:p.utf8decode(v.readData(c.length-5))}return null}},r.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,i){function n(v,u,m){this.name=v,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=u,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var s=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),p=e("./compressedObject"),b=e("./stream/GenericWorker");n.prototype={internalStream:function(v){var u=null,m="string";try{if(!v)throw new Error("No output type specified.");var d=(m=v.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),u=this._decompressWorker();var g=!this._dataBinary;g&&!d&&(u=u.pipe(new l.Utf8EncodeWorker)),!g&&d&&(u=u.pipe(new l.Utf8DecodeWorker))}catch(x){(u=new b("error")).error(x)}return new s(u,m,"")},async:function(v,u){return this.internalStream(v).accumulate(u)},nodeStream:function(v,u){return this.internalStream(v||"nodebuffer").toNodejsStream(u)},_compressWorker:function(v,u){if(this._data instanceof p&&this._data.compression.magic===v.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new l.Utf8EncodeWorker)),p.createWorkerFrom(m,v,u)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof b?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<f.length;c++)n.prototype[f[c]]=_;r.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,i){(function(n){var s,a,l=n.MutationObserver||n.WebKitMutationObserver;if(l){var p=0,b=new l(v),f=n.document.createTextNode("");b.observe(f,{characterData:!0}),s=function(){f.data=p=++p%2}}else if(n.setImmediate||n.MessageChannel===void 0)s="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var u=n.document.createElement("script");u.onreadystatechange=function(){v(),u.onreadystatechange=null,u.parentNode.removeChild(u),u=null},n.document.documentElement.appendChild(u)}:function(){setTimeout(v,0)};else{var _=new n.MessageChannel;_.port1.onmessage=v,s=function(){_.port2.postMessage(0)}}var c=[];function v(){var u,m;a=!0;for(var d=c.length;d;){for(m=c,c=[],u=-1;++u<d;)m[u]();d=c.length}a=!1}r.exports=function(u){c.push(u)!==1||a||s()}}).call(this,typeof ne<"u"?ne:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,i){var n=e("immediate");function s(){}var a={},l=["REJECTED"],p=["FULFILLED"],b=["PENDING"];function f(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,d!==s&&u(this,d)}function _(d,g,x){this.promise=d,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function c(d,g,x){n(function(){var T;try{T=g(x)}catch(S){return a.reject(d,S)}T===d?a.reject(d,new TypeError("Cannot resolve promise with itself")):a.resolve(d,T)})}function v(d){var g=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof g=="function")return function(){g.apply(d,arguments)}}function u(d,g){var x=!1;function T(O){x||(x=!0,a.reject(d,O))}function S(O){x||(x=!0,a.resolve(d,O))}var U=m(function(){g(S,T)});U.status==="error"&&T(U.value)}function m(d,g){var x={};try{x.value=d(g),x.status="success"}catch(T){x.status="error",x.value=T}return x}(r.exports=f).prototype.finally=function(d){if(typeof d!="function")return this;var g=this.constructor;return this.then(function(x){return g.resolve(d()).then(function(){return x})},function(x){return g.resolve(d()).then(function(){throw x})})},f.prototype.catch=function(d){return this.then(null,d)},f.prototype.then=function(d,g){if(typeof d!="function"&&this.state===p||typeof g!="function"&&this.state===l)return this;var x=new this.constructor(s);return this.state!==b?c(x,this.state===p?d:g,this.outcome):this.queue.push(new _(x,d,g)),x},_.prototype.callFulfilled=function(d){a.resolve(this.promise,d)},_.prototype.otherCallFulfilled=function(d){c(this.promise,this.onFulfilled,d)},_.prototype.callRejected=function(d){a.reject(this.promise,d)},_.prototype.otherCallRejected=function(d){c(this.promise,this.onRejected,d)},a.resolve=function(d,g){var x=m(v,g);if(x.status==="error")return a.reject(d,x.value);var T=x.value;if(T)u(d,T);else{d.state=p,d.outcome=g;for(var S=-1,U=d.queue.length;++S<U;)d.queue[S].callFulfilled(g)}return d},a.reject=function(d,g){d.state=l,d.outcome=g;for(var x=-1,T=d.queue.length;++x<T;)d.queue[x].callRejected(g);return d},f.resolve=function(d){return d instanceof this?d:a.resolve(new this(s),d)},f.reject=function(d){var g=new this(s);return a.reject(g,d)},f.all=function(d){var g=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=d.length,T=!1;if(!x)return this.resolve([]);for(var S=new Array(x),U=0,O=-1,$=new this(s);++O<x;)D(d[O],O);return $;function D(W,Q){g.resolve(W).then(function(E){S[Q]=E,++U!==x||T||(T=!0,a.resolve($,S))},function(E){T||(T=!0,a.reject($,E))})}},f.race=function(d){var g=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=d.length,T=!1;if(!x)return this.resolve([]);for(var S=-1,U=new this(s);++S<x;)O=d[S],g.resolve(O).then(function($){T||(T=!0,a.resolve(U,$))},function($){T||(T=!0,a.reject(U,$))});var O;return U}},{immediate:36}],38:[function(e,r,i){var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,i){var n=e("./zlib/deflate"),s=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),p=e("./zlib/zstream"),b=Object.prototype.toString,f=0,_=-1,c=0,v=8;function u(d){if(!(this instanceof u))return new u(d);this.options=s.assign({level:_,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},d||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var x=n.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(x!==f)throw new Error(l[x]);if(g.header&&n.deflateSetHeader(this.strm,g.header),g.dictionary){var T;if(T=typeof g.dictionary=="string"?a.string2buf(g.dictionary):b.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(x=n.deflateSetDictionary(this.strm,T))!==f)throw new Error(l[x]);this._dict_set=!0}}function m(d,g){var x=new u(g);if(x.push(d,!0),x.err)throw x.msg||l[x.err];return x.result}u.prototype.push=function(d,g){var x,T,S=this.strm,U=this.options.chunkSize;if(this.ended)return!1;T=g===~~g?g:g===!0?4:0,typeof d=="string"?S.input=a.string2buf(d):b.call(d)==="[object ArrayBuffer]"?S.input=new Uint8Array(d):S.input=d,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new s.Buf8(U),S.next_out=0,S.avail_out=U),(x=n.deflate(S,T))!==1&&x!==f)return this.onEnd(x),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(S.output,S.next_out))):this.onData(s.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&x!==1);return T===4?(x=n.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===f):T!==2||(this.onEnd(f),!(S.avail_out=0))},u.prototype.onData=function(d){this.chunks.push(d)},u.prototype.onEnd=function(d){d===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},i.Deflate=u,i.deflate=m,i.deflateRaw=function(d,g){return(g=g||{}).raw=!0,m(d,g)},i.gzip=function(d,g){return(g=g||{}).gzip=!0,m(d,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,i){var n=e("./zlib/inflate"),s=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),p=e("./zlib/messages"),b=e("./zlib/zstream"),f=e("./zlib/gzheader"),_=Object.prototype.toString;function c(u){if(!(this instanceof c))return new c(u);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},u||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||u&&u.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&(15&m.windowBits)==0&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var d=n.inflateInit2(this.strm,m.windowBits);if(d!==l.Z_OK)throw new Error(p[d]);this.header=new f,n.inflateGetHeader(this.strm,this.header)}function v(u,m){var d=new c(m);if(d.push(u,!0),d.err)throw d.msg||p[d.err];return d.result}c.prototype.push=function(u,m){var d,g,x,T,S,U,O=this.strm,$=this.options.chunkSize,D=this.options.dictionary,W=!1;if(this.ended)return!1;g=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof u=="string"?O.input=a.binstring2buf(u):_.call(u)==="[object ArrayBuffer]"?O.input=new Uint8Array(u):O.input=u,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new s.Buf8($),O.next_out=0,O.avail_out=$),(d=n.inflate(O,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&D&&(U=typeof D=="string"?a.string2buf(D):_.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,d=n.inflateSetDictionary(this.strm,U)),d===l.Z_BUF_ERROR&&W===!0&&(d=l.Z_OK,W=!1),d!==l.Z_STREAM_END&&d!==l.Z_OK)return this.onEnd(d),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&d!==l.Z_STREAM_END&&(O.avail_in!==0||g!==l.Z_FINISH&&g!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=a.utf8border(O.output,O.next_out),T=O.next_out-x,S=a.buf2string(O.output,x),O.next_out=T,O.avail_out=$-T,T&&s.arraySet(O.output,O.output,x,T,0),this.onData(S)):this.onData(s.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(W=!0)}while((0<O.avail_in||O.avail_out===0)&&d!==l.Z_STREAM_END);return d===l.Z_STREAM_END&&(g=l.Z_FINISH),g===l.Z_FINISH?(d=n.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===l.Z_OK):g!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(O.avail_out=0))},c.prototype.onData=function(u){this.chunks.push(u)},c.prototype.onEnd=function(u){u===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},i.Inflate=c,i.inflate=v,i.inflateRaw=function(u,m){return(m=m||{}).raw=!0,v(u,m)},i.ungzip=v},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var b=p.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var f in b)b.hasOwnProperty(f)&&(l[f]=b[f])}}return l},i.shrinkBuf=function(l,p){return l.length===p?l:l.subarray?l.subarray(0,p):(l.length=p,l)};var s={arraySet:function(l,p,b,f,_){if(p.subarray&&l.subarray)l.set(p.subarray(b,b+f),_);else for(var c=0;c<f;c++)l[_+c]=p[b+c]},flattenChunks:function(l){var p,b,f,_,c,v;for(p=f=0,b=l.length;p<b;p++)f+=l[p].length;for(v=new Uint8Array(f),p=_=0,b=l.length;p<b;p++)c=l[p],v.set(c,_),_+=c.length;return v}},a={arraySet:function(l,p,b,f,_){for(var c=0;c<f;c++)l[_+c]=p[b+c]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(n)},{}],42:[function(e,r,i){var n=e("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new n.Buf8(256),p=0;p<256;p++)l[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function b(f,_){if(_<65537&&(f.subarray&&a||!f.subarray&&s))return String.fromCharCode.apply(null,n.shrinkBuf(f,_));for(var c="",v=0;v<_;v++)c+=String.fromCharCode(f[v]);return c}l[254]=l[254]=1,i.string2buf=function(f){var _,c,v,u,m,d=f.length,g=0;for(u=0;u<d;u++)(64512&(c=f.charCodeAt(u)))==55296&&u+1<d&&(64512&(v=f.charCodeAt(u+1)))==56320&&(c=65536+(c-55296<<10)+(v-56320),u++),g+=c<128?1:c<2048?2:c<65536?3:4;for(_=new n.Buf8(g),u=m=0;m<g;u++)(64512&(c=f.charCodeAt(u)))==55296&&u+1<d&&(64512&(v=f.charCodeAt(u+1)))==56320&&(c=65536+(c-55296<<10)+(v-56320),u++),c<128?_[m++]=c:(c<2048?_[m++]=192|c>>>6:(c<65536?_[m++]=224|c>>>12:(_[m++]=240|c>>>18,_[m++]=128|c>>>12&63),_[m++]=128|c>>>6&63),_[m++]=128|63&c);return _},i.buf2binstring=function(f){return b(f,f.length)},i.binstring2buf=function(f){for(var _=new n.Buf8(f.length),c=0,v=_.length;c<v;c++)_[c]=f.charCodeAt(c);return _},i.buf2string=function(f,_){var c,v,u,m,d=_||f.length,g=new Array(2*d);for(c=v=0;c<d;)if((u=f[c++])<128)g[v++]=u;else if(4<(m=l[u]))g[v++]=65533,c+=m-1;else{for(u&=m===2?31:m===3?15:7;1<m&&c<d;)u=u<<6|63&f[c++],m--;1<m?g[v++]=65533:u<65536?g[v++]=u:(u-=65536,g[v++]=55296|u>>10&1023,g[v++]=56320|1023&u)}return b(g,v)},i.utf8border=function(f,_){var c;for((_=_||f.length)>f.length&&(_=f.length),c=_-1;0<=c&&(192&f[c])==128;)c--;return c<0||c===0?_:c+l[f[c]]>_?c:_}},{"./common":41}],43:[function(e,r,i){r.exports=function(n,s,a,l){for(var p=65535&n|0,b=n>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;b=b+(p=p+s[l++]|0)|0,--f;);p%=65521,b%=65521}return p|b<<16|0}},{}],44:[function(e,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,i){var n=function(){for(var s,a=[],l=0;l<256;l++){s=l;for(var p=0;p<8;p++)s=1&s?3988292384^s>>>1:s>>>1;a[l]=s}return a}();r.exports=function(s,a,l,p){var b=n,f=p+l;s^=-1;for(var _=p;_<f;_++)s=s>>>8^b[255&(s^a[_])];return-1^s}},{}],46:[function(e,r,i){var n,s=e("../utils/common"),a=e("./trees"),l=e("./adler32"),p=e("./crc32"),b=e("./messages"),f=0,_=4,c=0,v=-2,u=-1,m=4,d=2,g=8,x=9,T=286,S=30,U=19,O=2*T+1,$=15,D=3,W=258,Q=W+D+1,E=42,B=113,h=1,I=2,nt=3,G=4;function st(o,L){return o.msg=b[L],L}function V(o){return(o<<1)-(4<o?9:0)}function rt(o){for(var L=o.length;0<=--L;)o[L]=0}function z(o){var L=o.state,P=L.pending;P>o.avail_out&&(P=o.avail_out),P!==0&&(s.arraySet(o.output,L.pending_buf,L.pending_out,P,o.next_out),o.next_out+=P,L.pending_out+=P,o.total_out+=P,o.avail_out-=P,L.pending-=P,L.pending===0&&(L.pending_out=0))}function R(o,L){a._tr_flush_block(o,0<=o.block_start?o.block_start:-1,o.strstart-o.block_start,L),o.block_start=o.strstart,z(o.strm)}function et(o,L){o.pending_buf[o.pending++]=L}function K(o,L){o.pending_buf[o.pending++]=L>>>8&255,o.pending_buf[o.pending++]=255&L}function Y(o,L){var P,y,w=o.max_chain_length,C=o.strstart,N=o.prev_length,j=o.nice_match,k=o.strstart>o.w_size-Q?o.strstart-(o.w_size-Q):0,H=o.window,J=o.w_mask,Z=o.prev,tt=o.strstart+W,dt=H[C+N-1],ot=H[C+N];o.prev_length>=o.good_match&&(w>>=2),j>o.lookahead&&(j=o.lookahead);do if(H[(P=L)+N]===ot&&H[P+N-1]===dt&&H[P]===H[C]&&H[++P]===H[C+1]){C+=2,P++;do;while(H[++C]===H[++P]&&H[++C]===H[++P]&&H[++C]===H[++P]&&H[++C]===H[++P]&&H[++C]===H[++P]&&H[++C]===H[++P]&&H[++C]===H[++P]&&H[++C]===H[++P]&&C<tt);if(y=W-(tt-C),C=tt-W,N<y){if(o.match_start=L,j<=(N=y))break;dt=H[C+N-1],ot=H[C+N]}}while((L=Z[L&J])>k&&--w!=0);return N<=o.lookahead?N:o.lookahead}function gt(o){var L,P,y,w,C,N,j,k,H,J,Z=o.w_size;do{if(w=o.window_size-o.lookahead-o.strstart,o.strstart>=Z+(Z-Q)){for(s.arraySet(o.window,o.window,Z,Z,0),o.match_start-=Z,o.strstart-=Z,o.block_start-=Z,L=P=o.hash_size;y=o.head[--L],o.head[L]=Z<=y?y-Z:0,--P;);for(L=P=Z;y=o.prev[--L],o.prev[L]=Z<=y?y-Z:0,--P;);w+=Z}if(o.strm.avail_in===0)break;if(N=o.strm,j=o.window,k=o.strstart+o.lookahead,H=w,J=void 0,J=N.avail_in,H<J&&(J=H),P=J===0?0:(N.avail_in-=J,s.arraySet(j,N.input,N.next_in,J,k),N.state.wrap===1?N.adler=l(N.adler,j,J,k):N.state.wrap===2&&(N.adler=p(N.adler,j,J,k)),N.next_in+=J,N.total_in+=J,J),o.lookahead+=P,o.lookahead+o.insert>=D)for(C=o.strstart-o.insert,o.ins_h=o.window[C],o.ins_h=(o.ins_h<<o.hash_shift^o.window[C+1])&o.hash_mask;o.insert&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[C+D-1])&o.hash_mask,o.prev[C&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=C,C++,o.insert--,!(o.lookahead+o.insert<D)););}while(o.lookahead<Q&&o.strm.avail_in!==0)}function xt(o,L){for(var P,y;;){if(o.lookahead<Q){if(gt(o),o.lookahead<Q&&L===f)return h;if(o.lookahead===0)break}if(P=0,o.lookahead>=D&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+D-1])&o.hash_mask,P=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),P!==0&&o.strstart-P<=o.w_size-Q&&(o.match_length=Y(o,P)),o.match_length>=D)if(y=a._tr_tally(o,o.strstart-o.match_start,o.match_length-D),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=D){for(o.match_length--;o.strstart++,o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+D-1])&o.hash_mask,P=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart,--o.match_length!=0;);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+1])&o.hash_mask;else y=a._tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(y&&(R(o,!1),o.strm.avail_out===0))return h}return o.insert=o.strstart<D-1?o.strstart:D-1,L===_?(R(o,!0),o.strm.avail_out===0?nt:G):o.last_lit&&(R(o,!1),o.strm.avail_out===0)?h:I}function at(o,L){for(var P,y,w;;){if(o.lookahead<Q){if(gt(o),o.lookahead<Q&&L===f)return h;if(o.lookahead===0)break}if(P=0,o.lookahead>=D&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+D-1])&o.hash_mask,P=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=D-1,P!==0&&o.prev_length<o.max_lazy_match&&o.strstart-P<=o.w_size-Q&&(o.match_length=Y(o,P),o.match_length<=5&&(o.strategy===1||o.match_length===D&&4096<o.strstart-o.match_start)&&(o.match_length=D-1)),o.prev_length>=D&&o.match_length<=o.prev_length){for(w=o.strstart+o.lookahead-D,y=a._tr_tally(o,o.strstart-1-o.prev_match,o.prev_length-D),o.lookahead-=o.prev_length-1,o.prev_length-=2;++o.strstart<=w&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+D-1])&o.hash_mask,P=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),--o.prev_length!=0;);if(o.match_available=0,o.match_length=D-1,o.strstart++,y&&(R(o,!1),o.strm.avail_out===0))return h}else if(o.match_available){if((y=a._tr_tally(o,0,o.window[o.strstart-1]))&&R(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return h}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(y=a._tr_tally(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<D-1?o.strstart:D-1,L===_?(R(o,!0),o.strm.avail_out===0?nt:G):o.last_lit&&(R(o,!1),o.strm.avail_out===0)?h:I}function ut(o,L,P,y,w){this.good_length=o,this.max_lazy=L,this.nice_length=P,this.max_chain=y,this.func=w}function wt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*O),this.dyn_dtree=new s.Buf16(2*(2*S+1)),this.bl_tree=new s.Buf16(2*(2*U+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16($+1),this.heap=new s.Buf16(2*T+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*T+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function vt(o){var L;return o&&o.state?(o.total_in=o.total_out=0,o.data_type=d,(L=o.state).pending=0,L.pending_out=0,L.wrap<0&&(L.wrap=-L.wrap),L.status=L.wrap?E:B,o.adler=L.wrap===2?0:1,L.last_flush=f,a._tr_init(L),c):st(o,v)}function Dt(o){var L=vt(o);return L===c&&function(P){P.window_size=2*P.w_size,rt(P.head),P.max_lazy_match=n[P.level].max_lazy,P.good_match=n[P.level].good_length,P.nice_match=n[P.level].nice_length,P.max_chain_length=n[P.level].max_chain,P.strstart=0,P.block_start=0,P.lookahead=0,P.insert=0,P.match_length=P.prev_length=D-1,P.match_available=0,P.ins_h=0}(o.state),L}function zt(o,L,P,y,w,C){if(!o)return v;var N=1;if(L===u&&(L=6),y<0?(N=0,y=-y):15<y&&(N=2,y-=16),w<1||x<w||P!==g||y<8||15<y||L<0||9<L||C<0||m<C)return st(o,v);y===8&&(y=9);var j=new wt;return(o.state=j).strm=o,j.wrap=N,j.gzhead=null,j.w_bits=y,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=w+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+D-1)/D),j.window=new s.Buf8(2*j.w_size),j.head=new s.Buf16(j.hash_size),j.prev=new s.Buf16(j.w_size),j.lit_bufsize=1<<w+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new s.Buf8(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=L,j.strategy=C,j.method=P,Dt(o)}n=[new ut(0,0,0,0,function(o,L){var P=65535;for(P>o.pending_buf_size-5&&(P=o.pending_buf_size-5);;){if(o.lookahead<=1){if(gt(o),o.lookahead===0&&L===f)return h;if(o.lookahead===0)break}o.strstart+=o.lookahead,o.lookahead=0;var y=o.block_start+P;if((o.strstart===0||o.strstart>=y)&&(o.lookahead=o.strstart-y,o.strstart=y,R(o,!1),o.strm.avail_out===0)||o.strstart-o.block_start>=o.w_size-Q&&(R(o,!1),o.strm.avail_out===0))return h}return o.insert=0,L===_?(R(o,!0),o.strm.avail_out===0?nt:G):(o.strstart>o.block_start&&(R(o,!1),o.strm.avail_out),h)}),new ut(4,4,8,4,xt),new ut(4,5,16,8,xt),new ut(4,6,32,32,xt),new ut(4,4,16,16,at),new ut(8,16,32,32,at),new ut(8,16,128,128,at),new ut(8,32,128,256,at),new ut(32,128,258,1024,at),new ut(32,258,258,4096,at)],i.deflateInit=function(o,L){return zt(o,L,g,15,8,0)},i.deflateInit2=zt,i.deflateReset=Dt,i.deflateResetKeep=vt,i.deflateSetHeader=function(o,L){return o&&o.state?o.state.wrap!==2?v:(o.state.gzhead=L,c):v},i.deflate=function(o,L){var P,y,w,C;if(!o||!o.state||5<L||L<0)return o?st(o,v):v;if(y=o.state,!o.output||!o.input&&o.avail_in!==0||y.status===666&&L!==_)return st(o,o.avail_out===0?-5:v);if(y.strm=o,P=y.last_flush,y.last_flush=L,y.status===E)if(y.wrap===2)o.adler=0,et(y,31),et(y,139),et(y,8),y.gzhead?(et(y,(y.gzhead.text?1:0)+(y.gzhead.hcrc?2:0)+(y.gzhead.extra?4:0)+(y.gzhead.name?8:0)+(y.gzhead.comment?16:0)),et(y,255&y.gzhead.time),et(y,y.gzhead.time>>8&255),et(y,y.gzhead.time>>16&255),et(y,y.gzhead.time>>24&255),et(y,y.level===9?2:2<=y.strategy||y.level<2?4:0),et(y,255&y.gzhead.os),y.gzhead.extra&&y.gzhead.extra.length&&(et(y,255&y.gzhead.extra.length),et(y,y.gzhead.extra.length>>8&255)),y.gzhead.hcrc&&(o.adler=p(o.adler,y.pending_buf,y.pending,0)),y.gzindex=0,y.status=69):(et(y,0),et(y,0),et(y,0),et(y,0),et(y,0),et(y,y.level===9?2:2<=y.strategy||y.level<2?4:0),et(y,3),y.status=B);else{var N=g+(y.w_bits-8<<4)<<8;N|=(2<=y.strategy||y.level<2?0:y.level<6?1:y.level===6?2:3)<<6,y.strstart!==0&&(N|=32),N+=31-N%31,y.status=B,K(y,N),y.strstart!==0&&(K(y,o.adler>>>16),K(y,65535&o.adler)),o.adler=1}if(y.status===69)if(y.gzhead.extra){for(w=y.pending;y.gzindex<(65535&y.gzhead.extra.length)&&(y.pending!==y.pending_buf_size||(y.gzhead.hcrc&&y.pending>w&&(o.adler=p(o.adler,y.pending_buf,y.pending-w,w)),z(o),w=y.pending,y.pending!==y.pending_buf_size));)et(y,255&y.gzhead.extra[y.gzindex]),y.gzindex++;y.gzhead.hcrc&&y.pending>w&&(o.adler=p(o.adler,y.pending_buf,y.pending-w,w)),y.gzindex===y.gzhead.extra.length&&(y.gzindex=0,y.status=73)}else y.status=73;if(y.status===73)if(y.gzhead.name){w=y.pending;do{if(y.pending===y.pending_buf_size&&(y.gzhead.hcrc&&y.pending>w&&(o.adler=p(o.adler,y.pending_buf,y.pending-w,w)),z(o),w=y.pending,y.pending===y.pending_buf_size)){C=1;break}C=y.gzindex<y.gzhead.name.length?255&y.gzhead.name.charCodeAt(y.gzindex++):0,et(y,C)}while(C!==0);y.gzhead.hcrc&&y.pending>w&&(o.adler=p(o.adler,y.pending_buf,y.pending-w,w)),C===0&&(y.gzindex=0,y.status=91)}else y.status=91;if(y.status===91)if(y.gzhead.comment){w=y.pending;do{if(y.pending===y.pending_buf_size&&(y.gzhead.hcrc&&y.pending>w&&(o.adler=p(o.adler,y.pending_buf,y.pending-w,w)),z(o),w=y.pending,y.pending===y.pending_buf_size)){C=1;break}C=y.gzindex<y.gzhead.comment.length?255&y.gzhead.comment.charCodeAt(y.gzindex++):0,et(y,C)}while(C!==0);y.gzhead.hcrc&&y.pending>w&&(o.adler=p(o.adler,y.pending_buf,y.pending-w,w)),C===0&&(y.status=103)}else y.status=103;if(y.status===103&&(y.gzhead.hcrc?(y.pending+2>y.pending_buf_size&&z(o),y.pending+2<=y.pending_buf_size&&(et(y,255&o.adler),et(y,o.adler>>8&255),o.adler=0,y.status=B)):y.status=B),y.pending!==0){if(z(o),o.avail_out===0)return y.last_flush=-1,c}else if(o.avail_in===0&&V(L)<=V(P)&&L!==_)return st(o,-5);if(y.status===666&&o.avail_in!==0)return st(o,-5);if(o.avail_in!==0||y.lookahead!==0||L!==f&&y.status!==666){var j=y.strategy===2?function(k,H){for(var J;;){if(k.lookahead===0&&(gt(k),k.lookahead===0)){if(H===f)return h;break}if(k.match_length=0,J=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++,J&&(R(k,!1),k.strm.avail_out===0))return h}return k.insert=0,H===_?(R(k,!0),k.strm.avail_out===0?nt:G):k.last_lit&&(R(k,!1),k.strm.avail_out===0)?h:I}(y,L):y.strategy===3?function(k,H){for(var J,Z,tt,dt,ot=k.window;;){if(k.lookahead<=W){if(gt(k),k.lookahead<=W&&H===f)return h;if(k.lookahead===0)break}if(k.match_length=0,k.lookahead>=D&&0<k.strstart&&(Z=ot[tt=k.strstart-1])===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]){dt=k.strstart+W;do;while(Z===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]&&Z===ot[++tt]&&tt<dt);k.match_length=W-(dt-tt),k.match_length>k.lookahead&&(k.match_length=k.lookahead)}if(k.match_length>=D?(J=a._tr_tally(k,1,k.match_length-D),k.lookahead-=k.match_length,k.strstart+=k.match_length,k.match_length=0):(J=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++),J&&(R(k,!1),k.strm.avail_out===0))return h}return k.insert=0,H===_?(R(k,!0),k.strm.avail_out===0?nt:G):k.last_lit&&(R(k,!1),k.strm.avail_out===0)?h:I}(y,L):n[y.level].func(y,L);if(j!==nt&&j!==G||(y.status=666),j===h||j===nt)return o.avail_out===0&&(y.last_flush=-1),c;if(j===I&&(L===1?a._tr_align(y):L!==5&&(a._tr_stored_block(y,0,0,!1),L===3&&(rt(y.head),y.lookahead===0&&(y.strstart=0,y.block_start=0,y.insert=0))),z(o),o.avail_out===0))return y.last_flush=-1,c}return L!==_?c:y.wrap<=0?1:(y.wrap===2?(et(y,255&o.adler),et(y,o.adler>>8&255),et(y,o.adler>>16&255),et(y,o.adler>>24&255),et(y,255&o.total_in),et(y,o.total_in>>8&255),et(y,o.total_in>>16&255),et(y,o.total_in>>24&255)):(K(y,o.adler>>>16),K(y,65535&o.adler)),z(o),0<y.wrap&&(y.wrap=-y.wrap),y.pending!==0?c:1)},i.deflateEnd=function(o){var L;return o&&o.state?(L=o.state.status)!==E&&L!==69&&L!==73&&L!==91&&L!==103&&L!==B&&L!==666?st(o,v):(o.state=null,L===B?st(o,-3):c):v},i.deflateSetDictionary=function(o,L){var P,y,w,C,N,j,k,H,J=L.length;if(!o||!o.state||(C=(P=o.state).wrap)===2||C===1&&P.status!==E||P.lookahead)return v;for(C===1&&(o.adler=l(o.adler,L,J,0)),P.wrap=0,J>=P.w_size&&(C===0&&(rt(P.head),P.strstart=0,P.block_start=0,P.insert=0),H=new s.Buf8(P.w_size),s.arraySet(H,L,J-P.w_size,P.w_size,0),L=H,J=P.w_size),N=o.avail_in,j=o.next_in,k=o.input,o.avail_in=J,o.next_in=0,o.input=L,gt(P);P.lookahead>=D;){for(y=P.strstart,w=P.lookahead-(D-1);P.ins_h=(P.ins_h<<P.hash_shift^P.window[y+D-1])&P.hash_mask,P.prev[y&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=y,y++,--w;);P.strstart=y,P.lookahead=D-1,gt(P)}return P.strstart+=P.lookahead,P.block_start=P.strstart,P.insert=P.lookahead,P.lookahead=0,P.match_length=P.prev_length=D-1,P.match_available=0,o.next_in=j,o.input=k,o.avail_in=N,P.wrap=C,c},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,i){r.exports=function(n,s){var a,l,p,b,f,_,c,v,u,m,d,g,x,T,S,U,O,$,D,W,Q,E,B,h,I;a=n.state,l=n.next_in,h=n.input,p=l+(n.avail_in-5),b=n.next_out,I=n.output,f=b-(s-n.avail_out),_=b+(n.avail_out-257),c=a.dmax,v=a.wsize,u=a.whave,m=a.wnext,d=a.window,g=a.hold,x=a.bits,T=a.lencode,S=a.distcode,U=(1<<a.lenbits)-1,O=(1<<a.distbits)-1;t:do{x<15&&(g+=h[l++]<<x,x+=8,g+=h[l++]<<x,x+=8),$=T[g&U];e:for(;;){if(g>>>=D=$>>>24,x-=D,(D=$>>>16&255)===0)I[b++]=65535&$;else{if(!(16&D)){if((64&D)==0){$=T[(65535&$)+(g&(1<<D)-1)];continue e}if(32&D){a.mode=12;break t}n.msg="invalid literal/length code",a.mode=30;break t}W=65535&$,(D&=15)&&(x<D&&(g+=h[l++]<<x,x+=8),W+=g&(1<<D)-1,g>>>=D,x-=D),x<15&&(g+=h[l++]<<x,x+=8,g+=h[l++]<<x,x+=8),$=S[g&O];r:for(;;){if(g>>>=D=$>>>24,x-=D,!(16&(D=$>>>16&255))){if((64&D)==0){$=S[(65535&$)+(g&(1<<D)-1)];continue r}n.msg="invalid distance code",a.mode=30;break t}if(Q=65535&$,x<(D&=15)&&(g+=h[l++]<<x,(x+=8)<D&&(g+=h[l++]<<x,x+=8)),c<(Q+=g&(1<<D)-1)){n.msg="invalid distance too far back",a.mode=30;break t}if(g>>>=D,x-=D,(D=b-f)<Q){if(u<(D=Q-D)&&a.sane){n.msg="invalid distance too far back",a.mode=30;break t}if(B=d,(E=0)===m){if(E+=v-D,D<W){for(W-=D;I[b++]=d[E++],--D;);E=b-Q,B=I}}else if(m<D){if(E+=v+m-D,(D-=m)<W){for(W-=D;I[b++]=d[E++],--D;);if(E=0,m<W){for(W-=D=m;I[b++]=d[E++],--D;);E=b-Q,B=I}}}else if(E+=m-D,D<W){for(W-=D;I[b++]=d[E++],--D;);E=b-Q,B=I}for(;2<W;)I[b++]=B[E++],I[b++]=B[E++],I[b++]=B[E++],W-=3;W&&(I[b++]=B[E++],1<W&&(I[b++]=B[E++]))}else{for(E=b-Q;I[b++]=I[E++],I[b++]=I[E++],I[b++]=I[E++],2<(W-=3););W&&(I[b++]=I[E++],1<W&&(I[b++]=I[E++]))}break}}break}}while(l<p&&b<_);l-=W=x>>3,g&=(1<<(x-=W<<3))-1,n.next_in=l,n.next_out=b,n.avail_in=l<p?p-l+5:5-(l-p),n.avail_out=b<_?_-b+257:257-(b-_),a.hold=g,a.bits=x}},{}],49:[function(e,r,i){var n=e("../utils/common"),s=e("./adler32"),a=e("./crc32"),l=e("./inffast"),p=e("./inftrees"),b=1,f=2,_=0,c=-2,v=1,u=852,m=592;function d(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(E){var B;return E&&E.state?(B=E.state,E.total_in=E.total_out=B.total=0,E.msg="",B.wrap&&(E.adler=1&B.wrap),B.mode=v,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new n.Buf32(u),B.distcode=B.distdyn=new n.Buf32(m),B.sane=1,B.back=-1,_):c}function T(E){var B;return E&&E.state?((B=E.state).wsize=0,B.whave=0,B.wnext=0,x(E)):c}function S(E,B){var h,I;return E&&E.state?(I=E.state,B<0?(h=0,B=-B):(h=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?c:(I.window!==null&&I.wbits!==B&&(I.window=null),I.wrap=h,I.wbits=B,T(E))):c}function U(E,B){var h,I;return E?(I=new g,(E.state=I).window=null,(h=S(E,B))!==_&&(E.state=null),h):c}var O,$,D=!0;function W(E){if(D){var B;for(O=new n.Buf32(512),$=new n.Buf32(32),B=0;B<144;)E.lens[B++]=8;for(;B<256;)E.lens[B++]=9;for(;B<280;)E.lens[B++]=7;for(;B<288;)E.lens[B++]=8;for(p(b,E.lens,0,288,O,0,E.work,{bits:9}),B=0;B<32;)E.lens[B++]=5;p(f,E.lens,0,32,$,0,E.work,{bits:5}),D=!1}E.lencode=O,E.lenbits=9,E.distcode=$,E.distbits=5}function Q(E,B,h,I){var nt,G=E.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new n.Buf8(G.wsize)),I>=G.wsize?(n.arraySet(G.window,B,h-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(I<(nt=G.wsize-G.wnext)&&(nt=I),n.arraySet(G.window,B,h-I,nt,G.wnext),(I-=nt)?(n.arraySet(G.window,B,h-I,I,0),G.wnext=I,G.whave=G.wsize):(G.wnext+=nt,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=nt))),0}i.inflateReset=T,i.inflateReset2=S,i.inflateResetKeep=x,i.inflateInit=function(E){return U(E,15)},i.inflateInit2=U,i.inflate=function(E,B){var h,I,nt,G,st,V,rt,z,R,et,K,Y,gt,xt,at,ut,wt,vt,Dt,zt,o,L,P,y,w=0,C=new n.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return c;(h=E.state).mode===12&&(h.mode=13),st=E.next_out,nt=E.output,rt=E.avail_out,G=E.next_in,I=E.input,V=E.avail_in,z=h.hold,R=h.bits,et=V,K=rt,L=_;t:for(;;)switch(h.mode){case v:if(h.wrap===0){h.mode=13;break}for(;R<16;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(2&h.wrap&&z===35615){C[h.check=0]=255&z,C[1]=z>>>8&255,h.check=a(h.check,C,2,0),R=z=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&z)<<8)+(z>>8))%31){E.msg="incorrect header check",h.mode=30;break}if((15&z)!=8){E.msg="unknown compression method",h.mode=30;break}if(R-=4,o=8+(15&(z>>>=4)),h.wbits===0)h.wbits=o;else if(o>h.wbits){E.msg="invalid window size",h.mode=30;break}h.dmax=1<<o,E.adler=h.check=1,h.mode=512&z?10:12,R=z=0;break;case 2:for(;R<16;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(h.flags=z,(255&h.flags)!=8){E.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){E.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=z>>8&1),512&h.flags&&(C[0]=255&z,C[1]=z>>>8&255,h.check=a(h.check,C,2,0)),R=z=0,h.mode=3;case 3:for(;R<32;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}h.head&&(h.head.time=z),512&h.flags&&(C[0]=255&z,C[1]=z>>>8&255,C[2]=z>>>16&255,C[3]=z>>>24&255,h.check=a(h.check,C,4,0)),R=z=0,h.mode=4;case 4:for(;R<16;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}h.head&&(h.head.xflags=255&z,h.head.os=z>>8),512&h.flags&&(C[0]=255&z,C[1]=z>>>8&255,h.check=a(h.check,C,2,0)),R=z=0,h.mode=5;case 5:if(1024&h.flags){for(;R<16;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}h.length=z,h.head&&(h.head.extra_len=z),512&h.flags&&(C[0]=255&z,C[1]=z>>>8&255,h.check=a(h.check,C,2,0)),R=z=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(V<(Y=h.length)&&(Y=V),Y&&(h.head&&(o=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),n.arraySet(h.head.extra,I,G,Y,o)),512&h.flags&&(h.check=a(h.check,I,Y,G)),V-=Y,G+=Y,h.length-=Y),h.length))break t;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(V===0)break t;for(Y=0;o=I[G+Y++],h.head&&o&&h.length<65536&&(h.head.name+=String.fromCharCode(o)),o&&Y<V;);if(512&h.flags&&(h.check=a(h.check,I,Y,G)),V-=Y,G+=Y,o)break t}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(V===0)break t;for(Y=0;o=I[G+Y++],h.head&&o&&h.length<65536&&(h.head.comment+=String.fromCharCode(o)),o&&Y<V;);if(512&h.flags&&(h.check=a(h.check,I,Y,G)),V-=Y,G+=Y,o)break t}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;R<16;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(z!==(65535&h.check)){E.msg="header crc mismatch",h.mode=30;break}R=z=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),E.adler=h.check=0,h.mode=12;break;case 10:for(;R<32;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}E.adler=h.check=d(z),R=z=0,h.mode=11;case 11:if(h.havedict===0)return E.next_out=st,E.avail_out=rt,E.next_in=G,E.avail_in=V,h.hold=z,h.bits=R,2;E.adler=h.check=1,h.mode=12;case 12:if(B===5||B===6)break t;case 13:if(h.last){z>>>=7&R,R-=7&R,h.mode=27;break}for(;R<3;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}switch(h.last=1&z,R-=1,3&(z>>>=1)){case 0:h.mode=14;break;case 1:if(W(h),h.mode=20,B!==6)break;z>>>=2,R-=2;break t;case 2:h.mode=17;break;case 3:E.msg="invalid block type",h.mode=30}z>>>=2,R-=2;break;case 14:for(z>>>=7&R,R-=7&R;R<32;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if((65535&z)!=(z>>>16^65535)){E.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&z,R=z=0,h.mode=15,B===6)break t;case 15:h.mode=16;case 16:if(Y=h.length){if(V<Y&&(Y=V),rt<Y&&(Y=rt),Y===0)break t;n.arraySet(nt,I,G,Y,st),V-=Y,G+=Y,rt-=Y,st+=Y,h.length-=Y;break}h.mode=12;break;case 17:for(;R<14;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(h.nlen=257+(31&z),z>>>=5,R-=5,h.ndist=1+(31&z),z>>>=5,R-=5,h.ncode=4+(15&z),z>>>=4,R-=4,286<h.nlen||30<h.ndist){E.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;R<3;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}h.lens[N[h.have++]]=7&z,z>>>=3,R-=3}for(;h.have<19;)h.lens[N[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,P={bits:h.lenbits},L=p(0,h.lens,0,19,h.lencode,0,h.work,P),h.lenbits=P.bits,L){E.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;ut=(w=h.lencode[z&(1<<h.lenbits)-1])>>>16&255,wt=65535&w,!((at=w>>>24)<=R);){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(wt<16)z>>>=at,R-=at,h.lens[h.have++]=wt;else{if(wt===16){for(y=at+2;R<y;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(z>>>=at,R-=at,h.have===0){E.msg="invalid bit length repeat",h.mode=30;break}o=h.lens[h.have-1],Y=3+(3&z),z>>>=2,R-=2}else if(wt===17){for(y=at+3;R<y;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}R-=at,o=0,Y=3+(7&(z>>>=at)),z>>>=3,R-=3}else{for(y=at+7;R<y;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}R-=at,o=0,Y=11+(127&(z>>>=at)),z>>>=7,R-=7}if(h.have+Y>h.nlen+h.ndist){E.msg="invalid bit length repeat",h.mode=30;break}for(;Y--;)h.lens[h.have++]=o}}if(h.mode===30)break;if(h.lens[256]===0){E.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,P={bits:h.lenbits},L=p(b,h.lens,0,h.nlen,h.lencode,0,h.work,P),h.lenbits=P.bits,L){E.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,P={bits:h.distbits},L=p(f,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,P),h.distbits=P.bits,L){E.msg="invalid distances set",h.mode=30;break}if(h.mode=20,B===6)break t;case 20:h.mode=21;case 21:if(6<=V&&258<=rt){E.next_out=st,E.avail_out=rt,E.next_in=G,E.avail_in=V,h.hold=z,h.bits=R,l(E,K),st=E.next_out,nt=E.output,rt=E.avail_out,G=E.next_in,I=E.input,V=E.avail_in,z=h.hold,R=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;ut=(w=h.lencode[z&(1<<h.lenbits)-1])>>>16&255,wt=65535&w,!((at=w>>>24)<=R);){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(ut&&(240&ut)==0){for(vt=at,Dt=ut,zt=wt;ut=(w=h.lencode[zt+((z&(1<<vt+Dt)-1)>>vt)])>>>16&255,wt=65535&w,!(vt+(at=w>>>24)<=R);){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}z>>>=vt,R-=vt,h.back+=vt}if(z>>>=at,R-=at,h.back+=at,h.length=wt,ut===0){h.mode=26;break}if(32&ut){h.back=-1,h.mode=12;break}if(64&ut){E.msg="invalid literal/length code",h.mode=30;break}h.extra=15&ut,h.mode=22;case 22:if(h.extra){for(y=h.extra;R<y;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}h.length+=z&(1<<h.extra)-1,z>>>=h.extra,R-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;ut=(w=h.distcode[z&(1<<h.distbits)-1])>>>16&255,wt=65535&w,!((at=w>>>24)<=R);){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if((240&ut)==0){for(vt=at,Dt=ut,zt=wt;ut=(w=h.distcode[zt+((z&(1<<vt+Dt)-1)>>vt)])>>>16&255,wt=65535&w,!(vt+(at=w>>>24)<=R);){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}z>>>=vt,R-=vt,h.back+=vt}if(z>>>=at,R-=at,h.back+=at,64&ut){E.msg="invalid distance code",h.mode=30;break}h.offset=wt,h.extra=15&ut,h.mode=24;case 24:if(h.extra){for(y=h.extra;R<y;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}h.offset+=z&(1<<h.extra)-1,z>>>=h.extra,R-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){E.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(rt===0)break t;if(Y=K-rt,h.offset>Y){if((Y=h.offset-Y)>h.whave&&h.sane){E.msg="invalid distance too far back",h.mode=30;break}gt=Y>h.wnext?(Y-=h.wnext,h.wsize-Y):h.wnext-Y,Y>h.length&&(Y=h.length),xt=h.window}else xt=nt,gt=st-h.offset,Y=h.length;for(rt<Y&&(Y=rt),rt-=Y,h.length-=Y;nt[st++]=xt[gt++],--Y;);h.length===0&&(h.mode=21);break;case 26:if(rt===0)break t;nt[st++]=h.length,rt--,h.mode=21;break;case 27:if(h.wrap){for(;R<32;){if(V===0)break t;V--,z|=I[G++]<<R,R+=8}if(K-=rt,E.total_out+=K,h.total+=K,K&&(E.adler=h.check=h.flags?a(h.check,nt,K,st-K):s(h.check,nt,K,st-K)),K=rt,(h.flags?z:d(z))!==h.check){E.msg="incorrect data check",h.mode=30;break}R=z=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;R<32;){if(V===0)break t;V--,z+=I[G++]<<R,R+=8}if(z!==(4294967295&h.total)){E.msg="incorrect length check",h.mode=30;break}R=z=0}h.mode=29;case 29:L=1;break t;case 30:L=-3;break t;case 31:return-4;case 32:default:return c}return E.next_out=st,E.avail_out=rt,E.next_in=G,E.avail_in=V,h.hold=z,h.bits=R,(h.wsize||K!==E.avail_out&&h.mode<30&&(h.mode<27||B!==4))&&Q(E,E.output,E.next_out,K-E.avail_out)?(h.mode=31,-4):(et-=E.avail_in,K-=E.avail_out,E.total_in+=et,E.total_out+=K,h.total+=K,h.wrap&&K&&(E.adler=h.check=h.flags?a(h.check,nt,K,E.next_out-K):s(h.check,nt,K,E.next_out-K)),E.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(et==0&&K===0||B===4)&&L===_&&(L=-5),L)},i.inflateEnd=function(E){if(!E||!E.state)return c;var B=E.state;return B.window&&(B.window=null),E.state=null,_},i.inflateGetHeader=function(E,B){var h;return E&&E.state?(2&(h=E.state).wrap)==0?c:((h.head=B).done=!1,_):c},i.inflateSetDictionary=function(E,B){var h,I=B.length;return E&&E.state?(h=E.state).wrap!==0&&h.mode!==11?c:h.mode===11&&s(1,B,I,0)!==h.check?-3:Q(E,B,I,I)?(h.mode=31,-4):(h.havedict=1,_):c},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,i){var n=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(b,f,_,c,v,u,m,d){var g,x,T,S,U,O,$,D,W,Q=d.bits,E=0,B=0,h=0,I=0,nt=0,G=0,st=0,V=0,rt=0,z=0,R=null,et=0,K=new n.Buf16(16),Y=new n.Buf16(16),gt=null,xt=0;for(E=0;E<=15;E++)K[E]=0;for(B=0;B<c;B++)K[f[_+B]]++;for(nt=Q,I=15;1<=I&&K[I]===0;I--);if(I<nt&&(nt=I),I===0)return v[u++]=20971520,v[u++]=20971520,d.bits=1,0;for(h=1;h<I&&K[h]===0;h++);for(nt<h&&(nt=h),E=V=1;E<=15;E++)if(V<<=1,(V-=K[E])<0)return-1;if(0<V&&(b===0||I!==1))return-1;for(Y[1]=0,E=1;E<15;E++)Y[E+1]=Y[E]+K[E];for(B=0;B<c;B++)f[_+B]!==0&&(m[Y[f[_+B]]++]=B);if(O=b===0?(R=gt=m,19):b===1?(R=s,et-=257,gt=a,xt-=257,256):(R=l,gt=p,-1),E=h,U=u,st=B=z=0,T=-1,S=(rt=1<<(G=nt))-1,b===1&&852<rt||b===2&&592<rt)return 1;for(;;){for($=E-st,W=m[B]<O?(D=0,m[B]):m[B]>O?(D=gt[xt+m[B]],R[et+m[B]]):(D=96,0),g=1<<E-st,h=x=1<<G;v[U+(z>>st)+(x-=g)]=$<<24|D<<16|W|0,x!==0;);for(g=1<<E-1;z&g;)g>>=1;if(g!==0?(z&=g-1,z+=g):z=0,B++,--K[E]==0){if(E===I)break;E=f[_+m[B]]}if(nt<E&&(z&S)!==T){for(st===0&&(st=nt),U+=h,V=1<<(G=E-st);G+st<I&&!((V-=K[G+st])<=0);)G++,V<<=1;if(rt+=1<<G,b===1&&852<rt||b===2&&592<rt)return 1;v[T=z&S]=nt<<24|G<<16|U-u|0}}return z!==0&&(v[U+z]=E-st<<24|64<<16|0),d.bits=nt,0}},{"../utils/common":41}],51:[function(e,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,i){var n=e("../utils/common"),s=0,a=1;function l(w){for(var C=w.length;0<=--C;)w[C]=0}var p=0,b=29,f=256,_=f+1+b,c=30,v=19,u=2*_+1,m=15,d=16,g=7,x=256,T=16,S=17,U=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(_+2));l(Q);var E=new Array(2*c);l(E);var B=new Array(512);l(B);var h=new Array(256);l(h);var I=new Array(b);l(I);var nt,G,st,V=new Array(c);function rt(w,C,N,j,k){this.static_tree=w,this.extra_bits=C,this.extra_base=N,this.elems=j,this.max_length=k,this.has_stree=w&&w.length}function z(w,C){this.dyn_tree=w,this.max_code=0,this.stat_desc=C}function R(w){return w<256?B[w]:B[256+(w>>>7)]}function et(w,C){w.pending_buf[w.pending++]=255&C,w.pending_buf[w.pending++]=C>>>8&255}function K(w,C,N){w.bi_valid>d-N?(w.bi_buf|=C<<w.bi_valid&65535,et(w,w.bi_buf),w.bi_buf=C>>d-w.bi_valid,w.bi_valid+=N-d):(w.bi_buf|=C<<w.bi_valid&65535,w.bi_valid+=N)}function Y(w,C,N){K(w,N[2*C],N[2*C+1])}function gt(w,C){for(var N=0;N|=1&w,w>>>=1,N<<=1,0<--C;);return N>>>1}function xt(w,C,N){var j,k,H=new Array(m+1),J=0;for(j=1;j<=m;j++)H[j]=J=J+N[j-1]<<1;for(k=0;k<=C;k++){var Z=w[2*k+1];Z!==0&&(w[2*k]=gt(H[Z]++,Z))}}function at(w){var C;for(C=0;C<_;C++)w.dyn_ltree[2*C]=0;for(C=0;C<c;C++)w.dyn_dtree[2*C]=0;for(C=0;C<v;C++)w.bl_tree[2*C]=0;w.dyn_ltree[2*x]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0}function ut(w){8<w.bi_valid?et(w,w.bi_buf):0<w.bi_valid&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0}function wt(w,C,N,j){var k=2*C,H=2*N;return w[k]<w[H]||w[k]===w[H]&&j[C]<=j[N]}function vt(w,C,N){for(var j=w.heap[N],k=N<<1;k<=w.heap_len&&(k<w.heap_len&&wt(C,w.heap[k+1],w.heap[k],w.depth)&&k++,!wt(C,j,w.heap[k],w.depth));)w.heap[N]=w.heap[k],N=k,k<<=1;w.heap[N]=j}function Dt(w,C,N){var j,k,H,J,Z=0;if(w.last_lit!==0)for(;j=w.pending_buf[w.d_buf+2*Z]<<8|w.pending_buf[w.d_buf+2*Z+1],k=w.pending_buf[w.l_buf+Z],Z++,j===0?Y(w,k,C):(Y(w,(H=h[k])+f+1,C),(J=O[H])!==0&&K(w,k-=I[H],J),Y(w,H=R(--j),N),(J=$[H])!==0&&K(w,j-=V[H],J)),Z<w.last_lit;);Y(w,x,C)}function zt(w,C){var N,j,k,H=C.dyn_tree,J=C.stat_desc.static_tree,Z=C.stat_desc.has_stree,tt=C.stat_desc.elems,dt=-1;for(w.heap_len=0,w.heap_max=u,N=0;N<tt;N++)H[2*N]!==0?(w.heap[++w.heap_len]=dt=N,w.depth[N]=0):H[2*N+1]=0;for(;w.heap_len<2;)H[2*(k=w.heap[++w.heap_len]=dt<2?++dt:0)]=1,w.depth[k]=0,w.opt_len--,Z&&(w.static_len-=J[2*k+1]);for(C.max_code=dt,N=w.heap_len>>1;1<=N;N--)vt(w,H,N);for(k=tt;N=w.heap[1],w.heap[1]=w.heap[w.heap_len--],vt(w,H,1),j=w.heap[1],w.heap[--w.heap_max]=N,w.heap[--w.heap_max]=j,H[2*k]=H[2*N]+H[2*j],w.depth[k]=(w.depth[N]>=w.depth[j]?w.depth[N]:w.depth[j])+1,H[2*N+1]=H[2*j+1]=k,w.heap[1]=k++,vt(w,H,1),2<=w.heap_len;);w.heap[--w.heap_max]=w.heap[1],function(ot,Ft){var te,Ot,ee,_t,oe,Ce,Bt=Ft.dyn_tree,ur=Ft.max_code,Oi=Ft.stat_desc.static_tree,Bi=Ft.stat_desc.has_stree,Ui=Ft.stat_desc.extra_bits,dr=Ft.stat_desc.extra_base,re=Ft.stat_desc.max_length,le=0;for(_t=0;_t<=m;_t++)ot.bl_count[_t]=0;for(Bt[2*ot.heap[ot.heap_max]+1]=0,te=ot.heap_max+1;te<u;te++)re<(_t=Bt[2*Bt[2*(Ot=ot.heap[te])+1]+1]+1)&&(_t=re,le++),Bt[2*Ot+1]=_t,ur<Ot||(ot.bl_count[_t]++,oe=0,dr<=Ot&&(oe=Ui[Ot-dr]),Ce=Bt[2*Ot],ot.opt_len+=Ce*(_t+oe),Bi&&(ot.static_len+=Ce*(Oi[2*Ot+1]+oe)));if(le!==0){do{for(_t=re-1;ot.bl_count[_t]===0;)_t--;ot.bl_count[_t]--,ot.bl_count[_t+1]+=2,ot.bl_count[re]--,le-=2}while(0<le);for(_t=re;_t!==0;_t--)for(Ot=ot.bl_count[_t];Ot!==0;)ur<(ee=ot.heap[--te])||(Bt[2*ee+1]!==_t&&(ot.opt_len+=(_t-Bt[2*ee+1])*Bt[2*ee],Bt[2*ee+1]=_t),Ot--)}}(w,C),xt(H,dt,w.bl_count)}function o(w,C,N){var j,k,H=-1,J=C[1],Z=0,tt=7,dt=4;for(J===0&&(tt=138,dt=3),C[2*(N+1)+1]=65535,j=0;j<=N;j++)k=J,J=C[2*(j+1)+1],++Z<tt&&k===J||(Z<dt?w.bl_tree[2*k]+=Z:k!==0?(k!==H&&w.bl_tree[2*k]++,w.bl_tree[2*T]++):Z<=10?w.bl_tree[2*S]++:w.bl_tree[2*U]++,H=k,dt=(Z=0)===J?(tt=138,3):k===J?(tt=6,3):(tt=7,4))}function L(w,C,N){var j,k,H=-1,J=C[1],Z=0,tt=7,dt=4;for(J===0&&(tt=138,dt=3),j=0;j<=N;j++)if(k=J,J=C[2*(j+1)+1],!(++Z<tt&&k===J)){if(Z<dt)for(;Y(w,k,w.bl_tree),--Z!=0;);else k!==0?(k!==H&&(Y(w,k,w.bl_tree),Z--),Y(w,T,w.bl_tree),K(w,Z-3,2)):Z<=10?(Y(w,S,w.bl_tree),K(w,Z-3,3)):(Y(w,U,w.bl_tree),K(w,Z-11,7));H=k,dt=(Z=0)===J?(tt=138,3):k===J?(tt=6,3):(tt=7,4)}}l(V);var P=!1;function y(w,C,N,j){K(w,(p<<1)+(j?1:0),3),function(k,H,J,Z){ut(k),et(k,J),et(k,~J),n.arraySet(k.pending_buf,k.window,H,J,k.pending),k.pending+=J}(w,C,N)}i._tr_init=function(w){P||(function(){var C,N,j,k,H,J=new Array(m+1);for(k=j=0;k<b-1;k++)for(I[k]=j,C=0;C<1<<O[k];C++)h[j++]=k;for(h[j-1]=k,k=H=0;k<16;k++)for(V[k]=H,C=0;C<1<<$[k];C++)B[H++]=k;for(H>>=7;k<c;k++)for(V[k]=H<<7,C=0;C<1<<$[k]-7;C++)B[256+H++]=k;for(N=0;N<=m;N++)J[N]=0;for(C=0;C<=143;)Q[2*C+1]=8,C++,J[8]++;for(;C<=255;)Q[2*C+1]=9,C++,J[9]++;for(;C<=279;)Q[2*C+1]=7,C++,J[7]++;for(;C<=287;)Q[2*C+1]=8,C++,J[8]++;for(xt(Q,_+1,J),C=0;C<c;C++)E[2*C+1]=5,E[2*C]=gt(C,5);nt=new rt(Q,O,f+1,_,m),G=new rt(E,$,0,c,m),st=new rt(new Array(0),D,0,v,g)}(),P=!0),w.l_desc=new z(w.dyn_ltree,nt),w.d_desc=new z(w.dyn_dtree,G),w.bl_desc=new z(w.bl_tree,st),w.bi_buf=0,w.bi_valid=0,at(w)},i._tr_stored_block=y,i._tr_flush_block=function(w,C,N,j){var k,H,J=0;0<w.level?(w.strm.data_type===2&&(w.strm.data_type=function(Z){var tt,dt=4093624447;for(tt=0;tt<=31;tt++,dt>>>=1)if(1&dt&&Z.dyn_ltree[2*tt]!==0)return s;if(Z.dyn_ltree[18]!==0||Z.dyn_ltree[20]!==0||Z.dyn_ltree[26]!==0)return a;for(tt=32;tt<f;tt++)if(Z.dyn_ltree[2*tt]!==0)return a;return s}(w)),zt(w,w.l_desc),zt(w,w.d_desc),J=function(Z){var tt;for(o(Z,Z.dyn_ltree,Z.l_desc.max_code),o(Z,Z.dyn_dtree,Z.d_desc.max_code),zt(Z,Z.bl_desc),tt=v-1;3<=tt&&Z.bl_tree[2*W[tt]+1]===0;tt--);return Z.opt_len+=3*(tt+1)+5+5+4,tt}(w),k=w.opt_len+3+7>>>3,(H=w.static_len+3+7>>>3)<=k&&(k=H)):k=H=N+5,N+4<=k&&C!==-1?y(w,C,N,j):w.strategy===4||H===k?(K(w,2+(j?1:0),3),Dt(w,Q,E)):(K(w,4+(j?1:0),3),function(Z,tt,dt,ot){var Ft;for(K(Z,tt-257,5),K(Z,dt-1,5),K(Z,ot-4,4),Ft=0;Ft<ot;Ft++)K(Z,Z.bl_tree[2*W[Ft]+1],3);L(Z,Z.dyn_ltree,tt-1),L(Z,Z.dyn_dtree,dt-1)}(w,w.l_desc.max_code+1,w.d_desc.max_code+1,J+1),Dt(w,w.dyn_ltree,w.dyn_dtree)),at(w),j&&ut(w)},i._tr_tally=function(w,C,N){return w.pending_buf[w.d_buf+2*w.last_lit]=C>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&C,w.pending_buf[w.l_buf+w.last_lit]=255&N,w.last_lit++,C===0?w.dyn_ltree[2*N]++:(w.matches++,C--,w.dyn_ltree[2*(h[N]+f+1)]++,w.dyn_dtree[2*R(C)]++),w.last_lit===w.lit_bufsize-1},i._tr_align=function(w){K(w,2,3),Y(w,x,Q),function(C){C.bi_valid===16?(et(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):8<=C.bi_valid&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)}(w)}},{"../utils/common":41}],53:[function(e,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,i){(function(n){(function(s,a){if(!s.setImmediate){var l,p,b,f,_=1,c={},v=!1,u=s.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(s);m=m&&m.setTimeout?m:s,l={}.toString.call(s.process)==="[object process]"?function(T){process.nextTick(function(){g(T)})}:function(){if(s.postMessage&&!s.importScripts){var T=!0,S=s.onmessage;return s.onmessage=function(){T=!1},s.postMessage("","*"),s.onmessage=S,T}}()?(f="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",x,!1):s.attachEvent("onmessage",x),function(T){s.postMessage(f+T,"*")}):s.MessageChannel?((b=new MessageChannel).port1.onmessage=function(T){g(T.data)},function(T){b.port2.postMessage(T)}):u&&"onreadystatechange"in u.createElement("script")?(p=u.documentElement,function(T){var S=u.createElement("script");S.onreadystatechange=function(){g(T),S.onreadystatechange=null,p.removeChild(S),S=null},p.appendChild(S)}):function(T){setTimeout(g,0,T)},m.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var S=new Array(arguments.length-1),U=0;U<S.length;U++)S[U]=arguments[U+1];var O={callback:T,args:S};return c[_]=O,l(_),_++},m.clearImmediate=d}function d(T){delete c[T]}function g(T){if(v)setTimeout(g,0,T);else{var S=c[T];if(S){v=!0;try{(function(U){var O=U.callback,$=U.args;switch($.length){case 0:O();break;case 1:O($[0]);break;case 2:O($[0],$[1]);break;case 3:O($[0],$[1],$[2]);break;default:O.apply(a,$)}})(S)}finally{d(T),v=!1}}}}function x(T){T.source===s&&typeof T.data=="string"&&T.data.indexOf(f)===0&&g(+T.data.slice(f.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof ne<"u"?ne:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(pe)),pe.exports}var ii=ri();const ni=ei(ii);class ir{constructor(t){A(this,"canvas");A(this,"options");A(this,"frames",[]);A(this,"currentFrameCount");this.canvas=t,this.currentFrameCount=0}resetRecord(){this.frames=[],this.currentFrameCount=0}setOptions(t){this.options=t}async saveSequentialFrames(){this.options!=null&&await new Promise(t=>{this.canvas.toBlob(e=>{var r,i,n;if(e==null){t();return}((r=this.options)==null?void 0:r.type)=="Frame"?this.save(e,(i=this.options)==null?void 0:i.saveName):this.frames.push({blob:e,frameName:`${(n=this.options)==null?void 0:n.saveName}/frame_${String(this.currentFrameCount+1).padStart(5,"0")}.png`}),this.currentFrameCount++,console.log(this.currentFrameCount),t()},"image/png")})}endRecordingAuto(){if(this.options==null)return!0;if(this.options.type=="StartAndStop")return!1;const t=(this.options.type=="Frame"?1:this.options.frameNum)??0;return this.currentFrameCount>=t}async saveFramesAsZip(t="record.zip"){if(this.frames.length==0)return;const e=new ni;for(let i=0;i<this.frames.length;i++){const n=this.frames[i];e.file(n.frameName,n.blob)}const r=await e.generateAsync({type:"blob"});this.save(r,t)}save(t,e){const r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=e,i.click(),URL.revokeObjectURL(r)}}class si extends tr{constructor(e){super(e);A(this,"recorder");A(this,"isRecording");this.recorder=new ir(this.canvas),this.isRecording=!1,yt.initialize(this.startRecording.bind(this),this.endRecording.bind(this),this.changeSceneClock.bind(this))}async start(){await this.preload(),this.setup(),this.scene.setUpdate(this.update.bind(this)),this.scene.setDraw(this.draw.bind(this)),this.scene.setAdditionalSupport(this.additionalSupport.bind(this)),this.scene.start()}startRecording(){this.isRecording||(this.recorder.resetRecord(),this.recorder.setOptions(yt.recordOptions),this.isRecording=!0)}endRecording(){this.isRecording&&(this.isRecording=!1,yt.recordOptions.type!="Frame"&&this.recorder.saveFramesAsZip())}changeSceneClock(e){const r=yt.recordOptions;e=="RealTime"?this.scene.setRealTimeClock(r.fps):this.scene.setFixedTimeClock(r.fps,r.fixedFrameInterval)}async preload(){await super.preload()}async additionalSupport(){this.isRecording&&(await this.recorder.saveSequentialFrames(),this.recorder.endRecordingAuto()&&this.endRecording())}}class Ut{static initialize(){it.initialize(),it.addFolder("Lighting"),it.addColorElement({ambientColor:"#00000000"},"ambientColor",t=>{this.ambientColor=t}),it.addFolder("LightDirection"),it.addElementWithRange({lightDirectionX:-.5},"lightDirectionX",-1,1,t=>{this.lightDirectionX=t}),it.addElementWithRange({lightDirectionY:.5},"lightDirectionY",-1,1,t=>{this.lightDirectionY=t}),it.addElementWithRange({lightDirectionZ:.5},"lightDirectionZ",-1,1,t=>{this.lightDirectionZ=t}),it.resetFolder(),it.addFolder("EyeDirection"),it.addElementWithRange({eyeDirectionX:0},"eyeDirectionX",0,20,t=>{this.eyeDirectionX=t}),it.addElementWithRange({eyeDirectionY:0},"eyeDirectionY",0,20,t=>{this.eyeDirectionY=t}),it.addElementWithRange({eyeDirectionZ:20},"eyeDirectionZ",0,20,t=>{this.eyeDirectionZ=t}),it.resetFolder()}static get lightOptions(){return{ambientColor:this.ambientColor,lightDirection:new pt(this.lightDirectionX,this.lightDirectionY,this.lightDirectionZ),eyeDirection:new pt(this.eyeDirectionX,this.eyeDirectionY,this.eyeDirectionZ)}}}A(Ut,"ambientColor","#00000000"),A(Ut,"lightDirectionX",-.5),A(Ut,"lightDirectionY",.5),A(Ut,"lightDirectionZ",.5),A(Ut,"eyeDirectionX",0),A(Ut,"eyeDirectionY",0),A(Ut,"eyeDirectionZ",20);class me{static initialize(t,e){this.onAudioPlay=t,this.onAudioStop=e,it.initialize(),it.addFolder("Audio"),it.addAction(()=>{var r;(r=this.onAudioPlay)==null||r.call(this)},"AudioPlay"),it.addAction(()=>{var r;(r=this.onAudioStop)==null||r.call(this)},"AudioStop"),it.resetFolder()}}A(me,"onAudioPlay"),A(me,"onAudioStop");class ai{static initialize(t,e,r){it.initialize(),it.addFolder("PostEffect");let i=0;for(const n of t.keys()){if(i++,i==t.size)break;const s=n.toString(),a={[s]:e.get(s)};it.addElement(a,s,l=>{r(s,l)})}it.resetFolder()}}class ge{static initialize(t,e){this.onPlayScene=t,this.onStopScene=e,it.initialize(),it.addFolder("Scene"),it.addAction(()=>{var r;(r=this.onPlayScene)==null||r.call(this)},"PlayScene"),it.addAction(()=>{var r;(r=this.onStopScene)==null||r.call(this)},"StopScene"),it.resetFolder()}}A(ge,"onPlayScene"),A(ge,"onStopScene");const X={aPosition:3,aColor:4,aUv:2,aNormal:3};class nr{constructor(t){A(this,"gl");A(this,"vao",null);A(this,"buffers");this.gl=t,this.buffers=new Map}addBuffer(t,e){this.buffers.set(t,e)}bindVao(){this.vao==null&&(this.vao=this.gl.createVertexArray()),this.gl.bindVertexArray(this.vao)}bind(){this.bindVao();for(const t of this.buffers.values())t.bind()}unbind(){this.unbindVao();for(const t of this.buffers.values())t.unbind()}unbindVao(){this.gl.bindVertexArray(null)}dispose(){for(const t of this.buffers.values())t.dispose();this.vao&&(this.gl.deleteVertexArray(this.vao),this.vao=null)}}class ve{constructor(t){A(this,"gl");A(this,"buffer",null);this.gl=t,this.buffer=this.gl.createBuffer()}get BufferType(){return this.gl.ARRAY_BUFFER}}class Vt extends ve{constructor(e,r,i,n,s=new Float32Array){super(e);A(this,"interleavedArray");this.interleavedArray=this.createInterleavedArray(r,i,n,s)}get BufferType(){return this.gl.ARRAY_BUFFER}bind(){this.gl.bindBuffer(this.BufferType,this.buffer)}unbind(){this.gl.bindBuffer(this.BufferType,null)}setData(){this.gl.bindBuffer(this.BufferType,this.buffer),this.gl.bufferData(this.BufferType,this.interleavedArray,this.gl.STATIC_DRAW)}dispose(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null)}createInterleavedArray(e,r,i,n){const s=new Float32Array(e.length+r.length+i.length+n.length),a=e.length/X.aPosition,l=r.length/X.aColor;if(a!=l)throw new Error("Vertex array and color array must have the same length.");let p=0;for(let b=0;b<a;b++){const f=b*X.aPosition;s.set(e.subarray(f,f+X.aPosition),p),p+=X.aPosition;const _=b*X.aColor;if(s.set(r.subarray(_,_+X.aColor),p),p+=X.aColor,i.length>0){const c=b*X.aNormal;s.set(i.subarray(c,c+X.aNormal),p),p+=X.aNormal}if(n.length>0){const c=b*X.aUv;s.set(n.subarray(c,c+X.aUv),p),p+=X.aUv}}return console.log(s),s}}class Wt extends ve{constructor(e,r){super(e);A(this,"indices");this.indices=r}get BufferType(){return this.gl.ELEMENT_ARRAY_BUFFER}bind(){this.gl.bindBuffer(this.BufferType,this.buffer)}unbind(){this.gl.bindBuffer(this.BufferType,null)}setData(){this.gl.bindBuffer(this.BufferType,this.buffer),this.gl.bufferData(this.BufferType,this.indices,this.gl.STATIC_DRAW)}dispose(){this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null)}}class Ht{constructor(t){A(this,"vao");A(this,"vertices");A(this,"color");A(this,"normal");A(this,"indices");this.vao=new nr(t),this.vertices=new Float32Array,this.color=new Float32Array,this.normal=new Float32Array,this.indices=new Int16Array}bind(){this.vao.bind()}unbind(){this.vao.unbind()}getIndexCount(){return this.indices.length}dispose(){this.vao.dispose()}}class oi extends Ht{constructor(e,r=1,i=1){super(e);A(this,"uv");this.vertices=new Float32Array([-r*.5,-i*.5,0,r*.5,-i*.5,0,r*.5,i*.5,0,-r*.5,i*.5,0]),this.color=new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1,1,1,1,1]),this.uv=new Float32Array([0,0,1,0,1,1,0,1]),this.indices=new Int16Array([0,1,2,0,2,3])}setUpBuffers(e,r){var a,l;this.vao.bindVao();const i=new Vt(e,this.vertices,this.color,this.uv),n=new Wt(e,this.indices);i.setData(),n.setData();const s=(X.aPosition+X.aColor+X.aUv)*Float32Array.BYTES_PER_ELEMENT;r.aPosition.setAttributeBuffer(e,X.aPosition,e.FLOAT,s,0),(a=r.aColor)==null||a.setAttributeBuffer(e,X.aColor,e.FLOAT,s,X.aPosition*Float32Array.BYTES_PER_ELEMENT),(l=r.aUv)==null||l.setAttributeBuffer(e,X.aUv,e.FLOAT,s,(X.aPosition+X.aColor)*Float32Array.BYTES_PER_ELEMENT),this.vao.addBuffer("geometry",i),this.vao.addBuffer("index",n),i.unbind(),n.unbind(),this.vao.unbindVao()}}class sr extends Ht{constructor(e,r=2,i=2,n=bt.empty()){super(e);A(this,"uv");this.vertices=new Float32Array([-r*.5,i*.5,0,r*.5,i*.5,0,-r*.5,-i*.5,0,r*.5,-i*.5,0]),bt.isEmpty(n)?this.color=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]):this.color=new Float32Array([n.red,n.green,n.blue,n.alpha,n.red,n.green,n.blue,n.alpha,n.red,n.green,n.blue,n.alpha,n.red,n.green,n.blue,n.alpha]),this.normal=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),this.uv=new Float32Array([0,0,1,0,0,1,1,1]),this.indices=new Int16Array([0,1,2,3,2,1])}setUpBuffers(e,r){var a,l,p;this.vao.bindVao();const i=new Vt(e,this.vertices,this.color,this.normal,this.uv),n=new Wt(e,this.indices);i.setData(),n.setData();const s=(X.aPosition+X.aColor+X.aNormal+X.aUv)*Float32Array.BYTES_PER_ELEMENT;r.aPosition.setAttributeBuffer(e,X.aPosition,e.FLOAT,s,0),(a=r.aColor)==null||a.setAttributeBuffer(e,X.aColor,e.FLOAT,s,X.aPosition*Float32Array.BYTES_PER_ELEMENT),(l=r.aNormal)==null||l.setAttributeBuffer(e,X.aNormal,e.FLOAT,s,(X.aPosition+X.aColor)*Float32Array.BYTES_PER_ELEMENT),(p=r.aUv)==null||p.setAttributeBuffer(e,X.aUv,e.FLOAT,s,(X.aPosition+X.aColor+X.aNormal)*Float32Array.BYTES_PER_ELEMENT),this.vao.addBuffer("geometry",i),this.vao.addBuffer("index",n),i.unbind(),n.unbind(),this.vao.unbindVao()}}class li extends Ht{constructor(t,e,r,i,n,s=bt.empty()){super(t);const a=[],l=[],p=[],b=[];for(let f=0;f<=e;f++){const _=It.PI*2/e*f,c=q.cos(_),v=q.sin(_);for(let u=0;u<=r;u++){const m=Math.PI*2/r*u,d=(c*i+n)*q.cos(m),g=v*i,x=(c*i+n)*q.sin(m),T=c*q.cos(m),S=c*q.sin(m);if(a.push(d,g,x),b.push(T,v,S),bt.isEmpty(s)){const U=Xt.hsvToRgb(360/r*u,1,1,1);l.push(U.red,U.green,U.blue,U.alpha)}else l.push(s.red,s.green,s.blue,s.alpha)}}for(let f=0;f<e;f++)for(let _=0;_<r;_++){const c=(r+1)*f+_;p.push(c,c+r+1,c+1),p.push(c+r+1,c+r+2,c+1)}this.vertices=new Float32Array(a),this.color=new Float32Array(l),this.indices=new Int16Array(p),this.normal=new Float32Array(b)}setUpBuffers(t,e){var s,a;this.vao.bindVao();const r=new Vt(t,this.vertices,this.color,this.normal),i=new Wt(t,this.indices);r.setData(),i.setData();const n=(X.aPosition+X.aColor+X.aNormal)*Float32Array.BYTES_PER_ELEMENT;e.aPosition.setAttributeBuffer(t,X.aPosition,t.FLOAT,n,0),(s=e.aColor)==null||s.setAttributeBuffer(t,X.aColor,t.FLOAT,n,X.aPosition*Float32Array.BYTES_PER_ELEMENT),(a=e.aNormal)==null||a.setAttributeBuffer(t,X.aNormal,t.FLOAT,n,(X.aPosition+X.aColor)*Float32Array.BYTES_PER_ELEMENT),this.vao.addBuffer("geometry",r),this.vao.addBuffer("index",i),r.unbind(),i.unbind(),this.vao.unbindVao()}}class hi extends Ht{constructor(t,e,r,i,n=bt.empty()){super(t);const s=[],a=[],l=[],p=[];for(let b=0;b<=e;b++){const f=It.PI/e*b,_=q.cos(f),c=q.sin(f);for(let v=0;v<=r;v++){const u=It.PI*2/r*v,m=c*i*q.cos(u),d=_*i,g=c*i*q.sin(u),x=c*q.cos(u),T=c*q.sin(u);if(s.push(m,d,g),p.push(x,_,T),bt.isEmpty(n)){const S=Xt.hsvToRgb(360/r*v,1,1,1);a.push(S.red,S.green,S.blue,S.alpha)}else a.push(n.red,n.green,n.blue,n.alpha)}}for(let b=0;b<e;b++)for(let f=0;f<r;f++){const _=(r+1)*b+f;l.push(_,_+1,_+r+2),l.push(_,_+r+2,_+r+1)}this.vertices=new Float32Array(s),this.color=new Float32Array(a),this.indices=new Int16Array(l),this.normal=new Float32Array(p)}setUpBuffers(t,e){var s,a;this.vao.bindVao();const r=new Vt(t,this.vertices,this.color,this.normal),i=new Wt(t,this.indices);r.setData(),i.setData();const n=(X.aPosition+X.aColor+X.aNormal)*Float32Array.BYTES_PER_ELEMENT;e.aPosition.setAttributeBuffer(t,X.aPosition,t.FLOAT,n,0),(s=e.aColor)==null||s.setAttributeBuffer(t,X.aColor,t.FLOAT,n,X.aPosition*Float32Array.BYTES_PER_ELEMENT),(a=e.aNormal)==null||a.setAttributeBuffer(t,X.aNormal,t.FLOAT,n,(X.aPosition+X.aColor)*Float32Array.BYTES_PER_ELEMENT),this.vao.addBuffer("geometry",r),this.vao.addBuffer("index",i),r.unbind(),i.unbind(),this.vao.unbindVao()}}class ci extends Ht{constructor(e,r,i){super(e);A(this,"uv");A(this,"width",0);A(this,"height",0);let n=0,s=0,a=[],l=[],p=[],b=[],f=[];const _=1/i.getTextureSize().width,c=1/i.getTextureSize().height;let v=0,u=0;for(const m of r){const d=m.getOffset(),g=m.getResolution(),x=d[0]+n,T=d[1],S=x+g[0],U=T+g[1],O=x*_,$=T*c,D=S*_,W=U*c;a.push(O,$,0,D,$,0,O,W,0,D,W,0);const Q=m.getUv();l.push(Q.u0,Q.v1,Q.u1,Q.v1,Q.u0,Q.v0,Q.u1,Q.v0),b.push(0+s,1+s,2+s,3+s,2+s,1+s),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.push(0,0,1,0,0,1,0,0,1,0,0,1),s+=4,n+=m.getXAdvance(),v=Math.max(v,U),u=Math.min(u,T)}this.vertices=new Float32Array(a),this.color=new Float32Array(f),this.indices=new Int16Array(b),this.normal=new Float32Array(p),this.uv=new Float32Array(l),this.width=n*_,this.height=(v-u)*c}setUpBuffers(e,r){var a,l,p;this.vao.bindVao();const i=new Vt(e,this.vertices,this.color,this.normal,this.uv),n=new Wt(e,this.indices);i.setData(),n.setData();const s=(X.aPosition+X.aColor+X.aNormal+X.aUv)*Float32Array.BYTES_PER_ELEMENT;r.aPosition.setAttributeBuffer(e,X.aPosition,e.FLOAT,s,0),(a=r.aColor)==null||a.setAttributeBuffer(e,X.aColor,e.FLOAT,s,X.aPosition*Float32Array.BYTES_PER_ELEMENT),(l=r.aNormal)==null||l.setAttributeBuffer(e,X.aNormal,e.FLOAT,s,(X.aPosition+X.aColor)*Float32Array.BYTES_PER_ELEMENT),(p=r.aUv)==null||p.setAttributeBuffer(e,X.aUv,e.FLOAT,s,(X.aPosition+X.aColor+X.aNormal)*Float32Array.BYTES_PER_ELEMENT),this.vao.addBuffer("geometry",i),this.vao.addBuffer("index",n),i.unbind(),n.unbind(),this.vao.unbindVao()}get resolution(){return[this.width,this.height]}}class ui{constructor(t,e){A(this,"gl");A(this,"texture");this.gl=t,this.texture=e}bind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}getTextureSize(){throw new Error("Method not implemented.")}}class _e{constructor(t,e){A(this,"gl");A(this,"fbo");A(this,"rbo");A(this,"texture");A(this,"width");A(this,"height");this.gl=t,this.width=e[0],this.height=e[1],this.setUpFrameBuffer()}drawToFrameBuffer(t){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.clearColor(0,0,1,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,this.width,this.height),t(),e.bindFramebuffer(e.FRAMEBUFFER,null)}drawToScreen(t){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.width,this.height),t()}bind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}getTexture(){return this.texture}resize(t){this.width===t[0]&&this.height===t[1]||(this.width=t[0],this.height=t[1])}dispose(){const t=this.gl;this.texture&&(t.deleteTexture(this.texture),this.texture=void 0),this.rbo&&(t.deleteRenderbuffer(this.rbo),this.rbo=void 0),this.fbo&&(t.deleteFramebuffer(this.fbo),this.fbo=void 0)}setUpFrameBuffer(){const t=this.gl;this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.rbo=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.rbo),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.rbo),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)}}class di{constructor(t,e){A(this,"targets");A(this,"readIndex",0);this.targets=[new _e(t,e),new _e(t,e)],this.readIndex=0}get read(){return this.targets[this.readIndex]}get write(){return this.targets[1-this.readIndex]}swap(){this.readIndex=1-this.readIndex}resize(t){this.targets[0].resize(t),this.targets[1].resize(t)}dispose(){this.targets[0].dispose(),this.targets[1].dispose()}}class fi{constructor(){A(this,"audioBuffer")}async load(t,e){const i=await(await fetch(t)).arrayBuffer();this.audioBuffer=await e.decodeAudioData(i)}getBuffer(){return this.audioBuffer}}class pi{constructor(t,e,r=2){A(this,"audioBuffer");A(this,"gl");A(this,"shaderLoader");A(this,"sampleRate",44100);A(this,"duration",2);this.gl=t,this.shaderLoader=e,this.duration=r}async load(t,e){const r=this.shaderLoader.getShaderProgram(t),i=Math.floor(this.sampleRate*this.duration),n=this.gl,s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,i*2*4,n.DYNAMIC_COPY),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,0,s),r.use(n),r.setUniform(n,"uSampleRate",new ct(this.sampleRate)),r.setUniform(n,"uTimeOffset",new ct(0)),n.enable(n.RASTERIZER_DISCARD),n.beginTransformFeedback(n.POINTS),n.drawArrays(n.POINTS,0,i),n.endTransformFeedback(),n.disable(n.RASTERIZER_DISCARD);const a=new Float32Array(i*2);n.bindBuffer(n.TRANSFORM_FEEDBACK_BUFFER,s),n.getBufferSubData(n.TRANSFORM_FEEDBACK_BUFFER,0,a);const l=e.createBuffer(2,a.length,this.sampleRate),p=l.getChannelData(0),b=l.getChannelData(1);for(let f=0;f<i;f++)p[f]=a[f*2+0],b[f]=a[f*2+1];this.audioBuffer=l,n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,0,null),n.useProgram(null)}getBuffer(){return this.audioBuffer}}const we={Perspective:0,Orthography:1};class mi{constructor(t=we.Perspective,e={},r={}){A(this,"cameraType");A(this,"viewMatrix",Tt.identity44());A(this,"projectionMatrix",Tt.identity44());A(this,"position",new pt(0,0,0));A(this,"rotation",new Yt(0,0,0,0));A(this,"near",1);A(this,"far",1);A(this,"fov",1);A(this,"viewportWidth",1);A(this,"viewportHeight",1);A(this,"up");A(this,"forward");this.cameraType=t,this.position=e.position??new pt(0,0,30),this.rotation=e.rotation??new Yt(0,0,0,1),this.near=e.near??.1,this.far=e.far??100,this.fov=e.fov??45,this.viewportWidth=e.viewportWidth??800,this.viewportHeight=e.viewportHeight??800,this.up=r.up??new pt(0,1,0),this.forward=r.forward??new pt(0,0,-1),this.calculateProjectionMatrix(),this.calculateViewMatrix()}setPosition(t){this.position=t,this.calculateViewMatrix()}setRotation(t){this.rotation=t,this.calculateViewMatrix()}setViewport(t,e){if(e==0)throw new Error("Height is zero.");this.viewportWidth=t,this.viewportHeight=e,this.calculateProjectionMatrix()}setCameraType(t){this.cameraType=t,this.calculateProjectionMatrix()}getViewMatrix(){return this.viewMatrix}getProjectionMatrix(){return this.projectionMatrix}calculateEyeDirection(){const t=Tt.inverse(this.viewMatrix);return new pt(t.get(0,2),t.get(1,2),t.get(2,2))}calculateViewMatrix(){const t=ht.rotateVector(this.rotation,this.up),e=ht.rotateVector(this.rotation,this.forward),r=this.position.add(e);this.viewMatrix=Tt.lookAt(this.position,r,t),console.log(this.viewMatrix)}calculateProjectionMatrix(){this.cameraType==we.Perspective?this.calculatePerspectiveMatrix():this.calculateOrthographicMatrix()}calculatePerspectiveMatrix(){this.projectionMatrix=Tt.perspective(this.fov,this.viewportWidth,this.viewportHeight,this.near,this.far)}calculateOrthographicMatrix(){if(this.viewportHeight==0)throw new Error("Height is zero.");const t=this.viewportWidth/this.viewportHeight,e=1,r=e*t,i=-r,n=r,s=e,a=-1;this.projectionMatrix=Tt.orthographic(i,n,s,a,this.near,this.far)}}class be{constructor(){A(this,"startTime");A(this,"elapsedTime");A(this,"timeScale");A(this,"frameCount");A(this,"deltaTime");A(this,"lastDrawCallTime");A(this,"fps");A(this,"frameInterval");this.startTime=performance.now(),this.elapsedTime=0,this.timeScale=1,this.frameCount=0,this.deltaTime=0,this.lastDrawCallTime=-1,this.fps=60,this.frameInterval=1/this.fps}setFps(t){this.fps=t,this.frameInterval=1/this.fps}setFrameInterval(t){this.frameInterval=1/t}setTimeScale(t){this.timeScale=t}getElapsedTime(){return this.elapsedTime}getDeltaTime(){return this.deltaTime}getFrameCount(){return this.frameCount}getFrameInterval(){return this.frameInterval}reset(){this.startTime=performance.now(),this.elapsedTime=0,this.timeScale=1,this.frameCount=0,this.deltaTime=0}}class ar extends be{constructor(){super()}update(){this.frameCount++,this.frameCount%Math.floor(60/this.fps)==0&&(this.elapsedTime+=this.frameInterval)}shouldDraw(){return this.frameCount==0||this.frameCount%Math.floor(60/this.fps)==0}reset(){super.reset()}}class ye extends be{constructor(){super();A(this,"lastTime");this.lastTime=0}update(){const e=performance.now();this.elapsedTime=(e-this.startTime)*this.timeScale/1e3,this.deltaTime=Math.max((e-this.lastTime)*this.timeScale/1e3,0),this.lastTime=e,this.frameCount++,this.lastDrawCallTime<=-1?this.lastDrawCallTime=this.deltaTime:this.lastDrawCallTime+=this.deltaTime}shouldDraw(){return this.lastDrawCallTime==-1?!0:this.lastDrawCallTime>=this.frameInterval?(this.lastDrawCallTime=-1,!0):!1}reset(){super.reset(),this.lastTime=0}}class Qt{constructor(t,e){A(this,"geometry");A(this,"material");this.geometry=t,this.material=e}useMaterial(t,e){this.material.use(t,e)}updateMaterialParams(t,e,r){}}class gi extends Qt{constructor(t,e){super(t,e)}updateUniforms(t,e){this.material.setUniform(t,e)}draw(t){this.geometry.bind(),t.drawElements(t.TRIANGLES,this.geometry.getIndexCount(),t.UNSIGNED_SHORT,0),this.geometry.unbind()}}class vi extends Qt{constructor(t,e){super(t,e)}updateMaterialParams(t,e,r){const i=e.getWorldMatrix(),n=i.inverse(),s=r.getCamera().calculateEyeDirection();let a=r.getGlobalUniform();a.modelMatrix=new ct(i),a.invMatrix=new ct(n),a.eyeDirection=new ct(s);const l=this.material;if(l==null||r.getLights().length==0)return;let p=r.getLights().at(0);l.setLightUniform(t,p)}updateUniforms(t,e){this.material.setUniform(t,e)}draw(t){this.geometry.bind(),t.drawElements(t.TRIANGLES,this.geometry.getIndexCount(),t.UNSIGNED_SHORT,0),this.geometry.unbind(),this.material.cleanup()}}class or extends Qt{constructor(t,e){super(t,e)}updateUniforms(t,e){this.material.setUniform(t,e)}draw(t){t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.disable(t.CULL_FACE),this.geometry.bind(),t.drawElements(t.TRIANGLES,this.geometry.getIndexCount(),t.UNSIGNED_SHORT,0),this.geometry.unbind(),this.material.cleanup()}}class _i extends Qt{constructor(t,e){super(t,e)}get resolution(){return this.geometry.resolution}updateUniforms(t,e){this.material.setUniform(t,e)}draw(t){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.disable(t.DEPTH_TEST),this.geometry.bind(),t.drawElements(t.TRIANGLES,this.geometry.getIndexCount(),t.UNSIGNED_SHORT,0),this.geometry.unbind(),this.material.cleanup()}}class wi{constructor(t,e){A(this,"color");A(this,"intensity");this.color=t,this.intensity=e}setColor(t){this.color=t}setIntensity(t){this.intensity=t}getColor(){return this.color}getIntensity(){return this.intensity}}class bi{constructor(){A(this,"clock");A(this,"isRunning");A(this,"updateFunction");A(this,"drawFunction");A(this,"additionalSupportFunctionAsync");A(this,"animationId");this.clock=new ye,this.clock.reset(),this.clock.setFps(60),this.isRunning=!1,this.updateFunction=()=>{},this.drawFunction=()=>{},this.additionalSupportFunctionAsync=()=>{},this.animationId=0}start(){this.isRunning||(this.isRunning=!0,this.clock.reset(),this.run())}stop(){this.isRunning&&(this.isRunning=!1,cancelAnimationFrame(this.animationId))}reset(){this.clock.reset()}setUpdate(t){this.updateFunction=t}setDraw(t){this.drawFunction=t}setAdditionalSupport(t){this.additionalSupportFunctionAsync=t}setRealTimeClock(t){this.clock=new ye,this.clock.reset(),this.clock.setFps(t)}setFixedTimeClock(t,e){this.clock=new ar,this.clock.reset(),this.clock.setFps(t),this.clock.setFrameInterval(e)}get Clock(){return this.clock}async run(){this.isRunning&&(this.clock.update(),this.updateObjects(),this.drawObjects(),await this.additionalSupport(),this.animationId=requestAnimationFrame(()=>{this.run()}))}updateObjects(){this.updateFunction()}drawObjects(){this.drawFunction()}async additionalSupport(){await this.additionalSupportFunctionAsync()}}class ae{static replaceNode(t,e,r,i=!1){if(t.getChildren().indexOf(e)!==-1){if(i)for(const s of e.getChildren())r.addChild(s);t.removeChild(e),t.addChild(r)}}static addChild(t,e){t.addChild(e)}static findNodeById(t,e){if(t.getId()===e)return t;for(const r of t.getChildren()){const i=this.findNodeById(r,e);if(i!==void 0)return i}}static traverse(t,e){e(t);for(const r of t.getChildren())this.traverse(r,e)}}class yi extends $t{update(){var t;this.transform.updateMatrix((t=this.parent)==null?void 0:t.getTransform().getWorldMatrix());for(const e of this.children)e.update()}draw(t,e){for(const r of this.children)r.draw(t,e)}}class lr extends $t{constructor(e,r=""){super(r);A(this,"mesh");this.mesh=e}update(){var e;this.transform.updateMatrix((e=this.parent)==null?void 0:e.getTransform().getWorldMatrix())}draw(e,r){this.mesh.useMaterial(e,r),this.updateUniforms(e,r),this.updateMaterialParams(e,r),this.mesh.draw(e)}updateUniforms(e,r){const i=this.transform.getWorldMatrix(),n=r.getCamera().getViewMatrix(),l=r.getCamera().getProjectionMatrix().multiply(n).multiply(i);let p=r.getGlobalUniform();p.mvpMatrix=new ct(l),this.mesh.updateUniforms(e,p)}updateMaterialParams(e,r){this.mesh.updateMaterialParams(e,this.transform,r)}}class xe extends $t{constructor(e){super();A(this,"light");this.light=e}update(){var e;this.transform.updateMatrix((e=this.parent)==null?void 0:e.getTransform().getWorldMatrix());for(const r of this.children)r.update()}draw(e,r){for(const i of this.children)i.draw(e,r)}}class xi extends xe{constructor(t){super(t)}getLightData(){return{position:this.transform.getWorldPosition(),lightType:Kt.Point,color:this.light.getColor(),intensity:this.light.getIntensity()}}}class Ei extends xe{constructor(e,r=new pt(-.5,.5,.5)){super(e);A(this,"lightDirection");this.lightDirection=r}setLightDirection(e){this.lightDirection=e}getLightData(){return{direction:this.lightDirection,lightType:Kt.Directional,color:this.light.getColor(),intensity:this.light.getIntensity()}}}class Ai extends $t{constructor(e,r=""){super(r);A(this,"mesh");this.mesh=e}update(){var e;this.transform.updateMatrix((e=this.parent)==null?void 0:e.getTransform().getWorldMatrix())}draw(e,r){this.mesh.useMaterial(e,r),this.updateUniforms(e,r),this.updateMaterialParams(e,r),this.mesh.draw(e)}updateUniforms(e,r){const i=this.transform.getWorldMatrix(),n=r.getCamera().getViewMatrix(),l=r.getCamera().getProjectionMatrix().multiply(n).multiply(i);let p=r.getGlobalUniform();p.mvpMatrix=new ct(l),this.mesh.updateUniforms(e,p)}updateMaterialParams(e,r){this.mesh.updateMaterialParams(e,this.transform,r)}}class Ee{}class Ci extends Ee{constructor(e){super();A(this,"sceneGraphRoot");this.sceneGraphRoot=e}render(e,r,i,n){return n?n.drawToFrameBuffer(()=>{this.drawScene(e,r)}):this.drawScene(e,r),n}drawScene(e,r){ae.traverse(this.sceneGraphRoot,i=>{i.draw(e,r)})}}class Si extends Ee{constructor(e){super();A(this,"shaderPasses");this.shaderPasses=e}render(e,r,i,n){if(!this.shaderPasses||this.shaderPasses.size===0||!n)return;let s=i,a=n,l=s,p=a,b,f=0;for(const _ of this.shaderPasses.values()){if(!_.getEffectEnabled()){f++;continue}b=_.render(e,r,l,p,f===this.shaderPasses.size-1),l=b,p=p===s?a:s,f++}return b}}class Mt{constructor(t,e){A(this,"material");A(this,"plane");A(this,"isEffectEnabled",!0);this.material=e;const r=new sr(t,2,2),i={aPosition:e.getAttribute(t,"aPosition"),aColor:e.getAttribute(t,"aColor"),aUv:e.getAttribute(t,"aUv")};r.setUpBuffers(t,i);const n=new or(r,e);this.plane=new lr(n)}setEffectEnabled(t){this.isEffectEnabled=t}getEffectEnabled(){return this.isEffectEnabled}draw(t,e,r,i){return i?r.drawToScreen(()=>ae.traverse(this.plane,n=>n.draw(t,e))):r.drawToFrameBuffer(()=>ae.traverse(this.plane,n=>n.draw(t,e))),r}}class Ti extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class ki extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class Ri extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class Fi extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class zi extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class Pi extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class hr extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class Ae extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class cr extends Mt{constructor(t,e){super(t,e)}render(t,e,r,i,n){return r.bind(mt.CURRENT_FRAME),i=this.draw(t,e,i,n),r.unbind(),i}}class Mi{constructor(t,e,r,i,n){A(this,"brightShaderPass");A(this,"horizontalBlurShaderPass");A(this,"verticalBlurShaderPass");A(this,"composeShaderPass");A(this,"isEffectEnabled",!0);this.brightShaderPass=new hr(t,e),this.horizontalBlurShaderPass=new Ae(t,r),this.verticalBlurShaderPass=new Ae(t,i),this.composeShaderPass=new cr(t,n)}render(t,e,r,i,n){let s,a=e.getRenderTargetFromPool(Gt.BLOOM_TEMP_RENDER_TARGET_BRIGHT);s=this.brightShaderPass.render(t,e,r,a,!1);let l=s;return a=e.getRenderTargetFromPool(Gt.BLOOM_TEMP_RENDER_TARGET_BLUR_H),s=this.horizontalBlurShaderPass.render(t,e,l,a,!1),l=s,a=e.getRenderTargetFromPool(Gt.BLOOM_TEMP_RENDER_TARGET_BLUR_V),s=this.verticalBlurShaderPass.render(t,e,l,a,!1),l=s,a.bind(mt.BLOOM_FRAME),s=this.composeShaderPass.render(t,e,r,i,n),a.unbind(),s}setEffectEnabled(t){this.isEffectEnabled=t,this.brightShaderPass.setEffectEnabled(t),this.horizontalBlurShaderPass.setEffectEnabled(t),this.verticalBlurShaderPass.setEffectEnabled(t),this.composeShaderPass.setEffectEnabled(t)}getEffectEnabled(){return this.isEffectEnabled}}function Di(){console.log("ライブラリが初期化されました")}M.AttributeElementSize=X,M.AudioGuiController=me,M.AudioOutput=St,M.BaseApplication=tr,M.BaseBuffer=ve,M.BaseGeometry=Ht,M.BaseMaterial=Ct,M.BaseMesh=Qt,M.BaseSceneRendererFlow=Ee,M.BaseShaderPass=Mt,M.BloomShaderPass=Mi,M.BlurMaterial=Pe,M.BlurShaderPass=Pi,M.BrightMaterial=Me,M.BrightShaderPass=hr,M.Camera=mi,M.CameraType=we,M.Clock=be,M.Color=bt,M.Color255=At,M.ColorUtility=Xt,M.ComposeMaterial=De,M.ComposeShaderPass=cr,M.DefaultColorConstants=pr,M.DefaultValueConstants=Se,M.DefaultVectorConstants=Lt,M.DirectionalLightNode=Ei,M.EmptyNode=Fe,M.ExternalFileAudioInput=fi,M.FinalBlitShaderPass=zi,M.FixedTimeClock=ar,M.FontGlyph=Ze,M.FragmentCanvasMaterial=Oe,M.FrameBufferTexturedMaterial=Be,M.FullScreenQuadMesh=gi,M.GeometryBuffer=Vt,M.GlitchMaterial=Ue,M.GlitchShaderPass=Fi,M.GouraudMaterial=Le,M.GrayScaleMaterial=Ie,M.GrayScaleShaderPass=Ti,M.GroupNode=yi,M.GuiUtility=it,M.IndexBuffer=Wt,M.Light=wi,M.LightGuiController=Ut,M.LightNode=xe,M.LightType=Kt,M.MaterialFactory=Jt,M.MathUtility=q,M.Matrix=Et,M.Matrix22=Rt,M.Matrix33=kt,M.Matrix44=ft,M.MatrixCalculator=Tt,M.MatrixClassAndSizePair=ke,M.MeshNode=lr,M.MosaicMaterial=Ne,M.MosaicShaderPass=ki,M.MyColorCode=mr,M.MyColorConstants255=ze,M.PhongMaterial=je,M.PingPongRenderTarget=di,M.Plane=sr,M.PlaySceneGuiController=ge,M.PointLightNode=xi,M.PostEffectGuiController=ai,M.PostEffectRendererFlow=Si,M.Quaternion=Yt,M.QuaternionCalculator=ht,M.RGBShiftMaterial=$e,M.RGBShiftShaderPass=Ri,M.RealTimeClock=ye,M.RecordGuiController=yt,M.Recorder=ir,M.RecordingApplication=si,M.Rectangle=oi,M.RenderTarget=_e,M.RenderTargetSlot=Gt,M.RendererContext=He,M.Scene=bi,M.SceneGraphNodeIdGenerator=he,M.SceneGraphUtility=ae,M.SceneNode=$t,M.SceneRendererPipeline=We,M.ShaderAttribute=Xe,M.ShaderAudioInput=pi,M.ShaderLoader=Je,M.ShaderProgram=ue,M.ShaderUniform=Ke,M.ShaderUniformValue=ct,M.SimpleMesh=vi,M.SingleDirectionBlurShaderPass=Ae,M.Sphere=hi,M.StandardSceneRendererFlow=Ci,M.TextFontLoader=Ye,M.TextMesh=_i,M.TextMeshNode=Ai,M.TextQuad=ci,M.Texture2D=ce,M.TextureFrameBuffer=ui,M.TextureLoader=qe,M.TextureSlot=mt,M.TexturedMaterial=Ge,M.Torus=li,M.Transform=Re,M.TrigonometricConstants=It,M.UnlitMaterial=Ve,M.UnlitMesh=or,M.Vector=Nt,M.Vector2=Zt,M.Vector3=pt,M.Vector4=jt,M.VectorCalculator=lt,M.VectorClassAndSizePair=Te,M.VertexArray=nr,M.WebGLUtility=Qe,M.initializeLibrary=Di,Object.defineProperty(M,Symbol.toStringTag,{value:"Module"})});
